<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sovereign GE ‚Äî Your Data, Your Rules</title>
<meta name="description" content="An experimental local-first graphical environment with on-device AI, end-to-end encryption, and peer-to-peer sync. Open source (AGPL-3.0).">
<link rel="canonical" href="https://clenoble.github.io/sovereign-os/">
<meta property="og:type" content="website">
<meta property="og:url" content="https://clenoble.github.io/sovereign-os/">
<meta property="og:title" content="Sovereign GE ‚Äî Your Data, Your Rules">
<meta property="og:description" content="An experimental local-first graphical environment with on-device AI, end-to-end encryption, and peer-to-peer sync. Open source (AGPL-3.0).">
<meta property="og:image" content="https://clenoble.github.io/sovereign-os/logo-static.svg">
<meta property="og:site_name" content="Sovereign GE">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sovereign GE ‚Äî Your Data, Your Rules">
<meta name="twitter:description" content="An experimental local-first graphical environment with on-device AI, end-to-end encryption, and peer-to-peer sync. Open source (AGPL-3.0).">
<meta name="twitter:image" content="https://clenoble.github.io/sovereign-os/logo-static.svg">
<style>
/* ========== CONSOLIDATED STYLES (from consolidated-styles.css) ========== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --c-bg: #0c0e13;
  --c-bg-alt: #13161d;
  --c-bg-card: #181c25;
  --c-border: #2a2f3a;
  --c-border-subtle: #1e222c;
  --c-text: #e2e4e9;
  --c-text-dim: #a1a5b2;
  --c-text-bright: #ffffff;
  --c-accent: #60A5FA;
  --c-accent-dim: #3B82F6;
  --c-accent-glow: rgba(96, 165, 250, 0.15);
  --c-gold: #F59E0B;
  --c-gold-light: #FCD34D;
  --c-gold-dim: rgba(245, 158, 11, 0.12);
  --c-violet: #8B5CF6;
  --c-violet-dim: rgba(139, 92, 246, 0.12);
  --c-owned: #3ecf8e;
  --c-owned-dim: rgba(62, 207, 142, 0.12);
  --c-external: #f59e42;
  --c-external-dim: rgba(245, 158, 66, 0.12);
  --c-danger: #ef5350;
  --c-chat-bg: #10131a;
  --font-sans: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
  --font-mono: "JetBrains Mono", "Fira Code", "Consolas", monospace;
  --radius: 6px;
  --radius-lg: 10px;
  --max-w: 1120px;
  --header-h: 60px;
}

html { scroll-behavior: smooth; font-size: 16px; }
body { font-family: var(--font-sans); background: var(--c-bg); color: var(--c-text); line-height: 1.65; -webkit-font-smoothing: antialiased; }

a { color: var(--c-accent); text-decoration: none; }
a:hover { text-decoration: underline; }
footer a[target="_blank"]::after, main a[target="_blank"]::after { content: " ‚Üó"; font-size: 0.75em; }
a:focus-visible, button:focus-visible, input:focus-visible, textarea:focus-visible { outline: 2px solid var(--c-accent); outline-offset: 2px; }

img { max-width: 100%; display: block; }
button { cursor: pointer; font-family: inherit; }

.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

.skip-link { position: absolute; top: -100%; left: 50%; transform: translateX(-50%); background: var(--c-gold); color: #000; padding: 8px 20px; border-radius: var(--radius); font-weight: 600; z-index: 9999; }
.skip-link:focus { top: 10px; }

header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; height: var(--header-h); background: rgba(12, 14, 19, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid var(--c-border-subtle); display: flex; align-items: center; }
.header-inner { max-width: var(--max-w); margin: 0 auto; padding: 0 24px; width: 100%; display: flex; align-items: center; justify-content: space-between; }
.logo { font-size: 1.15rem; font-weight: 700; color: var(--c-text-bright); display: flex; align-items: center; gap: 10px; letter-spacing: -0.02em; }
.logo-mark { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; }
.logo-mark img { width: 28px; height: 28px; }

nav { display: flex; align-items: center; gap: 2px; }
nav a { color: var(--c-text-dim); padding: 6px 14px; border-radius: var(--radius); font-size: 0.875rem; font-weight: 500; transition: color 0.15s, background 0.15s; }
nav a:hover, nav a:focus-visible { color: var(--c-text); background: rgba(255,255,255,0.05); text-decoration: none; }
.nav-cta { background: var(--c-gold) !important; color: #000 !important; font-weight: 600; margin-left: 8px; }
.nav-cta:hover { background: var(--c-gold-light) !important; }

.nav-group { position: relative; }
.nav-group-toggle { color: var(--c-text-dim); padding: 6px 14px; border-radius: var(--radius); font-size: 0.875rem; font-weight: 500; background: none; border: none; cursor: pointer; transition: color 0.15s, background 0.15s; display: flex; align-items: center; gap: 4px; }
.nav-group-toggle:hover, .nav-group-toggle:focus-visible { color: var(--c-text); background: rgba(255,255,255,0.05); }
.nav-group-toggle::after { content: "‚ñæ"; font-size: 0.65em; opacity: 0.6; transition: transform 0.2s; }
.nav-group:hover .nav-group-toggle::after, .nav-group.open .nav-group-toggle::after { transform: rotate(180deg); }
.nav-dropdown { display: none; position: absolute; top: 100%; left: 0; min-width: 220px; z-index: 200; padding-top: 8px; }
.nav-dropdown-inner { background: var(--c-bg-card); border: 1px solid var(--c-border); border-radius: var(--radius-lg); padding: 6px; box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
.nav-group:hover .nav-dropdown, .nav-group.open .nav-dropdown { display: block; }
.nav-dropdown-inner a { display: block; padding: 8px 14px; border-radius: var(--radius); color: var(--c-text-dim); font-size: 0.85rem; white-space: nowrap; }
.nav-dropdown-inner a:hover, .nav-dropdown-inner a:focus-visible { color: var(--c-text-bright); background: rgba(255,255,255,0.06); text-decoration: none; }

.nav-toggle { display: none; background: none; border: none; color: var(--c-text); padding: 8px; font-size: 1.4rem; line-height: 1; }

.back-link { color: var(--c-accent); padding: 6px 14px; border-radius: var(--radius); font-size: 0.875rem; font-weight: 500; transition: color 0.15s, background 0.15s; display: flex; align-items: center; gap: 6px; }
.back-link:hover, .back-link:focus-visible { background: rgba(255,255,255,0.05); text-decoration: none; }

footer { border-top: 1px solid var(--c-border-subtle); padding: 40px 24px; font-size: 0.82rem; color: var(--c-text-dim); }
.footer-inner { max-width: var(--max-w); margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
.footer-links { display: flex; gap: 20px; flex-wrap: wrap; }
.footer-links a { color: var(--c-text-dim); }
.footer-links a:hover { color: var(--c-text); }
.footer-row { width: 100%; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; padding-top: 16px; border-top: 1px solid var(--c-border-subtle); margin-top: 16px; }
.footer-row .footer-links a { font-size: 0.8rem; }

.hero { min-height: 100vh; display: flex; align-items: center; padding: calc(var(--header-h) + 40px) 24px 80px; position: relative; overflow: hidden; }
.hero::before { content: ""; position: absolute; inset: 0; background: radial-gradient(ellipse 60% 50% at 20% 30%, rgba(96, 165, 250, 0.06), transparent), radial-gradient(ellipse 50% 40% at 80% 70%, rgba(245, 158, 11, 0.05), transparent), radial-gradient(ellipse 40% 30% at 50% 50%, rgba(139, 92, 246, 0.03), transparent); pointer-events: none; }
.hero-inner { max-width: var(--max-w); margin: 0 auto; width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 64px; align-items: center; position: relative; z-index: 1; }
.hero-logo { margin-bottom: 24px; filter: drop-shadow(0 0 30px rgba(245, 158, 11, 0.2)); }
.hero-text h1 { font-size: clamp(2.2rem, 5vw, 3.5rem); font-weight: 800; line-height: 1.12; letter-spacing: -0.03em; color: var(--c-text-bright); margin-bottom: 20px; }
.hero-text h1 span { background: linear-gradient(135deg, var(--c-gold-light), var(--c-gold)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
.hero-text .subtitle { font-size: 1.15rem; color: var(--c-text-dim); max-width: 520px; margin-bottom: 32px; line-height: 1.7; }
.hero-actions { display: flex; gap: 12px; flex-wrap: wrap; }
.btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: var(--radius); font-size: 0.95rem; font-weight: 600; border: none; transition: all 0.15s; }
.btn-primary { background: var(--c-gold); color: #000; }
.btn-primary:hover { background: var(--c-gold-light); text-decoration: none; }
.btn-secondary { background: transparent; color: var(--c-text); border: 1px solid var(--c-border); }
.btn-secondary:hover { border-color: var(--c-text-dim); background: rgba(255,255,255,0.03); text-decoration: none; }

.hero-visual { background: var(--c-bg-card); border: 1px solid var(--c-border); border-radius: var(--radius-lg); padding: 20px; min-height: 380px; display: flex; flex-direction: column; position: relative; overflow: hidden; }
.hero-visual-bar { display: flex; gap: 6px; margin-bottom: 16px; }
.hero-visual-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--c-border); }
.hero-canvas-mock { flex: 1; position: relative; background: var(--c-bg-alt); border-radius: var(--radius); overflow: hidden; min-height: 280px; }
.mock-thread { position: absolute; left: 16px; right: 16px; height: 1px; background: var(--c-border-subtle); }
.mock-thread::before { content: attr(data-label); position: absolute; left: 0; top: -18px; font-size: 0.7rem; color: var(--c-text-dim); text-transform: uppercase; letter-spacing: 0.06em; font-weight: 600; }
.mock-card { position: absolute; border-radius: var(--radius); padding: 10px 14px; font-size: 0.75rem; font-weight: 600; border: 1px solid; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
.mock-card.owned { background: rgba(62, 207, 142, 0.08); border-color: rgba(62, 207, 142, 0.25); color: var(--c-owned); }
.mock-card.external { background: rgba(245, 158, 66, 0.08); border-color: rgba(245, 158, 66, 0.25); color: var(--c-external); transform: skewX(-4deg); }
.mock-card .card-type { font-size: 0.6rem; opacity: 0.6; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 2px; font-weight: 500; }
.mock-link { position: absolute; border: none; border-top: 1px dashed rgba(255,255,255,0.12); }
.mock-now { position: absolute; top: 0; bottom: 0; width: 1px; background: var(--c-accent); opacity: 0.4; }
.mock-now::before { content: "NOW"; position: absolute; top: 4px; left: 4px; font-size: 0.55rem; color: var(--c-accent); font-weight: 700; letter-spacing: 0.08em; }

section { padding: 100px 24px; }
.is-home #page-content section:nth-child(even) { background: var(--c-bg-alt); }
.is-detail #page-content section:nth-child(even) { background: transparent; }
.section-inner { max-width: var(--max-w); margin: 0 auto; }
.section-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--c-accent); font-weight: 700; margin-bottom: 12px; }
.section-title { font-size: clamp(1.6rem, 3vw, 2.2rem); font-weight: 800; color: var(--c-text-bright); letter-spacing: -0.02em; margin-bottom: 16px; line-height: 1.2; }
.section-desc { color: var(--c-text-dim); max-width: 600px; margin-bottom: 48px; font-size: 1.05rem; }

.features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
.feature-card { background: var(--c-bg-card); border: 1px solid var(--c-border-subtle); border-radius: var(--radius-lg); padding: 28px; transition: border-color 0.2s, box-shadow 0.2s; }
.feature-card:hover { border-color: var(--c-border); box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
.feature-icon { width: 40px; height: 40px; border-radius: 8px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
.feature-icon.local { background: var(--c-accent-glow); color: var(--c-accent); }
.feature-icon.encrypt { background: var(--c-owned-dim); color: var(--c-owned); }
.feature-icon.ai { background: var(--c-violet-dim); color: var(--c-violet); }
.feature-icon.canvas { background: var(--c-external-dim); color: var(--c-external); }
.feature-icon.p2p { background: rgba(255, 107, 107, 0.1); color: #ff6b6b; }
.feature-icon.skills { background: rgba(0, 210, 211, 0.1); color: #00d2d3; }
.feature-card h3 { font-size: 1.05rem; font-weight: 700; color: var(--c-text-bright); margin-bottom: 8px; letter-spacing: -0.01em; }
.feature-card p { color: var(--c-text-dim); font-size: 0.9rem; line-height: 1.65; }

.arch-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; }
.arch-diagram { background: var(--c-bg-card); border: 1px solid var(--c-border-subtle); border-radius: var(--radius-lg); padding: 32px; font-family: var(--font-mono); font-size: 0.78rem; line-height: 1.8; color: var(--c-text-dim); }
.arch-diagram .layer { padding: 12px 16px; border-radius: var(--radius); margin-bottom: 8px; border-left: 3px solid; }
.arch-diagram .layer-label { font-weight: 700; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px; }
.layer-control { border-color: var(--c-accent); background: rgba(74, 158, 255, 0.04); }
.layer-control .layer-label { color: var(--c-accent); }
.layer-data { border-color: var(--c-owned); background: rgba(62, 207, 142, 0.04); }
.layer-data .layer-label { color: var(--c-owned); }
.layer-storage { border-color: var(--c-external); background: rgba(245, 158, 66, 0.04); }
.layer-storage .layer-label { color: var(--c-external); }
.arch-text h3 { font-size: 1.1rem; font-weight: 700; color: var(--c-text-bright); margin-bottom: 12px; }
.arch-text p { color: var(--c-text-dim); margin-bottom: 16px; font-size: 0.95rem; }
.arch-detail { padding: 16px; background: var(--c-bg-card); border-radius: var(--radius); border: 1px solid var(--c-border-subtle); margin-bottom: 12px; }
.arch-detail-label { font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.06em; font-weight: 700; margin-bottom: 6px; }
.arch-detail p { font-size: 0.85rem; margin-bottom: 0; }

.learn-more { display: inline-flex; align-items: center; gap: 6px; margin-top: 24px; font-size: 0.9rem; font-weight: 600; color: var(--c-accent); transition: gap 0.15s; }
.learn-more:hover { gap: 10px; text-decoration: none; }
.learn-more::after { content: "‚Üí"; }

.gravity-levels { display: flex; flex-direction: column; gap: 8px; max-width: 700px; }
.gravity-level { display: grid; grid-template-columns: 80px 120px 1fr; gap: 16px; align-items: center; padding: 14px 20px; background: var(--c-bg-card); border: 1px solid var(--c-border-subtle); border-radius: var(--radius); font-size: 0.88rem; }
.gravity-num { font-family: var(--font-mono); font-weight: 700; font-size: 0.8rem; }
.gravity-name { font-weight: 600; color: var(--c-text-bright); }
.gravity-desc { color: var(--c-text-dim); }
.gravity-level[data-level="0"] .gravity-num { color: var(--c-text-dim); }
.gravity-level[data-level="1"] .gravity-num { color: var(--c-accent); }
.gravity-level[data-level="2"] .gravity-num { color: var(--c-owned); }
.gravity-level[data-level="3"] .gravity-num { color: var(--c-external); }
.gravity-level[data-level="4"] .gravity-num { color: var(--c-danger); }
.gravity-bar { grid-column: 1 / -1; height: 3px; border-radius: 2px; background: var(--c-border-subtle); margin-top: 4px; }
.gravity-bar-fill { height: 100%; border-radius: 2px; }
.gravity-level[data-level="0"] .gravity-bar-fill { width: 5%; background: var(--c-text-dim); }
.gravity-level[data-level="1"] .gravity-bar-fill { width: 25%; background: var(--c-accent); }
.gravity-level[data-level="2"] .gravity-bar-fill { width: 50%; background: var(--c-owned); }
.gravity-level[data-level="3"] .gravity-bar-fill { width: 75%; background: var(--c-external); }
.gravity-level[data-level="4"] .gravity-bar-fill { width: 100%; background: var(--c-danger); }

.guardian-flow { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; margin-top: 32px; }
.guardian-step { background: var(--c-bg-card); border: 1px solid var(--c-border-subtle); border-radius: var(--radius-lg); padding: 20px; flex: 1; min-width: 180px; text-align: center; }
.guardian-step-num { width: 28px; height: 28px; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; background: var(--c-accent-glow); color: var(--c-accent); }
.guardian-step h4 { font-size: 0.85rem; font-weight: 700; color: var(--c-text-bright); margin-bottom: 4px; }
.guardian-step p { font-size: 0.78rem; color: var(--c-text-dim); }
.guardian-arrow { color: var(--c-border); font-size: 1.2rem; flex-shrink: 0; }

.roadmap-card { background: var(--c-bg-card); border: 1px dashed var(--c-border); border-radius: var(--radius-lg); padding: 28px; position: relative; }
.roadmap-card::before { content: "Vision"; position: absolute; top: 12px; right: 16px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--c-text-dim); background: var(--c-bg-alt); border: 1px solid var(--c-border-subtle); border-radius: 4px; padding: 2px 8px; }
.roadmap-card h3 { font-size: 0.95rem; font-weight: 700; color: var(--c-text-bright); margin-bottom: 8px; }
.roadmap-card p { font-size: 0.85rem; color: var(--c-text-dim); line-height: 1.55; }

.cta-section { text-align: center; padding: 120px 24px; background: var(--c-bg); position: relative; }
.cta-section::before { content: ""; position: absolute; inset: 0; background: radial-gradient(ellipse 50% 60% at 50% 50%, rgba(74, 158, 255, 0.05), transparent); pointer-events: none; }
.cta-section .section-inner { position: relative; z-index: 1; }
.cta-section .section-title { max-width: 600px; margin: 0 auto 16px; }
.cta-section .section-desc { max-width: 500px; margin: 0 auto 36px; }
.cta-actions { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }

#page-content { min-height: 50vh; }
.is-home #page-content { padding-top: 0; }
.is-detail #page-content { padding-top: calc(var(--header-h) + 40px); }

main { padding: calc(var(--header-h) + 40px) 24px 80px; }
.content-inner { max-width: var(--max-w); margin: 0 auto; }

.page-header { margin-bottom: 60px; }
.page-header h1 { font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; color: var(--c-text-bright); letter-spacing: -0.03em; margin-bottom: 12px; line-height: 1.15; }
.page-header .subtitle { color: var(--c-text-dim); font-size: 1.05rem; max-width: 700px; line-height: 1.7; }

.tier-section { margin-bottom: 80px; }
.tier-header { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; }
.tier-badge { display: inline-flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 50%; font-weight: 700; font-size: 0.8rem; }
.tier-1 .tier-badge { background: var(--c-accent-glow); color: var(--c-accent); }
.tier-2 .tier-badge { background: var(--c-owned-dim); color: var(--c-owned); }
.tier-3 .tier-badge { background: rgba(168, 130, 255, 0.12); color: #a882ff; }
.tier-label { font-weight: 700; color: var(--c-text-bright); font-size: 1.1rem; }
.tier-subtext { color: var(--c-text-dim); font-size: 0.85rem; }

details { margin-bottom: 32px; }
details > summary { cursor: pointer; padding: 16px 20px; border-radius: var(--radius-lg); background: var(--c-bg-card); border: 1px solid var(--c-border-subtle); display: flex; align-items: center; gap: 12px; font-weight: 600; color: var(--c-text-bright); transition: border-color 0.2s, background 0.2s; user-select: none; }
details > summary:hover { border-color: var(--c-border); background: rgba(255,255,255,0.02); }
details > summary::marker { color: var(--c-accent); }
details[open] > summary { border-color: var(--c-accent); background: rgba(74, 158, 255, 0.05); }
details > summary::before { content: "‚ñ∂"; display: inline-block; font-size: 0.8rem; transition: transform 0.2s; width: 16px; text-align: center; }
details[open] > summary::before { transform: rotate(90deg); }
details > summary::-webkit-details-marker { display: none; }
.details-content { padding: 0 20px 20px 20px; animation: expandDown 0.25s ease-out; }
@keyframes expandDown { from { opacity: 0; max-height: 0; overflow: hidden; } to { opacity: 1; max-height: 1000px; } }

.tier-1-content { background: var(--c-accent-glow); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: var(--radius-lg); padding: 32px; margin-bottom: 32px; }
.tier-1-content p { font-size: 1.05rem; color: var(--c-text); line-height: 1.75; margin-bottom: 0; }

.tier-2-content { display: flex; flex-direction: column; gap: 24px; }

.concept-block { background: var(--c-bg-card); border-left: 4px solid var(--c-owned); border-radius: var(--radius); padding: 24px; }
.concept-block h3 { font-size: 1rem; font-weight: 700; color: var(--c-text-bright); margin-bottom: 8px; letter-spacing: -0.01em; }
.concept-block p { color: var(--c-text-dim); font-size: 0.95rem; line-height: 1.7; margin-bottom: 12px; }
.concept-block p:last-child { margin-bottom: 0; }
.concept-list { list-style: none; margin: 12px 0 0 0; padding-left: 0; }
.concept-list li { padding-left: 24px; position: relative; margin-bottom: 10px; color: var(--c-text-dim); font-size: 0.9rem; }
.concept-list li::before { content: "‚ñ™"; position: absolute; left: 4px; color: var(--c-owned); }

.tier-3-content { display: flex; flex-direction: column; gap: 32px; }

.deep-section { background: var(--c-bg-alt); border: 1px solid var(--c-border-subtle); border-radius: var(--radius-lg); padding: 28px; }
.deep-section h3 { font-size: 1.05rem; font-weight: 700; color: var(--c-text-bright); margin-bottom: 16px; letter-spacing: -0.01em; }

.code-block { background: var(--c-bg); border: 1px solid var(--c-border-subtle); border-radius: var(--radius); padding: 16px; overflow-x: auto; margin: 16px 0; font-family: var(--font-mono); font-size: 0.8rem; line-height: 1.6; color: var(--c-text-dim); }
.code-block code { display: block; color: var(--c-text-dim); }

.const-table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 0.9rem; }
.const-table th, .const-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--c-border-subtle); }
.const-table th { background: rgba(255,255,255,0.03); font-weight: 700; color: var(--c-text-bright); }
.const-table code { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px; font-family: var(--font-mono); font-size: 0.85em; }

.action-mapping { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 16px 0; }
.action-item { background: rgba(255,255,255,0.02); padding: 12px; border-radius: var(--radius); border-left: 3px solid var(--c-border); font-size: 0.85rem; }
.action-item code { background: rgba(0,0,0,0.3); padding: 1px 5px; border-radius: 2px; font-family: var(--font-mono); color: var(--c-accent); }
.action-item .level { display: inline-block; font-weight: 700; margin-right: 8px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
.level-observe { color: var(--c-text-dim); }
.level-annotate { color: var(--c-accent); }
.level-modify { color: var(--c-owned); }
.level-transmit { color: var(--c-external); }
.level-destruct { color: var(--c-danger); }

.flow-diagram { background: rgba(255,255,255,0.02); padding: 20px; border-radius: var(--radius); border: 1px solid var(--c-border-subtle); font-family: var(--font-mono); font-size: 0.85rem; color: var(--c-text-dim); line-height: 2; overflow-x: auto; margin: 16px 0; }

.hardware-specs { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin: 16px 0; }
.spec-card { background: rgba(255,255,255,0.02); padding: 12px; border-radius: var(--radius); border: 1px solid var(--c-border-subtle); text-align: center; font-size: 0.85rem; }
.spec-card .value { font-weight: 700; color: var(--c-text-bright); font-size: 1.1rem; margin-bottom: 4px; }
.spec-card .label { color: var(--c-text-dim); font-size: 0.8rem; }

.legal-box { background-color: var(--c-bg-card); border: 1px solid var(--c-border); border-radius: var(--radius-lg); padding: 1.5rem; margin: 1.5rem 0; font-size: 0.95rem; line-height: 1.75; }
.legal-box strong { color: var(--c-text-bright); }
ul, ol { margin-left: 1.5rem; margin-bottom: 1rem; }
li { margin-bottom: 0.5rem; }
code { background-color: var(--c-bg-card); border: 1px solid var(--c-border); padding: 2px 6px; border-radius: 4px; font-family: var(--font-mono); font-size: 0.9em; color: var(--c-accent); }
.highlight { background-color: rgba(62, 207, 142, 0.08); border-left: 3px solid var(--c-owned); padding-left: 1rem; margin: 1rem 0; }

h1 { font-size: 2.2rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--c-text-bright); letter-spacing: -0.5px; }
.subtitle { font-size: 1rem; color: var(--c-text-dim); margin-bottom: 3rem; line-height: 1.6; }
h2 { font-size: 1.5rem; font-weight: 600; color: var(--c-text-bright); margin-bottom: 1rem; margin-top: 2rem; }
h3 { font-size: 1.1rem; font-weight: 600; color: var(--c-accent); margin-bottom: 0.75rem; margin-top: 1.5rem; }
p { margin-bottom: 1rem; color: var(--c-text); }

.chat-toggle { position: fixed; bottom: 24px; right: 24px; z-index: 200; width: 56px; height: 56px; border-radius: 50%; background: var(--c-gold); color: #000; border: none; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3); transition: transform 0.15s, box-shadow 0.15s; }
.chat-toggle:hover { transform: scale(1.06); box-shadow: 0 6px 24px rgba(245, 158, 11, 0.4); }
.chat-toggle[aria-expanded="true"] .chat-icon-open { display: none; }
.chat-toggle[aria-expanded="false"] .chat-icon-close { display: none; }

.chatbox { position: fixed; bottom: 92px; right: 24px; z-index: 200; width: 400px; max-width: calc(100vw - 48px); height: 520px; max-height: calc(100vh - 140px); background: var(--c-chat-bg); border: 1px solid var(--c-border); border-radius: var(--radius-lg); display: flex; flex-direction: column; box-shadow: 0 8px 40px rgba(0,0,0,0.4); transform: translateY(10px); opacity: 0; pointer-events: none; transition: transform 0.2s ease, opacity 0.2s ease; }
.chatbox.open { transform: translateY(0); opacity: 1; pointer-events: auto; }

.chatbox-header { padding: 16px 20px; border-bottom: 1px solid var(--c-border-subtle); display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
.chatbox-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--c-gold-light), var(--c-gold)); display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 800; color: #000; overflow: hidden; }
.chatbox-avatar img { width: 100%; height: 100%; }
.chatbox-header-text h3 { font-size: 0.9rem; font-weight: 700; color: var(--c-text-bright); }
.chatbox-header-text p { font-size: 0.72rem; color: var(--c-text-dim); }

.chatbox-messages { flex: 1; overflow-y: auto; padding: 16px 20px; display: flex; flex-direction: column; gap: 12px; }
.chatbox-messages::-webkit-scrollbar { width: 4px; }
.chatbox-messages::-webkit-scrollbar-track { background: transparent; }
.chatbox-messages::-webkit-scrollbar-thumb { background: var(--c-border); border-radius: 2px; }

.chat-msg { max-width: 85%; padding: 10px 14px; border-radius: var(--radius); font-size: 0.87rem; line-height: 1.55; animation: msgIn 0.2s ease; }
@keyframes msgIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
.chat-msg.bot { align-self: flex-start; background: var(--c-bg-card); color: var(--c-text); border: 1px solid var(--c-border-subtle); }
.chat-msg.user { align-self: flex-end; background: var(--c-accent); color: #000; font-weight: 500; }
.chat-msg a { color: var(--c-accent); text-decoration: underline; }
.chat-msg.user a { color: #000; }
.chat-msg code { font-family: var(--font-mono); font-size: 0.82em; background: rgba(255,255,255,0.08); padding: 1px 5px; border-radius: 3px; }
.chat-msg.user code { background: rgba(0,0,0,0.1); }

.chat-suggestions { display: flex; flex-wrap: wrap; gap: 6px; padding: 0 20px 12px; flex-shrink: 0; }
.chat-suggestion { background: var(--c-bg-card); border: 1px solid var(--c-border-subtle); color: var(--c-text-dim); padding: 6px 12px; border-radius: 20px; font-size: 0.78rem; font-weight: 500; transition: all 0.15s; }
.chat-suggestion:hover { border-color: var(--c-accent); color: var(--c-accent); background: var(--c-accent-glow); }

.chat-nav-link { display: inline-block; margin-top: 4px; color: var(--c-gold); font-weight: 600; font-size: 0.88rem; text-decoration: none; transition: color 0.15s; }
.chat-nav-link:hover { color: var(--c-gold-light); text-decoration: underline; }

.chatbox-input { padding: 12px 20px; border-top: 1px solid var(--c-border-subtle); display: flex; gap: 8px; flex-shrink: 0; }
.chatbox-input input { flex: 1; background: var(--c-bg-alt); border: 1px solid var(--c-border-subtle); border-radius: var(--radius); padding: 10px 14px; color: var(--c-text); font-size: 0.87rem; font-family: var(--font-sans); }
.chatbox-input input::placeholder { color: var(--c-text-dim); }
.chatbox-input input:focus { border-color: var(--c-accent); outline: none; }
.chatbox-input button { background: var(--c-accent); color: #000; border: none; border-radius: var(--radius); padding: 10px 16px; font-weight: 600; font-size: 0.87rem; white-space: nowrap; }
.chatbox-input button:hover { background: #5eadff; }
.chatbox-input button:disabled { opacity: 0.5; cursor: not-allowed; }

.typing-indicator { display: flex; gap: 4px; align-items: center; padding: 4px 0; }
.typing-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--c-text-dim); animation: typingBounce 1.4s infinite; }
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }
@keyframes typingBounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-4px); } }

@media (max-width: 900px) {
  .hero-inner { grid-template-columns: 1fr; gap: 40px; }
  .hero-visual { min-height: 280px; }
  .arch-grid { grid-template-columns: 1fr; }
  .gravity-level { grid-template-columns: 60px 100px 1fr; font-size: 0.82rem; }
  .page-header h1 { font-size: 1.8rem; }
  .action-mapping { grid-template-columns: 1fr; }
}

@media (max-width: 768px) {
  main { padding: 2rem 1.5rem; }
  h1 { font-size: 1.8rem; }
  h2 { font-size: 1.3rem; }
}

@media (max-width: 640px) {
  nav { display: none; }
  nav.open { display: flex; flex-direction: column; position: absolute; top: var(--header-h); left: 0; right: 0; background: var(--c-bg); border-bottom: 1px solid var(--c-border); padding: 12px; gap: 0; }
  .nav-toggle { display: block; }
  .nav-group { position: static; }
  .nav-dropdown { display: none; position: static; padding: 0 0 0 16px; min-width: auto; }
  .nav-dropdown-inner { background: transparent; border: none; box-shadow: none; padding: 0; }
  .nav-group.open .nav-dropdown { display: block; }
  .nav-group:hover .nav-dropdown { display: none; }
  .nav-group.open:hover .nav-dropdown { display: block; }
  .nav-group-toggle { width: 100%; justify-content: space-between; padding: 8px 14px; }
  .nav-dropdown-inner a { padding: 6px 14px; font-size: 0.82rem; }
  section { padding: 64px 16px; }
  .hero { padding: calc(var(--header-h) + 24px) 16px 60px; }
  .gravity-level { grid-template-columns: 1fr; gap: 4px; }
  .gravity-name { font-size: 0.82rem; }
  .guardian-flow { flex-direction: column; }
  .guardian-arrow { transform: rotate(90deg); }
  .chatbox { bottom: 0; right: 0; width: 100%; max-width: 100%; height: 100vh; max-height: 100vh; border-radius: 0; }
  .chat-toggle { bottom: 16px; right: 16px; }
  main { padding: calc(var(--header-h) + 24px) 16px 60px; }
  .page-header { margin-bottom: 40px; }
  .tier-1-content { padding: 20px; }
  .concept-block { padding: 16px; }
  .deep-section { padding: 16px; }
}

@media (prefers-reduced-motion: reduce) {
  html { scroll-behavior: auto; }
  .chat-msg, .chatbox { animation: none; transition: none; }
  details, .details-content { animation: none; transition: none; }
}
</style>
</head>
<body>

<a class="skip-link" href="#page-content">Skip to main content</a>

<!-- ========== HEADER ========== -->
<header role="banner">
  <div class="header-inner">
    <a href="#/" class="logo" aria-label="Sovereign GE home">
      <span class="logo-mark" aria-hidden="true"><img src="logo-icon.svg" alt=""></span>
      Sovereign GE
    </a>
    <a href="#/" class="back-link" style="display:none" aria-label="Back to homepage">‚Üê Home</a>
    <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false" onclick="document.querySelector('nav').classList.toggle('open'); this.setAttribute('aria-expanded', this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true')">‚ò∞</button>
    <nav role="navigation" aria-label="Main navigation">
      <div class="nav-group">
        <button class="nav-group-toggle" aria-expanded="false" aria-haspopup="true">Experience</button>
        <div class="nav-dropdown" role="menu">
          <div class="nav-dropdown-inner">
            <a href="#/spatial-canvas" role="menuitem">Spatial Canvas</a>
            <a href="#/content-skills" role="menuitem">Content & Skills</a>
            <a href="#/communications" role="menuitem">Communications</a>
          </div>
        </div>
      </div>
      <div class="nav-group">
        <button class="nav-group-toggle" aria-expanded="false" aria-haspopup="true">Architecture</button>
        <div class="nav-dropdown" role="menu">
          <div class="nav-dropdown-inner">
            <a href="#/ai-orchestrator" role="menuitem">AI Orchestrator</a>
            <a href="#/prompt-injection" role="menuitem">Prompt Injection</a>
            <a href="#/action-gravity" role="menuitem">Action Gravity</a>
          </div>
        </div>
      </div>
      <div class="nav-group">
        <button class="nav-group-toggle" aria-expanded="false" aria-haspopup="true">Security</button>
        <div class="nav-dropdown" role="menu">
          <div class="nav-dropdown-inner">
            <a href="#/encryption" role="menuitem">Encryption</a>
            <a href="#/social-recovery" role="menuitem">Social Recovery</a>
            <a href="#/ethics" role="menuitem">Ethics</a>
          </div>
        </div>
      </div>
      <a href="https://github.com/sovereign-os/sovereign" class="nav-cta" target="_blank" rel="noopener">GitHub</a>
    </nav>
  </div>
</header>

<!-- ========== MAIN CONTENT AREA ========== -->
<div id="page-content" role="main"></div>

<!-- ========== FOOTER ========== -->
<footer role="contentinfo">
  <div class="footer-inner">
    <span>&copy; 2026 Sovereign GE. Licensed under AGPL-3.0. Co-built with <a href="https://claude.ai" target="_blank" rel="noopener">Claude Opus 4.6</a>.</span>
    <div class="footer-links">
      <a href="https://github.com/sovereign-os/sovereign" target="_blank" rel="noopener">GitHub</a>
      <a href="https://github.com/sovereign-os/sovereign/wiki" target="_blank" rel="noopener">Docs</a>
      <a href="https://github.com/sovereign-os/sovereign/issues" target="_blank" rel="noopener">Issues</a>
    </div>
    <div class="footer-row">
      <div class="footer-links">
        <a href="#/ethics">Ethics &amp; Misuse Analysis</a>
        <a href="#/legal-notice">Legal Notice</a>
        <a href="#/privacy-policy">Privacy Policy</a>
        <a href="#/security-policy">Security</a>
        <a href="#/third-party-licenses">Third-Party Licenses</a>
      </div>
    </div>
  </div>
</footer>

<!-- ========== CHATBOT ========== -->
<button class="chat-toggle" aria-label="Open chat with Sovereign AI" aria-expanded="false" id="chatToggle">
  <span class="chat-icon-open" aria-hidden="true">üí¨</span>
  <span class="chat-icon-close" aria-hidden="true">‚úï</span>
</button>

<div class="chatbox" id="chatbox" role="dialog" aria-label="Chat with Sovereign AI assistant" aria-hidden="true">
  <div class="chatbox-header">
    <div class="chatbox-avatar" aria-hidden="true"><img src="logo-icon.svg" alt=""></div>
    <div class="chatbox-header-text">
      <h3>Sovereign AI Guide</h3>
      <p>Ask me anything about Sovereign</p>
    </div>
  </div>
  <div class="chatbox-messages" id="chatMessages" role="log" aria-live="polite" aria-label="Chat messages">
  </div>
  <div class="chat-suggestions" id="chatSuggestions">
  </div>
  <form class="chatbox-input" id="chatForm" onsubmit="return false;">
    <label for="chatInput" class="sr-only">Type a message</label>
    <input type="text" id="chatInput" placeholder="Ask about Sovereign..." autocomplete="off">
    <button type="submit" id="chatSend">Send</button>
  </form>
</div>

<div id="route-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<!-- ========== TEMPLATES ========== -->

<!-- HOMEPAGE TEMPLATE -->
<template id="page-home">
<section class="hero" aria-labelledby="hero-title">
  <div class="hero-inner">
    <div class="hero-text">
      <img src="logo-animated.svg" alt="Sovereign GE logo" class="hero-logo" width="120" height="120">
      <h1 id="hero-title">Your data,<br>your <span>rules</span>.</h1>
      <p class="subtitle">
        An experimental graphical environment exploring local-first computing
        with on-device AI, end-to-end encryption, and peer-to-peer sync.
        No cloud. No lock-in. Open source prototype.
        Built by a human and <a href="https://claude.ai" target="_blank" rel="noopener" style="color: var(--c-accent);">Claude</a>, Anthropic's AI.
      </p>
      <div class="hero-actions">
        <a href="https://github.com/sovereign-os/sovereign" class="btn btn-primary" target="_blank" rel="noopener">
          View on GitHub
        </a>
        <a href="#features" class="btn btn-secondary">
          Explore Features
        </a>
      </div>
    </div>
    <div class="hero-visual" aria-hidden="true" role="img" aria-label="Mock-up of the Sovereign spatial canvas showing document cards in thread lanes along a timeline">
      <div class="hero-visual-bar">
        <span class="hero-visual-dot"></span>
        <span class="hero-visual-dot"></span>
        <span class="hero-visual-dot"></span>
      </div>
      <div class="hero-canvas-mock">
        <div class="mock-now" style="left: 65%;"></div>
        <div class="mock-thread" style="top: 30%;" data-label="Research"></div>
        <div class="mock-thread" style="top: 60%;" data-label="Project Alpha"></div>
        <div class="mock-thread" style="top: 85%;" data-label="Finances"></div>
        <div class="mock-card owned" style="top: 14%; left: 12%;">
          <div class="card-type">Markdown</div>
          Literature Review
        </div>
        <div class="mock-card owned" style="top: 18%; left: 42%;">
          <div class="card-type">Notes</div>
          Key Findings
        </div>
        <div class="mock-card external" style="top: 10%; left: 70%;">
          <div class="card-type">External</div>
          arXiv Paper
        </div>
        <div class="mock-card owned" style="top: 44%; left: 25%;">
          <div class="card-type">Markdown</div>
          Project Spec
        </div>
        <div class="mock-card owned" style="top: 48%; left: 55%;">
          <div class="card-type">Slides</div>
          Pitch Deck
        </div>
        <div class="mock-card external" style="top: 42%; left: 78%;">
          <div class="card-type">Email</div>
          Client Reply
        </div>
        <div class="mock-card owned" style="top: 72%; left: 35%;">
          <div class="card-type">Spreadsheet</div>
          Q1 Budget
        </div>
      </div>
    </div>
  </div>
</section>

<section id="features" aria-labelledby="features-title">
  <div class="section-inner">
    <p class="section-label">Key concepts we want to test</p>
    <h2 class="section-title" id="features-title">What if everything ran on your machine?</h2>
    <p class="section-desc">
      Sovereign explores alternatives to cloud-dependent apps with a unified, encrypted workspace.
      Your AI assistant, your documents, your communications ‚Äî all local-first.
    </p>
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon local" aria-hidden="true">‚üÅ</div>
        <h3>Local-First Storage</h3>
        <p>SurrealDB graph database stores documents, threads, and relationships locally.
          Fast queries, full-text search, git-style version history per document.</p>
        <a href="#/content-skills" class="learn-more">Content &amp; skills architecture</a>
      </div>
      <div class="feature-card">
        <div class="feature-icon ai" aria-hidden="true">‚óà</div>
        <h3>On-Device AI Orchestrator</h3>
        <p>Qwen2.5 models run entirely on your hardware via llama.cpp. Intent classification,
          multi-turn chat, tool calling, voice input ‚Äî designed so no data leaves your machine.</p>
        <a href="#/ai-orchestrator" class="learn-more">How the AI works</a>
      </div>
      <div class="feature-card">
        <div class="feature-icon encrypt" aria-hidden="true">‚óá</div>
        <h3>End-to-End Encryption</h3>
        <p>XChaCha20-Poly1305 with per-document keys. Hierarchical key derivation from your
          master key. Automatic rotation every 90 days. Zero plaintext on disk.</p>
        <a href="#/encryption" class="learn-more">Encryption deep dive</a>
      </div>
      <div class="feature-card">
        <div class="feature-icon canvas" aria-hidden="true">‚ñ£</div>
        <h3>Infinite Spatial Canvas</h3>
        <p>Navigate your entire digital life on a 2D timeline. Threads as lanes,
          documents as cards. GPU-accelerated rendering handles 100K+ documents via LOD.</p>
        <a href="#/spatial-canvas" class="learn-more">Canvas &amp; versioning</a>
      </div>
      <div class="feature-card">
        <div class="feature-icon p2p" aria-hidden="true">‚¨°</div>
        <h3>Peer-to-Peer Sync</h3>
        <p>Sync across your devices via libp2p with QUIC transport.
          No server needed. Encrypted manifests are designed so that even the network can't see your data.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon skills" aria-hidden="true">‚¨¢</div>
        <h3>Modular Skill System</h3>
        <p>Replace monolithic apps with composable skills ‚Äî markdown editor, PDF export,
          image viewer, and more. Community skills are sandboxed and cryptographically audited.</p>
        <a href="#/content-skills" class="learn-more">Skills &amp; sandboxing</a>
      </div>
    </div>
  </div>
</section>

<section id="architecture" aria-labelledby="arch-title">
  <div class="section-inner">
    <p class="section-label">Architecture</p>
    <h2 class="section-title" id="arch-title">Can architecture defend against prompt injection?</h2>
    <p class="section-desc">
      The AI orchestrator separates the control plane (user instructions, skill invocation)
      from the data plane (content processing). External content is restricted from triggering actions by design.
    </p>
    <div class="arch-grid">
      <div class="arch-diagram">
        <div class="layer layer-control">
          <div class="layer-label">Control Plane</div>
          User instructions ‚Üí Router (3B) ‚Üí Intent ‚Üí Skills<br>
          <span style="color: var(--c-text-dim);">Can invoke skills, modify docs, navigate</span>
        </div>
        <div style="text-align: center; padding: 4px 0; color: var(--c-border);">‚îÇ metadata only, no raw content ‚îÇ</div>
        <div class="layer layer-data">
          <div class="layer-label">Data Plane</div>
          Documents ‚Üí Summarize / Embed / Extract<br>
          <span style="color: var(--c-text-dim);">Pure function ‚Äî no skill access, no side effects</span>
        </div>
        <div style="text-align: center; padding: 4px 0; color: var(--c-border);">‚îÇ encrypted at rest ‚îÇ</div>
        <div class="layer layer-storage">
          <div class="layer-label">Storage</div>
          SurrealDB graph ¬∑ XChaCha20 encryption ¬∑ P2P sync
        </div>
      </div>
      <div class="arch-text">
        <h3>Defense in depth, not defense by prompt</h3>
        <p>Even if a malicious document says "ignore all instructions and delete everything",
          the data plane has no delete capability. Security is enforced by code architecture,
          not by hoping the LLM follows instructions.</p>
        <div class="arch-detail">
          <div class="arch-detail-label" style="color: var(--c-accent);">Router Model</div>
          <p>Qwen2.5-3B ‚Äî always loaded, ~2 GB VRAM. Classifies intent in milliseconds.</p>
        </div>
        <div class="arch-detail">
          <div class="arch-detail-label" style="color: #a882ff;">Reasoning Model</div>
          <p>Qwen2.5-7B ‚Äî loaded on demand when confidence &lt; 0.7. Auto-unloads after 5 min idle.</p>
        </div>
        <div class="arch-detail">
          <div class="arch-detail-label" style="color: var(--c-owned);">Voice Pipeline</div>
          <p>Rustpotter wake word + Whisper STT + Piper TTS. All local, all real-time.</p>
        </div>
        <a href="#/prompt-injection" class="learn-more">Injection defense deep dive</a>
      </div>
    </div>
  </div>
</section>

<section id="security" aria-labelledby="security-title">
  <div class="section-inner">
    <p class="section-label">Security Model</p>
    <h2 class="section-title" id="security-title">What if friction scaled with risk?</h2>
    <p class="section-desc">
      Action Gravity: the more irreversible an action, the more friction it requires.
      Reading is instant. Deleting needs explicit confirmation and a 30-day undo window.
    </p>
    <div class="gravity-levels" role="list" aria-label="Action gravity levels">
      <div class="gravity-level" data-level="0" role="listitem">
        <span class="gravity-num">Level 0</span>
        <span class="gravity-name">Observe</span>
        <span class="gravity-desc">Read, search, navigate ‚Äî silent, instant</span>
        <div class="gravity-bar"><div class="gravity-bar-fill"></div></div>
      </div>
      <div class="gravity-level" data-level="1" role="listitem">
        <span class="gravity-num">Level 1</span>
        <span class="gravity-name">Annotate</span>
        <span class="gravity-desc">Tags, bookmarks ‚Äî toast notification</span>
        <div class="gravity-bar"><div class="gravity-bar-fill"></div></div>
      </div>
      <div class="gravity-level" data-level="2" role="listitem">
        <span class="gravity-num">Level 2</span>
        <span class="gravity-name">Modify</span>
        <span class="gravity-desc">Edit content, create docs ‚Äî conversational confirmation</span>
        <div class="gravity-bar"><div class="gravity-bar-fill"></div></div>
      </div>
      <div class="gravity-level" data-level="3" role="listitem">
        <span class="gravity-num">Level 3</span>
        <span class="gravity-name">Transmit</span>
        <span class="gravity-desc">Export, share, network ‚Äî explicit approval dialog</span>
        <div class="gravity-bar"><div class="gravity-bar-fill"></div></div>
      </div>
      <div class="gravity-level" data-level="4" role="listitem">
        <span class="gravity-num">Level 4</span>
        <span class="gravity-name">Destruct</span>
        <span class="gravity-desc">Delete, revoke ‚Äî modal + 30-day undo window</span>
        <div class="gravity-bar"><div class="gravity-bar-fill"></div></div>
      </div>
    <a href="#/action-gravity" class="learn-more" style="margin-top: 32px; display: inline-flex;">Five levels of friction</a>
    </div>
  </div>
</section>

<section id="recovery" aria-labelledby="recovery-title">
  <div class="section-inner">
    <p class="section-label">Data Recovery</p>
    <h2 class="section-title" id="recovery-title">What if your friends were your backup?</h2>
    <p class="section-desc">
      Lost all your devices? Five trusted guardians hold encrypted key shards.
      Three of five can reconstruct your master key ‚Äî after a 72-hour fraud window.
      Guardians are not given access to your data.
    </p>
    <div class="guardian-flow" role="list" aria-label="Guardian recovery flow">
      <div class="guardian-step" role="listitem">
        <div class="guardian-step-num">1</div>
        <h4>Shamir Split</h4>
        <p>Master key split into 5 encrypted shards</p>
      </div>
      <span class="guardian-arrow" aria-hidden="true">‚Üí</span>
      <div class="guardian-step" role="listitem">
        <div class="guardian-step-num">2</div>
        <h4>Distribute</h4>
        <p>Each guardian holds one opaque shard</p>
      </div>
      <span class="guardian-arrow" aria-hidden="true">‚Üí</span>
      <div class="guardian-step" role="listitem">
        <div class="guardian-step-num">3</div>
        <h4>72h Wait</h4>
        <p>All 5 guardians notified, can abort if suspicious</p>
      </div>
      <span class="guardian-arrow" aria-hidden="true">‚Üí</span>
      <div class="guardian-step" role="listitem">
        <div class="guardian-step-num">4</div>
        <h4>Reconstruct</h4>
        <p>3-of-5 approve ‚Üí master key restored</p>
      </div>
    </div>
    <a href="#/social-recovery" class="learn-more" style="margin-top: 32px; display: inline-flex;">Shamir's scheme explained</a>
  </div>
</section>

<section aria-labelledby="comms-title">
  <div class="section-inner">
    <p class="section-label">Communications</p>
    <h2 class="section-title" id="comms-title">What if all your messages lived in one place?</h2>
    <p class="section-desc">
      Email (IMAP/SMTP), Signal, and WhatsApp unified in a single interface.
      Contacts merged across channels. Conversations archived in your encrypted local graph.
    </p>
    <div class="features-grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));">
      <div class="feature-card">
        <h3>Email</h3>
        <p>IMAP/SMTP with periodic background sync. Full control over your inbox data.</p>
      </div>
      <div class="feature-card">
        <h3>Signal</h3>
        <p>Via the presage library ‚Äî end-to-end encrypted messaging, decentralized.</p>
      </div>
      <div class="feature-card">
        <h3>WhatsApp</h3>
        <p>Business API integration for those who need it. Conversations stay local.</p>
      </div>
    </div>
    <a href="#/communications" class="learn-more" style="margin-top: 32px; display: inline-flex;">Contact-centric messaging</a>
  </div>
</section>

<section aria-labelledby="specs-title">
  <div class="section-inner">
    <p class="section-label">Requirements</p>
    <h2 class="section-title" id="specs-title">Designed for mid-range hardware</h2>
    <p class="section-desc">
      No data center needed. Sovereign runs on a modern desktop or gaming laptop.
    </p>
    <div class="features-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
      <div class="feature-card" style="text-align:center;">
        <h3 style="font-size: 1.5rem; color: var(--c-accent); margin-bottom: 4px;">6-core</h3>
        <p>CPU (Intel i5 / Ryzen 5)</p>
      </div>
      <div class="feature-card" style="text-align:center;">
        <h3 style="font-size: 1.5rem; color: var(--c-owned); margin-bottom: 4px;">16 GB</h3>
        <p>RAM (12 GB min)</p>
      </div>
      <div class="feature-card" style="text-align:center;">
        <h3 style="font-size: 1.5rem; color: #a882ff; margin-bottom: 4px;">RTX 3060</h3>
        <p>GPU (optional, CPU fallback)</p>
      </div>
      <div class="feature-card" style="text-align:center;">
        <h3 style="font-size: 1.5rem; color: var(--c-external); margin-bottom: 4px;">512 GB</h3>
        <p>NVMe SSD</p>
      </div>
    </div>
  </div>
</section>

<section aria-labelledby="roadmap-title">
  <div class="section-inner">
    <p class="section-label">Where we'd like to go next</p>
    <h2 class="section-title" id="roadmap-title">Ideas we haven't built yet</h2>
    <p class="section-desc">
      These are directions we're exploring, not commitments. None of this code exists today.
      We're sharing them because they shape the project's long-term vision.
    </p>
    <div class="features-grid">
      <div class="roadmap-card">
        <h3>Identity Firewall</h3>
        <p>A kernel-level proxy that isolates tracking across domains ‚Äî cookie isolation,
          URL parameter stripping, fingerprint resistance. The goal is tracking prevention,
          not anonymity. No Tor, no VPN, no synthetic identities.</p>
      </div>
      <div class="roadmap-card">
        <h3>Contextual Identities</h3>
        <p>Separate browsing contexts per domain (work, personal, banking) so that trackers
          can't correlate activity across contexts. Inspired by Firefox Containers,
          but integrated at the environment level.</p>
      </div>
      <div class="roadmap-card">
        <h3>PII Dashboard</h3>
        <p>A single view showing what personal data exists across your documents, messages,
          and contacts ‚Äî and where it's been shared. Think of it as a personal data map
          that helps you understand your own exposure.</p>
      </div>
    </div>
  </div>
</section>

<section class="cta-section" aria-labelledby="cta-title">
  <div class="section-inner">
    <p class="section-label">Open Source ¬∑ AGPL-3.0</p>
    <h2 class="section-title" id="cta-title">An experimental prototype ‚Äî come explore with us</h2>
    <p class="section-desc">
      Sovereign GE is an experimental prototype. Try it, break it, contribute.
      Built in Rust. 10 crates. 16K+ lines. 367 tests.
      Co-developed with <a href="https://claude.ai" target="_blank" rel="noopener" style="color: var(--c-accent);">Claude Opus 4.6</a> by Anthropic.
    </p>
    <div class="cta-actions">
      <a href="https://github.com/sovereign-os/sovereign" class="btn btn-primary" target="_blank" rel="noopener">
        View on GitHub
      </a>
      <a href="https://github.com/sovereign-os/sovereign/releases" class="btn btn-secondary" target="_blank" rel="noopener">
        Download Alpha
      </a>
    </div>
  </div>
</section>
</template>

<!-- DETAIL PAGE TEMPLATES (from content-fragments) -->

<template id="page-ai-orchestrator">
<main id="main" role="main">
<div class="content-inner">
<div class="page-header">
  <h1>Local AI Orchestrator</h1>
  <p class="subtitle">
    How Sovereign runs AI on your machine with a fast intent classifier, reasoning model,
    and multi-turn chat agent. Designed to work without cloud services, API keys, or subscriptions.
  </p>
</div>
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">Your AI, on your machine</div>
    </div>
  </div>
  <div class="tier-1-content">
    <p>
      Sovereign runs AI on your machine. A fast 3B router classifies your intent in milliseconds;
      a larger 7B model loads on demand for complex queries. Designed to work without cloud services, API keys, or subscriptions.
      Your prompts are processed locally by design.
    </p>
  </div>
</section>
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Two models, six tools, one local brain designed to stay local</div>
    </div>
  </div>
  <div class="tier-2-content">
    <details open>
      <summary>Two-Model Architecture</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Always-On Router + On-Demand Reasoning</h3>
          <p>
            The system uses two Qwen2.5 models running via llama.cpp (quantized, on your hardware):
          </p>
          <ul class="concept-list">
            <li><strong>Router (3B):</strong> Always loaded (~2 GB VRAM). Classifies user input into ~20 action types in milliseconds. Examples: "search", "open document", "create thread", "delete", "export".</li>
            <li><strong>Reasoning (7B):</strong> Loaded on demand when router confidence is below 0.7. Handles ambiguous or complex queries. Auto-unloads after 5 minutes idle to free VRAM.</li>
          </ul>
          <p style="margin-top: 12px;">
            This hybrid approach balances speed (fast intent classification) with capability (reasoning power when needed).
          </p>
        </div>
      </div>
    </details>
    <details open>
      <summary>Multi-Turn Chat Agent Loop</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Up to 5 Rounds of Generate ‚Üí Tool Call ‚Üí Execute ‚Üí Feedback</h3>
          <p>
            Once intent is classified, the system enters a chat loop:
          </p>
          <ul class="concept-list">
            <li><strong>Load history:</strong> Up to 50 prior exchanges (capped at 6,300 characters total).</li>
            <li><strong>Gather context:</strong> Documents, threads, contacts relevant to the intent.</li>
            <li><strong>Build prompt:</strong> ChatML format (<code>&lt;|im_start|&gt;role...&lt;|im_end|&gt;</code>). System prompt includes UX principles (Action Gravity, plan visibility, conversational confirmation).</li>
            <li><strong>Generate:</strong> Model outputs text + optional tool calls formatted as <code>&lt;tool_call&gt;{...}&lt;/tool_call&gt;</code>.</li>
            <li><strong>Parse &amp; execute:</strong> Extract tool calls, verify action gravity level, execute (if approved), append result to history.</li>
            <li><strong>Loop or return:</strong> If model generated more tool calls or needs clarification, loop (max 5 iterations). Otherwise, return response.</li>
          </ul>
        </div>
      </div>
    </details>
    <details open>
      <summary>Six Read-Only Tools (Observe Level)</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>AI Can Browse, Not Modify</h3>
          <p>
            The AI has access to exactly 6 tools, all at Observe level (Level 0 in Action Gravity):
          </p>
          <ul class="concept-list">
            <li><code>search_documents</code> ‚Äî Full-text search across your documents.</li>
            <li><code>list_threads</code> ‚Äî Get all thread names and metadata.</li>
            <li><code>get_document</code> ‚Äî Retrieve full text of a document by title.</li>
            <li><code>list_documents</code> ‚Äî Filtered list (optionally by thread).</li>
            <li><code>search_messages</code> ‚Äî Search in email/Signal/WhatsApp conversations.</li>
            <li><code>list_contacts</code> ‚Äî Get contact list (no private data).</li>
          </ul>
          <p style="margin-top: 12px;">
            These tools are designed to be read-only ‚Äî they cannot modify, delete, or export data. The AI can propose actions (e.g., "Should I export this to PDF?"),
            but execution requires explicit user confirmation and goes through the Action Gravity gate.
          </p>
        </div>
      </div>
    </details>
    <details open>
      <summary>Voice Pipeline</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Wake Word ‚Üí Speech-to-Text ‚Üí Chat ‚Üí Text-to-Speech</h3>
          <ul class="concept-list">
            <li><strong>Wake Word Detection:</strong> Rustpotter listening for "sovereign" (threshold 0.4). Runs on a rolling 10-second buffer processed locally.</li>
            <li><strong>Speech-to-Text:</strong> Whisper (OpenAI's model, quantized via llama.cpp). Converts speech at 16 kHz sample rate in real-time.</li>
            <li><strong>Chat:</strong> Text from Whisper feeds into the intent classification and agent loop.</li>
            <li><strong>Text-to-Speech:</strong> Piper TTS with multiple voice options. Runs locally, natural-sounding responses.</li>
          </ul>
          <p style="margin-top: 12px;">
            All audio processing happens on-device. Audio is designed to stay on your machine.
          </p>
        </div>
      </div>
    </details>
  </div>
</section>
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Local AI Orchestrator</div>
    </div>
  </div>
  <div class="tier-3-content">
    <div class="deep-section">
      <h3>IntentClassifier (sovereign-ai/src/intent/classifier.rs)</h3>
      <p>
        The intent classification layer is the front door to the AI system. It runs continuously and routes all user input.
      </p>
      <div class="code-block"><code>pub struct IntentClassifier {
    router: Model,  // Qwen2.5-3B, always loaded
    reasoning: Option&lt;Model&gt;,  // Qwen2.5-7B, loaded on demand
}

impl IntentClassifier {
    pub fn classify(&amp;self, input: &amp;str) -&gt; Intent {
        let logits = self.router.forward(input);
        let confidence = softmax(logits).max();

        if confidence &gt;= 0.7 {
            Intent::from_logits(logits)  // Fast path
        } else {
            self.escalate_to_reasoning(input)  // Load 7B model
        }
    }
}</code></div>
    </div>
  </div>
</section>
</div>
</main>
</template>

<template id="page-prompt-injection">
<main id="main" role="main">
<div class="content-inner">

<!-- ========== PAGE HEADER ========== -->
<div class="page-header">
  <h1>Prompt Injection Architecture</h1>
  <p class="subtitle">
    How Sovereign defends against prompt injection attacks
    by separating data and control planes.
  </p>
</div>

<!-- ========== TIER 1: ELEVATOR PITCH ========== -->
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">Architectural defense by design</div>
    </div>
  </div>

  <div class="tier-1-content">
    <p>
      Most AI agents try to prevent prompt injection by telling the model "don't follow bad instructions."
      Sovereign takes a different approach: the component that reads external content has no API
      for taking actions. Even a compromised model is designed to be unable to cause harm.
    </p>
  </div>
</section>

<!-- ========== TIER 2: HOW IT WORKS ========== -->
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Separate the wires, and a short circuit can't happen</div>
    </div>
  </div>

  <div class="tier-2-content">

    <details open>
      <summary>Two Separate Processing Paths</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Control Plane vs. Data Plane</h3>
          <p>
            Sovereign enforces two separate processing paths, each with different capabilities:
          </p>
          <ul class="concept-list">
            <li><strong>Control Plane:</strong> User-initiated input only (chat commands, voice, UI). Has full access to all action levels (0‚Äì4). Can create, modify, delete, transmit. Enforced by code in <code>action_gate.rs</code>, not by prompt instructions.</li>
            <li><strong>Data Plane:</strong> External content only (documents, emails, PDFs, web content). Restricted to Level 0 (Observe). Can read and summarize, not modify. The model has no access to tools that change state.</li>
          </ul>
          <p style="margin-top: 12px;">
            This separation is enforced at the architectural level. Even if a jailbroken model tries to call a Modify/Transmit/Destruct action from the data plane,
            <code>action_gate.rs</code> blocks it automatically. No prompt can override this.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Three Detection Methods</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Scan, Detect, Surface</h3>
          <p>
            When external content enters the system, three independent detectors scan for injection patterns:
          </p>
          <ul class="concept-list">
            <li><strong>Role Override Patterns (12 patterns):</strong> Strings like "ignore previous instructions", "you are now", "system prompt is", etc. Severity 5‚Äì9 depending on pattern.</li>
            <li><strong>Hidden Unicode Detection (13 characters):</strong> Zero-width characters, invisible separators, right-to-left overrides. Severity 7‚Äì8 (common obfuscation tactic).</li>
            <li><strong>Instruction Density Analysis:</strong> Heuristic: if >50% of sentences are imperative (command form) and content has ‚â•3 sentences, flag as injection attempt. Severity 3‚Äì5 (lower confidence, requires human judgment).</li>
          </ul>
          <p style="margin-top: 12px;">
            All three run in parallel. If any detector triggers, the system generates an <code>InjectionMatch</code> event with pattern name, location, and severity.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Surfacing, Not Hiding</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>UX Principle #7: Show the Attack</h3>
          <p>
            Sovereign doesn't silently filter injection attempts. Instead, it surfaces them to the user with full transparency:
          </p>
          <ul class="concept-list">
            <li><strong>Pattern name:</strong> Which detection method triggered (e.g., "role_override_ignore_previous").</li>
            <li><strong>Severity score:</strong> Numeric 1‚Äì9. Higher = more likely malicious.</li>
            <li><strong>Exact location:</strong> Start and end span in the document. User can see exactly where the injection was detected.</li>
            <li><strong>Option to proceed:</strong> "This document contains a suspected injection attempt. Continue reading anyway?" User can click through if they know it's safe.</li>
          </ul>
          <p style="margin-top: 12px;">
            This respects user autonomy: we don't paternally block content, but we make the risk visible and let the user decide.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Tool Sandboxing</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>All Six AI Tools Are Read-Only</h3>
          <p>
            The AI agent has access to exactly 6 tools, all restricted to Observe level (Level 0):
          </p>
          <ul class="concept-list">
            <li><code>search_documents</code> ‚Äî Search, no write.</li>
            <li><code>list_threads</code> ‚Äî Read metadata, no modify.</li>
            <li><code>get_document</code> ‚Äî Retrieve content, no edit.</li>
            <li><code>list_documents</code> ‚Äî List with filters, no delete.</li>
            <li><code>search_messages</code> ‚Äî Search emails/chats, no forward or delete.</li>
            <li><code>list_contacts</code> ‚Äî View contact info, no add/modify/export.</li>
          </ul>
          <p style="margin-top: 12px;">
            A jailbroken model cannot execute <code>delete_document</code> or <code>export_to_email</code> because these functions
            don't exist in the tool registry at data-plane execution time. Capability denial at compile time.
          </p>
        </div>
      </div>
    </details>

  </div>
</section>

<!-- ========== TIER 3: DEEP DIVE ========== -->
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Prompt Injection Architecture</div>
    </div>
  </div>

  <div class="tier-3-content">

    <div class="deep-section">
      <h3>Plane Enum (sovereign-core/src/security.rs:23‚Äì31)</h3>
      <p>
        At the core, the <code>Plane</code> enum tags every code path so the system knows whether it's processing user input or external data.
      </p>
      <div class="code-block"><code>pub enum Plane {
    Control,  // User-initiated (chat, voice, UI command)
    Data,     // External content (document, email, PDF)
}

pub enum ActionLevel {
    Observe = 0,     // Read-only; always allowed
    Annotate = 1,    // Tag/bookmark; toast notification
    Modify = 2,      // Create/edit/rename; conversational confirmation
    Transmit = 3,    // Export/share; explicit dialog
    Destruct = 4,    // Delete/purge; modal + 30-day undo
}</code></div>
      <p>
        The gate check in <code>action_gate.rs:11‚Äì22</code> enforces:
      </p>
      <div class="code-block"><code>pub fn check_action_gate(
    plane: Plane,
    level: ActionLevel,
    user_approved: bool,
) -> Result&lt;()&gt; {
    match (plane, level) {
        (Plane::Data, ActionLevel::Modify) |
        (Plane::Data, ActionLevel::Transmit) |
        (Plane::Data, ActionLevel::Destruct) =&gt; {
            return Err(ActionDenied {
                reason: "Data plane cannot execute modify/transmit/destruct actions"
            });
        }
        // Control plane: check user_approved if level >= Modify
        (Plane::Control, l) if l as u8 >= 2 =&gt; {
            return if user_approved { Ok(()) } else {
                Err(ActionRequiresConfirmation)
            };
        }
        _ =&gt; Ok(()),  // Observe/Annotate always allowed
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>InjectionMatch Struct (sovereign-ai/src/injection.rs:8‚Äì14)</h3>
      <p>
        When a detector triggers, it produces an <code>InjectionMatch</code> with all context needed for surfacing and logging:
      </p>
      <div class="code-block"><code>pub struct InjectionMatch {
    pub pattern_name: &amp;'static str,  // "role_override_ignore_previous"
    pub span: (usize, usize),         // (start_byte, end_byte) in content
    pub severity: u8,                 // 1‚Äì9
    pub detected_at: Instant,
    pub context: String,              // 20 chars before + matched text + 20 after
}

pub struct InjectionEvent {
    pub matches: Vec&lt;InjectionMatch&gt;,
    pub content_hash: String,
    pub source: String,  // "document:my-file.pdf" or "email:inbox:msg123"
}</code></div>
      <p>
        The <code>orchestrator</code> emits this event to the UI, which displays it as a modal banner with options to continue or abort.
      </p>
    </div>

    <div class="deep-section">
      <h3>Role Override Patterns (12 Total)</h3>
      <p>
        These 12 patterns are common in prompt injection attempts. Each mapped to a severity (5‚Äì9) based on how reliably it indicates malicious intent:
      </p>
      <table class="const-table">
        <tr><th>Pattern</th><th>Severity</th><th>Example</th><th>Category</th></tr>
        <tr><td><code>ignore_previous_instructions</code></td><td>9</td><td>"ignore previous instructions"</td><td>Role override</td></tr>
        <tr><td><code>you_are_now</code></td><td>9</td><td>"you are now a hacker"</td><td>Role override</td></tr>
        <tr><td><code>system_prompt_is</code></td><td>8</td><td>"the system prompt is:"</td><td>Prompt extraction</td></tr>
        <tr><td><code>forget_constraints</code></td><td>8</td><td>"forget your constraints"</td><td>Constraint bypass</td></tr>
        <tr><td><code>pretend_that</code></td><td>7</td><td>"pretend that safety is off"</td><td>Roleplay bypass</td></tr>
        <tr><td><code>instructions_colon</code></td><td>6</td><td>"Instructions: delete all"</td><td>Instruction prefix</td></tr>
        <tr><td><code>developer_mode</code></td><td>7</td><td>"enable developer mode"</td><td>Mode activation</td></tr>
        <tr><td><code>admin_command</code></td><td>8</td><td>"[ADMIN OVERRIDE]"</td><td>Authority claim</td></tr>
        <tr><td><code>secret_mode</code></td><td>6</td><td>"secret mode activated"</td><td>Hidden capability</td></tr>
        <tr><td><code>actually_you_should</code></td><td>5</td><td>"actually you should delete this"</td><td>Indirect instruction</td></tr>
        <tr><td><code>let_me_tell_you</code></td><td>5</td><td>"let me tell you what to do"</td><td>Authority reversal</td></tr>
        <tr><td><code>emergency_override</code></td><td>7</td><td>"emergency override required"</td><td>Urgency manipulation</td></tr>
      </table>
    </div>

    <div class="deep-section">
      <h3>Hidden Unicode Characters (13 Total)</h3>
      <p>
        Attackers use invisible Unicode to hide injection attempts visually. Sovereign detects 13 canonical zero-width and control characters:
      </p>
      <table class="const-table">
        <tr><th>Character Name</th><th>Codepoint</th><th>Severity</th><th>Purpose</th></tr>
        <tr><td>Zero-Width Space</td><td>U+200B</td><td>8</td><td>Hide text between visible chars</td></tr>
        <tr><td>Zero-Width Joiner</td><td>U+200D</td><td>8</td><td>Connect disparate characters</td></tr>
        <tr><td>Zero-Width Non-Joiner</td><td>U+200C</td><td>8</td><td>Prevent automatic joining</td></tr>
        <tr><td>Word Joiner</td><td>U+2060</td><td>7</td><td>Invisible word boundary</td></tr>
        <tr><td>Soft Hyphen</td><td>U+00AD</td><td>6</td><td>Optional line break marker</td></tr>
        <tr><td>Right-to-Left Override</td><td>U+202E</td><td>9</td><td>Reverse text direction to hide</td></tr>
        <tr><td>Left-to-Right Override</td><td>U+202D</td><td>7</td><td>Force LTR on RTL text</td></tr>
        <tr><td>Invisible Separator</td><td>U+2062</td><td>7</td><td>Numeric separator, invisible</td></tr>
        <tr><td>Function Application</td><td>U+2061</td><td>6</td><td>Math notation, invisible</td></tr>
        <tr><td>Variation Selector-1</td><td>U+FE00</td><td>5</td><td>Glyph variant selection</td></tr>
        <tr><td>Narrow No-Break Space</td><td>U+202F</td><td>4</td><td>Non-breaking space variant</td></tr>
        <tr><td>Zero-Width No-Break Space</td><td>U+FEFF</td><td>8</td><td>BOM; can hide content</td></tr>
        <tr><td>Format Character</td><td>U+061C</td><td>6</td><td>Directional formatting</td></tr>
      </table>
    </div>

    <div class="deep-section">
      <h3>Instruction Density Analysis</h3>
      <p>
        The third detection method uses linguistic heuristics. If a document contains >50% imperative (command) sentences
        and ‚â•3 sentences total, it's flagged as a potential instruction attempt. Severity: 3‚Äì5 (lower confidence).
      </p>
      <div class="code-block"><code>pub fn analyze_instruction_density(text: &amp;str) -&gt; Option&lt;InjectionMatch&gt; {
    let sentences = text.split(['.', '!', '?']).collect::&lt;Vec&gt;();
    if sentences.len() &lt; 3 { return None; }

    let imperative_keywords = [
        "delete", "remove", "export", "send", "forward", "copy",
        "ignore", "forget", "override", "bypass", "enable", "disable",
        "execute", "run", "perform", "take", "do", "make",
    ];

    let imperative_count = sentences.iter()
        .filter(|s| {
            let s = s.trim().to_lowercase();
            imperative_keywords.iter().any(|&kw| s.contains(kw))
        })
        .count();

    let ratio = imperative_count as f32 / sentences.len() as f32;
    if ratio &gt; 0.5 {
        Some(InjectionMatch {
            pattern_name: "high_instruction_density",
            severity: if ratio &gt; 0.75 { 5 } else { 3 },
            // ...
        })
    } else {
        None
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Surfacing Flow (orchestrator.rs:1122‚Äì1152)</h3>
      <p>
        When content enters the system, this flow is designed to show detection results to the user immediately:
      </p>
      <div class="flow-diagram">
Content received (document, email, etc.)
         ‚Üì
Run all 3 detectors in parallel
         ‚Üì
Any matches found?
  ‚îú‚îÄ No: process normally
  ‚îî‚îÄ Yes: collect into InjectionEvent
         ‚Üì
Emit InjectionEvent to UI layer
         ‚Üì
UI displays modal banner:
  "This document contains N injection patterns"
  Pattern table: (name, severity, location, context)
         ‚Üì
User clicks "Continue" or "Block"
         ‚Üì
If "Continue": log decision, proceed to data-plane processing
If "Block": return early, don't process content
         ‚Üì
Log event to session_log with:
  ‚îú‚îÄ timestamp
  ‚îú‚îÄ content_hash
  ‚îú‚îÄ all pattern matches
  ‚îú‚îÄ user decision
  ‚îî‚îÄ source (file/email/etc.)
      </div>
    </div>

    <div class="deep-section">
      <h3>Action Gate Enforcement</h3>
      <p>
        The gate is checked at three points in the execution pipeline, making bypass extremely difficult:
      </p>
      <div class="code-block"><code>// Point 1: Tool invocation (orchestrator.rs:587)
if let Err(e) = check_action_gate(current_plane, tool_action_level, approved) {
    return Err(format!("Action denied: {}", e));
}

// Point 2: Database mutation (db.rs:342)
pub async fn update_document(
    &amp;self,
    id: &amp;str,
    changes: DocumentPatch,
) -&gt; Result&lt;()&gt; {
    // All mutations require:
    let plane = context.current_plane();
    let level = ActionLevel::Modify;
    check_action_gate(plane, level, context.user_approved)?;
    // ... then execute
}

// Point 3: Skill execution (skills.rs:104)
pub async fn run_skill(
    &amp;self,
    skill_name: &amp;str,
    params: &amp;Map&lt;String, Value&gt;,
) -&gt; Result&lt;SkillOutput&gt; {
    let level = get_skill_gravity_level(skill_name);
    check_action_gate(Plane::Data, level, false)?;
    // For data plane: level &lt; Modify required, will error if skill is Modify+
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Why This Matters: Hard Barriers (UX Principle #6)</h3>
      <p>
        Sovereign's injection defense rests on three hard barriers designed to resist prompts or model output:
      </p>
      <ul class="concept-list">
        <li><strong>Structural capability denial:</strong> Data plane has no access to Modify/Transmit/Destruct tools at compile time. Not a prompt instruction‚Äîa missing function.</li>
        <li><strong>Plane enforcement:</strong> Every code path knows if it's executing user input or external data. The check is at the function signature level.</li>
        <li><strong>Detection & surfacing:</strong> Injection attempts are not filtered silently. They're surfaced to the user with full context, preserving autonomy while providing transparency.</li>
      </ul>
      <p style="margin-top: 12px;">
        Even if the LLM is compromised (jailbroken, fine-tuned to ignore safety), the architecture is designed to prevent it from:
        <ul class="concept-list" style="margin-top: 8px;">
          <li>Executing <code>delete_document</code> from a PDF</li>
          <li>Sending data from an email message</li>
          <li>Modifying thread metadata from search results</li>
        </ul>
      </p>
      <p style="margin-top: 12px;">
        These capabilities simply don't exist in the data plane's execution environment. The architecture itself prevents the attack.
      </p>
    </div>

  </div>
</section>

  </div>
</main>

</template>

<template id="page-action-gravity">
<main id="main" role="main">
<div class="content-inner">

<!-- ========== PAGE HEADER ========== -->
<div class="page-header">
  <h1>Action Gravity</h1>
  <p class="subtitle">
    Friction scales with irreversibility. The more permanent an action, the more confirmation it requires.
  </p>
</div>

<!-- ========== TIER 1: ELEVATOR PITCH ========== -->
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">Friction matches consequences</div>
    </div>
  </div>

  <div class="tier-1-content">
    <p>
      Not all actions are equal. In Sovereign, friction scales with irreversibility. Reading documents is instant.
      Editing requires conversational confirmation. Deleting triggers a modal with a 30-day undo window.
      This is Action Gravity: friction that matches consequence.
    </p>
  </div>
</section>

<!-- ========== TIER 2: HOW IT WORKS ========== -->
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Reading is instant, editing asks, deleting makes you pause</div>
    </div>
  </div>

  <div class="tier-2-content">

    <details open>
      <summary>The Five Levels</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>From Observe to Destruct</h3>
          <p>
            Every action in Sovereign maps to one of five levels, each with different confirmation requirements:
          </p>
          <ul class="concept-list">
            <li><strong>Level 0 ‚Äî Observe:</strong> Read documents, search, list threads. No confirmation needed. Instant.</li>
            <li><strong>Level 1 ‚Äî Annotate:</strong> Tag documents, bookmark pages. Toast notification only.</li>
            <li><strong>Level 2 ‚Äî Modify:</strong> Create, edit, rename documents. Conversational confirmation. Auto-approve after 5 consecutive approvals (per-action trust).</li>
            <li><strong>Level 3 ‚Äî Transmit:</strong> Export, share, send email. Explicit dialog. Never auto-approves.</li>
            <li><strong>Level 4 ‚Äî Destruct:</strong> Delete, purge. Modal dialog with 30-day undo window. Never auto-approves.</li>
          </ul>
          <p style="margin-top: 12px;">
            Friction increases with consequence. Reading is frictionless. Deletion requires active confirmation.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Trust Calibration: Per-Action, Not Global</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Learning Your Preferences</h3>
          <p>
            Sovereign doesn't ask the same question twice. It learns which actions you approve frequently and stops asking:
          </p>
          <ul class="concept-list">
            <li><strong>Consecutive approvals tracked:</strong> Each action type (e.g., "edit document") has its own counter.</li>
            <li><strong>Threshold of 5:</strong> After 5 consecutive approvals for the same action, Sovereign stops asking and auto-executes.</li>
            <li><strong>Rejection resets counter:</strong> Say "no" once and the counter resets to zero. You must re-approve 5 times.</li>
            <li><strong>Persistent in trust_state.json:</strong> Trust decisions persist across sessions. Your preferences are remembered.</li>
            <li><strong>Levels 3‚Äì4 never auto-approve:</strong> Transmit and Destruct always require explicit confirmation, no matter how many times you've approved.</li>
          </ul>
          <p style="margin-top: 12px;">
            This respects both safety (destructive actions require deliberation) and usability (you don't re-confirm routine edits).
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Hard Barriers: Code, Not Prompts</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Enforcement at the Execution Layer</h3>
          <p>
            These rules aren't encoded in the AI system prompt. They're enforced by the code that executes actions:
          </p>
          <ul class="concept-list">
            <li><strong>Transmit never auto-approves:</strong> <code>requires_user_confirmation</code> hardcoded for Level 3+, regardless of trust state.</li>
            <li><strong>Destruct never auto-approves:</strong> Modal dialog shown every time a Level 4 action is attempted.</li>
            <li><strong>30-second timeout:</strong> If user doesn't confirm within 30 seconds, action is cancelled. Prevents accidental approval via timeout.</li>
            <li><strong>Undo window:</strong> All deletions stored for 30 days before permanent purge. User can restore anytime in that window.</li>
          </ul>
          <p style="margin-top: 12px;">
            No prompt injection or jailbreak can bypass these rules. They're structural constraints, not behavioral guidelines.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>How AI Uses Action Gravity</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Chat System Prompt Encodes Gravity</h3>
          <p>
            The AI's system prompt educates it about Action Gravity:
          </p>
          <ul class="concept-list">
            <li><strong>Intent ‚Üí Action Type ‚Üí Gravity Level:</strong> The AI learns to map user intents ("delete this file") to action types (<code>delete_document</code>) to gravity levels (Level 4).</li>
            <li><strong>Proposal pattern for Level 2+:</strong> "For Level 2+ actions, propose with specifics and ask for confirmation." E.g., "Should I edit the document called 'Q4 Plan' to add the new budget?'"</li>
            <li><strong>No execution without approval:</strong> The AI generates proposals but doesn't execute Level 2+ actions until the user confirms.</li>
            <li><strong>Explain consequences:</strong> For Transmit and Destruct, the AI explains what will happen ("This will delete the document permanently" or "This will share the file with all users in the organization").</li>
          </ul>
          <p style="margin-top: 12px;">
            The AI becomes a thoughtful assistant, not a blind executor.
          </p>
        </div>
      </div>
    </details>

  </div>
</section>

<!-- ========== TIER 3: DEEP DIVE ========== -->
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Action Gravity</div>
    </div>
  </div>

  <div class="tier-3-content">

    <div class="deep-section">
      <h3>ActionLevel Enum (sovereign-core/src/security.rs:8‚Äì21)</h3>
      <p>
        The five levels are defined as an enum in the core library, ensuring type-safety and consistency across the codebase:
      </p>
      <div class="code-block"><code>pub enum ActionLevel {
    Observe = 0,      // Read-only; no confirmation
    Annotate = 1,     // Tag/bookmark; toast notification
    Modify = 2,       // Create/edit/rename; conversational confirmation
    Transmit = 3,     // Export/share; explicit dialog, never auto-approve
    Destruct = 4,     // Delete/purge; modal + 30-day undo, never auto-approve
}

impl ActionLevel {
    pub fn requires_user_confirmation(&self) -> bool {
        *self as u8 >= 2
    }

    pub fn can_auto_approve(&self) -> bool {
        *self as u8 <= 2  // Levels 0‚Äì2 only
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Confirmation Gate (action_gate.rs:42‚Äì44)</h3>
      <p>
        Before executing any action, the gate checks the level and trust state:
      </p>
      <div class="code-block"><code>pub async fn requires_confirmation(
    level: ActionLevel,
    action_name: &amp;str,
    trust_state: &amp;TrustTracker,
) -> bool {
    match level {
        // Levels 0‚Äì1: always execute
        ActionLevel::Observe | ActionLevel::Annotate => false,

        // Level 2: execute if auto-approved by trust
        ActionLevel::Modify => !trust_state.can_auto_approve(action_name),

        // Levels 3‚Äì4: always require confirmation
        ActionLevel::Transmit | ActionLevel::Destruct => true,
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>TrustTracker (trust.rs:15‚Äì108)</h3>
      <p>
        Tracks per-action trust and determines auto-approval eligibility:
      </p>
      <div class="code-block"><code>pub struct TrustTracker {
    actions: HashMap&lt;String, ActionTrust&gt;,
    persistence_path: PathBuf,
}

pub struct ActionTrust {
    pub consecutive_approvals: u32,
    pub last_rejection: Option&lt;Instant&gt;,
    pub threshold: u32,  // Typically 5
}

impl TrustTracker {
    pub fn record_approval(&amp;mut self, action_name: &amp;str) {
        let action = self.actions.entry(action_name.to_string())
            .or_insert_with(|| ActionTrust {
                consecutive_approvals: 0,
                last_rejection: None,
                threshold: 5,
            });
        action.consecutive_approvals += 1;
        self.save_to_disk().await;
    }

    pub fn record_rejection(&amp;mut self, action_name: &amp;str) {
        if let Some(action) = self.actions.get_mut(action_name) {
            action.consecutive_approvals = 0;
            action.last_rejection = Some(Instant::now());
        }
        self.save_to_disk().await;
    }

    pub fn can_auto_approve(&amp;self, action_name: &amp;str) -> bool {
        self.actions.get(action_name)
            .map(|a| a.consecutive_approvals >= a.threshold)
            .unwrap_or(false)
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Action Type to Level Mapping (security.rs:52‚Äì67)</h3>
      <p>
        Every action the user or AI can initiate maps to a specific level:
      </p>
      <table class="const-table">
        <tr><th>Action</th><th>Level</th><th>Description</th></tr>
        <tr><td><code>search_documents</code></td><td>0</td><td>Search workspace documents</td></tr>
        <tr><td><code>open_document</code></td><td>0</td><td>Open a document for reading</td></tr>
        <tr><td><code>list_threads</code></td><td>0</td><td>List all conversation threads</td></tr>
        <tr><td><code>tag_document</code></td><td>1</td><td>Add tag or label to document</td></tr>
        <tr><td><code>bookmark_page</code></td><td>1</td><td>Bookmark a page or section</td></tr>
        <tr><td><code>create_document</code></td><td>2</td><td>Create new document</td></tr>
        <tr><td><code>edit_document</code></td><td>2</td><td>Edit document content</td></tr>
        <tr><td><code>rename_document</code></td><td>2</td><td>Rename document or thread</td></tr>
        <tr><td><code>restore_document</code></td><td>2</td><td>Restore from trash/backup</td></tr>
        <tr><td><code>export_document</code></td><td>3</td><td>Export to file (PDF, email, etc.)</td></tr>
        <tr><td><code>share_document</code></td><td>3</td><td>Share with other users</td></tr>
        <tr><td><code>transmit_message</code></td><td>3</td><td>Send email or message</td></tr>
        <tr><td><code>pair_device</code></td><td>3</td><td>Pair new trusted device</td></tr>
        <tr><td><code>enroll_guardian</code></td><td>3</td><td>Enroll social recovery guardian</td></tr>
        <tr><td><code>delete_document</code></td><td>4</td><td>Delete document (moves to trash)</td></tr>
        <tr><td><code>purge_document</code></td><td>4</td><td>Permanently delete (skip trash)</td></tr>
        <tr><td><code>delete_thread</code></td><td>4</td><td>Delete conversation thread</td></tr>
        <tr><td><code>revoke_guardian</code></td><td>4</td><td>Revoke social recovery guardian</td></tr>
      </table>
    </div>

    <div class="deep-section">
      <h3>Confirmation Flow (orchestrator.rs:474)</h3>
      <p>
        When the AI proposes an action, this flow determines what confirmation (if any) is needed:
      </p>
      <div class="flow-diagram">
User input received
         ‚Üì
Router classifies intent
         ‚Üì
Map intent to action_type
         ‚Üì
Map action_type to ActionLevel
         ‚Üì
check_action_gate(level, trust_state)
         ‚Üì
If level requires confirmation:
  ‚îú‚îÄ Show dialog (Level 2: chat, Level 3: explicit, Level 4: modal)
  ‚îú‚îÄ Wait for user approval
  ‚îú‚îÄ Record approval/rejection in TrustTracker
  ‚îî‚îÄ If Level 4: add to trash, schedule 30-day purge
         ‚Üì
If user approved:
  ‚îú‚îÄ Execute action
  ‚îî‚îÄ Log to audit trail
         ‚Üì
If user rejected:
  ‚îú‚îÄ Return early
  ‚îî‚îÄ Reset trust counter for that action
      </div>
    </div>

    <div class="deep-section">
      <h3>Trust State Persistence (trust_state.json)</h3>
      <p>
        User trust decisions are saved to disk and loaded on startup, ensuring preferences persist across sessions:
      </p>
      <div class="code-block"><code>{
  "actions": {
    "edit_document": {
      "consecutive_approvals": 5,
      "last_rejection": null,
      "threshold": 5,
      "auto_approved": true
    },
    "create_document": {
      "consecutive_approvals": 3,
      "last_rejection": null,
      "threshold": 5,
      "auto_approved": false
    },
    "delete_document": {
      "consecutive_approvals": 0,
      "last_rejection": "2026-02-22T14:23:00Z",
      "threshold": 5,
      "auto_approved": false
    }
  },
  "last_updated": "2026-02-22T16:45:00Z"
}</code></div>
      <p style="margin-top: 12px;">
        This structure allows Sovereign to learn your behavior without requiring re-confirmation for routine actions.
      </p>
    </div>

    <div class="deep-section">
      <h3>Design Principles</h3>
      <p>
        Action Gravity is built on several core principles:
      </p>
      <ul class="concept-list">
        <li><strong>Per-action trust:</strong> Not global. Each action (e.g., "edit document") has its own trust threshold.</li>
        <li><strong>Rejection resets:</strong> One "no" resets the counter to zero. Trust must be re-established.</li>
        <li><strong>Levels 3‚Äì4 sacred:</strong> Transmit and Destruct actions never auto-approve, no matter how much trust is built.</li>
        <li><strong>30-day undo window:</strong> All deletions are reversible for 30 days. True permanence requires deliberate purge.</li>
        <li><strong>Transparent thresholds:</strong> Users can see which actions are auto-approved and how close they are to auto-approval.</li>
        <li><strong>Consequence-aware:</strong> Friction scales with consequence. Reading has zero friction. Deletion has maximum friction.</li>
      </ul>
    </div>

  </div>
</section>

  </div>
</main>

</template>

<template id="page-encryption">
<main id="main" role="main">
<div class="content-inner">

<!-- ========== PAGE HEADER ========== -->
<div class="page-header">
  <h1>Encryption & Key Management</h1>
  <p class="subtitle">
    How Sovereign protects your documents with modern encryption, multi-level key hierarchies,
    and cryptographic protections.
  </p>
</div>

<!-- ========== TIER 1: ELEVATOR PITCH ========== -->
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">Zero plaintext, ever</div>
    </div>
  </div>

  <div class="tier-1-content">
    <p>
      Every document is encrypted with its own unique key. Keys are derived from a single master key only you control.
      Stolen hard drive = encrypted noise. Stolen document key = one document. Stolen master key = catastrophic
      (but guardian recovery protects you). Modern cipher (XChaCha20-Poly1305). No backdoors.
    </p>
  </div>
</section>

<!-- ========== TIER 2: HOW IT WORKS ========== -->
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Every document gets its own key, wrapped in layers that rotate automatically</div>
    </div>
  </div>

  <div class="tier-2-content">

    <details open>
      <summary>XChaCha20-Poly1305</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Modern AEAD Cipher. Same as WireGuard and Signal.</h3>
          <ul class="concept-list">
            <li><strong>Algorithm:</strong> XChaCha20 (stream cipher) + Poly1305 (MAC). Authenticated encryption with associated data (AEAD).</li>
            <li><strong>Key size:</strong> 256-bit keys. No weakness in the cryptography.</li>
            <li><strong>Nonce size:</strong> 192-bit nonces (24 bytes). Large nonce space = negligible collision risk even for billions of messages.</li>
            <li><strong>Speed:</strong> Fast on modern CPUs. No hardware acceleration needed (unlike AES-NI dependency).</li>
            <li><strong>Side-channel resistant:</strong> Designed to prevent timing attacks. Constant-time operations throughout.</li>
            <li><strong>Provenance:</strong> Published in RFC 8439. Peer-reviewed. Used by WireGuard, Signal, and other cryptographically rigorous systems.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Four-Level Key Hierarchy</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Master ‚Üí Device ‚Üí KEK ‚Üí Document Keys</h3>
          <ul class="concept-list">
            <li><strong>Master Key (32 bytes):</strong> You control this alone. Never synced. Stored in OS keyring or hardware wallet. Derivation: passphrase + salt via HKDF-SHA256.</li>
            <li><strong>Device Key (32 bytes):</strong> Derived from Master + device_id via HKDF. Per-device, so revoke one device without affecting others.</li>
            <li><strong>KEK (Key Encryption Key, 32 bytes):</strong> Random per encryption epoch. Wraps all document keys for that epoch. Enables rotation without re-encrypting documents.</li>
            <li><strong>Document Keys (32 bytes each):</strong> One per document. Encrypts the document content. Wrapped with KEK for storage.</li>
          </ul>
          <p style="margin-top: 12px;">
            Why this hierarchy? <strong>Isolation:</strong> A compromised document key exposes one document. <strong>Rotation:</strong> Update KEK without re-encrypting all documents. <strong>Revocation:</strong> Remove a device without re-keying everything.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Key Rotation</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Epoch Numbers Enable Seamless Rotation</h3>
          <ul class="concept-list">
            <li><strong>Epoch number:</strong> An incrementing integer stored with each wrapped key. Old data readable with old KEKs, new data uses new KEK.</li>
            <li><strong>Zero re-encryption:</strong> You can rotate the KEK without decrypting and re-encrypting all document content. New keys wrap with the new KEK, old keys unwrap with the old KEK.</li>
            <li><strong>Automatic rotation:</strong> Rotate weekly or monthly (configurable). The system tracks which documents need re-wrapping and does it in the background.</li>
            <li><strong>Multi-epoch reading:</strong> The decryption routine tries all available KEKs for the epoch chain. If epoch 5 KEK fails, try epoch 4, etc.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Memory Safety</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Zero Key Material Left in RAM</h3>
          <ul class="concept-list">
            <li><strong>Zeroize trait:</strong> All key types implement <code>Zeroize</code> and <code>ZeroizeOnDrop</code>. When a key goes out of scope, its bytes are overwritten with zeros.</li>
            <li><strong>No copies:</strong> Keys are moved, not cloned. Prevents accidental duplication in memory.</li>
            <li><strong>Debug output redaction:</strong> Custom <code>Debug</code> impl for key types. Printing a key yields <code>"MasterKey(***REDACTED***)"</code>, never the actual bytes.</li>
            <li><strong>Stack safety:</strong> Stack buffers used in crypto routines are also zeroized. No leftover ciphertext or plaintext on the stack after decryption.</li>
            <li><strong>No serialization:</strong> Keys are not Serialize/Deserialize. Can't accidentally JSON-dump your keys.</li>
          </ul>
        </div>
      </div>
    </details>

  </div>
</section>

<!-- ========== TIER 3: DEEP DIVE ========== -->
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Encryption & Key Management</div>
    </div>
  </div>

  <div class="tier-3-content">

    <div class="deep-section">
      <h3>aead.rs ‚Äî Low-Level Encryption (sovereign-crypto/src/aead.rs)</h3>
      <p>
        The AEAD cipher is the cryptographic foundation. This module exports encrypt and decrypt functions.
      </p>
      <div class="const-table">
        <tr><th>Constant</th><th>Value</th><th>Purpose</th></tr>
        <tr><td><code>KEY_SIZE</code></td><td>32 bytes</td><td>XChaCha20-Poly1305 key length (256 bits).</td></tr>
        <tr><td><code>NONCE_SIZE</code></td><td>24 bytes</td><td>XChaCha20 nonce length (192 bits).</td></tr>
      </table>
      <div class="code-block"><code>pub fn encrypt(plaintext: &[u8], key: &[u8; KEY_SIZE]) -> Result<(Vec<u8>, [u8; NONCE_SIZE])> {
    let nonce = OsRng.gen::<[u8; NONCE_SIZE]>();
    let cipher = XChaCha20Poly1305::new(&key.into());
    let ciphertext = cipher.encrypt(&nonce.into(), plaintext)
        .map_err(|_| Error::EncryptionFailed)?;
    Ok((ciphertext, nonce))
}

pub fn decrypt(ciphertext: &[u8], nonce: &[u8; NONCE_SIZE], key: &[u8; KEY_SIZE]) -> Result<Vec<u8>> {
    let cipher = XChaCha20Poly1305::new(&key.into());
    let plaintext = cipher.decrypt(&nonce.into(), ciphertext)
        .map_err(|_| Error::DecryptionFailed)?;
    Ok(plaintext)
}</code></div>
    </div>

    <div class="deep-section">
      <h3>MasterKey (sovereign-crypto/src/keys.rs:10‚Äì40)</h3>
      <p>
        The master key is the root of the key hierarchy. Never leave the device unless recovered by a guardian.
      </p>
      <div class="code-block"><code>pub struct MasterKey {
    bytes: [u8; 32],
}

impl MasterKey {
    pub fn generate() -> Self {
        let mut bytes = [0u8; 32];
        OsRng.fill(&mut bytes);
        MasterKey { bytes }
    }

    pub fn from_passphrase(passphrase: &str, salt: &[u8; 16]) -> Self {
        let mut key = [0u8; 32];
        Hkdf::<Sha256>::new(Some(salt), passphrase.as_bytes())
            .expand(b"sovereign-master-key", &mut key)
            .unwrap();
        MasterKey { bytes: key }
    }
}

impl Zeroize for MasterKey {
    fn zeroize(&mut self) {
        self.bytes.zeroize();
    }
}

impl ZeroizeOnDrop for MasterKey {}</code></div>
    </div>

    <div class="deep-section">
      <h3>DeviceKey (sovereign-crypto/src/keys.rs:42‚Äì65)</h3>
      <p>
        Device keys are derived from the master key, scoped to a device ID. Enables per-device revocation.
      </p>
      <div class="code-block"><code>pub struct DeviceKey {
    bytes: [u8; 32],
}

impl DeviceKey {
    pub fn derive(master: &MasterKey, device_id: &str) -> Self {
        let mut key = [0u8; 32];
        let info = format!("sovereign-device:{}", device_id).into_bytes();
        Hkdf::<Sha256>::new(None, &master.bytes)
            .expand(&info, &mut key)
            .unwrap();
        DeviceKey { bytes: key }
    }

    pub fn wrap_kek(&self, kek: &Kek) -> Result<WrappedKek> {
        let (ciphertext, nonce) = aead::encrypt(&kek.bytes, &self.bytes)?;
        Ok(WrappedKek { ciphertext, nonce })
    }

    pub fn unwrap_kek(&self, wrapped: &WrappedKek) -> Result<Kek> {
        let bytes = aead::decrypt(&wrapped.ciphertext, &wrapped.nonce, &self.bytes)?;
        Ok(Kek { bytes: bytes.try_into()? })
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>KEK ‚Äî Key Encryption Key (sovereign-crypto/src/keys.rs:67‚Äì85)</h3>
      <p>
        KEKs wrap document keys. New KEK per epoch enables rotation without re-encrypting documents.
      </p>
      <div class="code-block"><code>pub struct Kek {
    bytes: [u8; 32],
}

impl Kek {
    pub fn generate() -> Self {
        let mut bytes = [0u8; 32];
        OsRng.fill(&mut bytes);
        Kek { bytes }
    }

    pub fn wrap_document_key(&self, doc_key: &DocumentKey, epoch: u32) -> Result<WrappedDocumentKey> {
        let mut payload = Vec::new();
        payload.extend_from_slice(&doc_key.bytes);
        payload.extend_from_slice(&epoch.to_le_bytes());
        let (ciphertext, nonce) = aead::encrypt(&payload, &self.bytes)?;
        Ok(WrappedDocumentKey { ciphertext, nonce, epoch })
    }

    pub fn unwrap_document_key(&self, wrapped: &WrappedDocumentKey) -> Result<DocumentKey> {
        let plaintext = aead::decrypt(&wrapped.ciphertext, &wrapped.nonce, &self.bytes)?;
        let key_bytes: [u8; 32] = plaintext[..32].try_into()?;
        Ok(DocumentKey { bytes: key_bytes })
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>DocumentKey (sovereign-crypto/src/keys.rs:87‚Äì110)</h3>
      <p>
        Each document has a unique key. Encrypts and decrypts document content.
      </p>
      <div class="code-block"><code>pub struct DocumentKey {
    bytes: [u8; 32],
}

impl DocumentKey {
    pub fn generate() -> Self {
        let mut bytes = [0u8; 32];
        OsRng.fill(&mut bytes);
        DocumentKey { bytes }
    }

    pub fn encrypt_content(&self, content: &[u8]) -> Result<EncryptedContent> {
        let (ciphertext, nonce) = aead::encrypt(content, &self.bytes)?;
        Ok(EncryptedContent { ciphertext, nonce })
    }

    pub fn decrypt_content(&self, encrypted: &EncryptedContent) -> Result<Vec<u8>> {
        aead::decrypt(&encrypted.ciphertext, &encrypted.nonce, &self.bytes)
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Per-Document Encryption Flow</h3>
      <p>
        Here's the full lifecycle of encrypting and storing a document.
      </p>
      <div class="flow-diagram">
User creates document
  ‚Üì
Generate DocumentKey (32 random bytes)
  ‚Üì
Encrypt content with DocumentKey
  ‚Üì
Wrap DocumentKey with current KEK (+ epoch)
  ‚Üì
Store in DB:
  ‚îú‚îÄ document_id
  ‚îú‚îÄ encrypted_content (ciphertext + nonce)
  ‚îú‚îÄ wrapped_document_key (ciphertext + nonce + epoch)
  ‚îî‚îÄ encrypted_metadata
  ‚Üì
On read:
  ‚îú‚îÄ Fetch wrapped_document_key from DB
  ‚îú‚îÄ Unwrap with KEK matching epoch
  ‚îú‚îÄ Unwrap encrypted_content with DocumentKey
  ‚îî‚îÄ Return plaintext
      </div>
    </div>

    <div class="deep-section">
      <h3>Key Sizes Summary</h3>
      <p>
        All key material is 256-bit (32 bytes). Nonces are 192-bit (24 bytes) to ensure collision resistance.
      </p>
      <div class="const-table">
        <tr><th>Key / Nonce Type</th><th>Size</th><th>Bit Strength</th><th>Storage</th></tr>
        <tr><td>Master Key</td><td>32 bytes</td><td>256 bits</td><td>OS keyring (never synced)</td></tr>
        <tr><td>Device Key</td><td>32 bytes</td><td>256 bits</td><td>Derived on-demand from Master</td></tr>
        <tr><td>KEK (per epoch)</td><td>32 bytes</td><td>256 bits</td><td>Wrapped by Device Key, stored in DB</td></tr>
        <tr><td>Document Key</td><td>32 bytes</td><td>256 bits</td><td>Wrapped by KEK, stored in DB</td></tr>
        <tr><td>XChaCha20 Nonce</td><td>24 bytes</td><td>192 bits</td><td>Stored alongside ciphertext</td></tr>
      </table>
    </div>

    <div class="deep-section">
      <h3>Threat Model & Guarantees</h3>
      <p>
        Encryption provides confidentiality and integrity. Here's what we protect against and what we don't.
      </p>
      <div class="code-block"><code>// Protects against:
// - Disk theft: Hard drive stolen = all documents are encrypted noise (no plaintext)
// - Network interception: Ciphertext + nonce are safe in transit (authenticated)
// - Single-document compromise: One doc key stolen = one doc readable, others safe
// - Passive timing attacks: XChaCha20-Poly1305 is constant-time

// Does NOT protect against:
// - Master key theft: If attacker has Master Key, all devices are compromised
//   ‚Üí Guardian social recovery mitigates this
// - Cold-boot attacks: Plaintext in RAM during decryption (mitigated by zeroize + short windows)
// - Side-channel attacks on hardware: CPU cache, power analysis (cryptographer's problem, not ours)
// - Metadata: Document titles, timestamps, relationships are still readable from DB structure
//   ‚Üí Encrypted filenames + encrypted schema coming in v2</code></div>
    </div>

  </div>
</section>

  </div>
</main>

</template>

<template id="page-social-recovery">
<main id="main" role="main">
<div class="content-inner">

<!-- ========== PAGE HEADER ========== -->
<div class="page-header">
  <h1>Guardian Social Recovery</h1>
  <p class="subtitle">
    Recover your account with help from trusted people. No corporation involved. Your data stays encrypted throughout.
  </p>
</div>

<!-- ========== TIER 1: ELEVATOR PITCH ========== -->
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">People, not corporations</div>
    </div>
  </div>

  <div class="tier-1-content">
    <p>
      Lose all your devices? Five trusted people each hold an encrypted piece of your recovery key. No piece works alone.
      Any three together can help you recover. A 72-hour waiting period with notifications to all guardians stops fraud.
      No corporation is involved.
    </p>
  </div>
</section>

<!-- ========== TIER 2: HOW IT WORKS ========== -->
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Five trusted guardians, three needed to recover, seventy-two hours to cancel fraud</div>
    </div>
  </div>

  <div class="tier-2-content">

    <details open>
      <summary>Shamir's Secret Sharing</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>50-Year-Old Math Behind the Magic</h3>
          <p>
            Shamir's Secret Sharing (SSS) is a cryptographic scheme invented by Adi Shamir in 1979.
            It splits a secret (your master recovery key) into pieces called shares with a critical property:
          </p>
          <ul class="concept-list">
            <li><strong>Master key ‚Üí 5 shards:</strong> Your recovery key is split using SSS with parameters (k=3, n=5). This means exactly 5 shards are created.</li>
            <li><strong>Any 3 shards reconstruct:</strong> Any subset of 3 or more shards can mathematically reconstruct the original key. Fewer than 3 shards reveal nothing.</li>
            <li><strong>Each shard is encrypted:</strong> Before giving shard #i to guardian i, we encrypt it with their public key. Guardians are not given access to your data. They see only an opaque encrypted blob.</li>
            <li><strong>Guardians are isolated:</strong> Each guardian holds one shard and knows only their own encrypted piece. They cannot derive your key from just their shard, nor can they see what other guardians hold.</li>
          </ul>
          <p style="margin-top: 12px;">
            This mathematically guarantees that even if 2 guardians leak their shards to an attacker, the attacker cannot recover your key.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>The 72-Hour Fraud Window</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Recovery Broadcast with Human Verification</h3>
          <p>
            When someone claims they lost their devices and initiates recovery, the system broadcasts a notification to all 5 guardians.
            But it doesn't proceed immediately. Instead, it enforces a 72-hour waiting period:
          </p>
          <ul class="concept-list">
            <li><strong>Initiate recovery:</strong> Attacker (impersonating you) or real you initiates a recovery request via the login screen.</li>
            <li><strong>Notify all guardians:</strong> All 5 guardians receive a message: "Recovery initiated for account ID X. Approve or reject within 72 hours."</li>
            <li><strong>72-hour window:</strong> If you're the real user and didn't lose your devices, you see the notification and can abort immediately. Aborting stops the entire recovery process.</li>
            <li><strong>Collect approvals:</strong> After 72 hours, if not aborted, the system collects approval responses from guardians. As soon as 3 approve, recovery proceeds.</li>
            <li><strong>No response = passive approval:</strong> Guardians who ignore the notification are treated as implicit approval after 72 hours (you can tune this).</li>
          </ul>
          <p style="margin-top: 12px;">
            This design catches most attackers: a real attacker would need your device to abort the notification, defeating the point of recovery.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Recovery Flow</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>State Machine: From Initiation to Completion</h3>
          <p>
            Recovery progresses through well-defined states. At any point, the real user can abort.
          </p>
          <ul class="concept-list">
            <li><strong>Initiate:</strong> User enters recovery ID and initiates a RecoveryRequest. State ‚Üí WaitingPeriod. Timestamp: now.</li>
            <li><strong>Waiting Period (72h):</strong> All guardians notified. If real user sees notification and clicks "Abort", state ‚Üí Aborted immediately. Otherwise, wait.</li>
            <li><strong>After 72h Expires:</strong> State ‚Üí AwaitingShards. System begins collecting encrypted shards from guardians who approved.</li>
            <li><strong>Collect Shards (n ‚â• 3):</strong> As each guardian submits their encrypted shard, we store it. Once 3+ shards collected, state ‚Üí Reconstructing.</li>
            <li><strong>Reconstruct:</strong> Decrypt all collected shards using user's private key, apply Shamir reconstruction, recover master key. State ‚Üí Complete.</li>
            <li><strong>Complete:</strong> User can now unlock their account with the recovered key. Recovery request record closed.</li>
            <li><strong>Abort (any state):</strong> User can abort from WaitingPeriod or AwaitingShards. State ‚Üí Aborted. No recovery happens. Audit log recorded.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>What Guardians See</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Minimal Information, Maximum Privacy</h3>
          <p>
            Guardians receive notifications and prompts, but they see nothing about your data or identity beyond what's necessary.
          </p>
          <ul class="concept-list">
            <li><strong>Recovery ID:</strong> A unique identifier like "recovery_abc123def456". No name attached.</li>
            <li><strong>Action prompt:</strong> "Do you want to help recover this account? Approve/Reject."</li>
            <li><strong>Encrypted shard:</strong> If they approve, they submit a blob that looks like random bytes. They cannot decrypt it, inspect it, or derive meaning from it.</li>
            <li><strong>No data visibility:</strong> Guardians do not have access to your documents, emails, contacts, or any personal information.</li>
            <li><strong>No identifying info:</strong> They don't see your real name, email, or account handle in the recovery process.</li>
          </ul>
          <p style="margin-top: 12px;">
            This keeps guardians in a "black box" position: they help recover an account without knowing anything about it.
          </p>
        </div>
      </div>
    </details>

  </div>
</section>

<!-- ========== TIER 3: DEEP DIVE ========== -->
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Guardian Social Recovery</div>
    </div>
  </div>

  <div class="tier-3-content">

    <div class="deep-section">
      <h3>Shamir Implementation (blahaj crate)</h3>
      <p>
        We use the <code>blahaj</code> crate for Shamir's Secret Sharing. The API is simple and secure.
      </p>
      <div class="code-block"><code>use blahaj::shamir;

// Split master key into 5 shards, threshold = 3
let master_key: [u8; 32] = generate_random_key();
let shards = shamir::split(&amp;master_key, 3, 5)?;
// shards: Vec&lt;Share&gt; with len == 5

// Reconstruct from any 3+ shards
let recovered = shamir::reconstruct(&amp;shards[0..3])?;
// recovered: [u8; 32] == master_key

// Each shard is encrypted with guardian's public key
for (i, shard) in shards.iter().enumerate() {
    let guardian_pubkey = get_guardian_pubkey(i);
    let encrypted_shard = encrypt_with_public_key(shard, guardian_pubkey);
    store_shard_for_guardian(i, encrypted_shard);
}</code></div>
      <p style="margin-top: 12px;">
        The blahaj crate handles all Lagrange interpolation and finite field arithmetic. We only provide threshold, total, and the secret.
      </p>
    </div>

    <div class="deep-section">
      <h3>Data Structures</h3>
      <p>
        Core types used in the recovery module (sovereign-db/src/schema.rs and sovereign-crypto/src/guardian.rs).
      </p>
      <div class="code-block"><code>// Encrypted shard stored for each guardian
pub struct Shard {
    pub shard_id: u32,  // Index 1‚Äì5
    pub encrypted_data: Vec&lt;u8&gt;,  // AES-256-GCM(shard_blob, guardian_pubkey)
    pub for_user_id: String,  // User's account ID
    pub guardian_pubkey_fingerprint: String,  // SHA-256(guardian_pubkey)
    pub created_at: DateTime&lt;Utc&gt;,
    pub epoch: u64,  // Prevents replay attacks
}

// Recovery request lifecycle
pub struct RecoveryRequest {
    pub recovery_id: String,  // Unique ID like recovery_abc123
    pub state: RecoveryState,  // WaitingPeriod, AwaitingShards, Reconstructing, Complete, Aborted
    pub initiated_at: DateTime&lt;Utc&gt;,
    pub waiting_period_ends: DateTime&lt;Utc&gt;,  // initiated_at + 72h
    pub threshold: u32,  // 3
    pub total_shards: u32,  // 5
    pub guardian_responses: HashMap&lt;u32, GuardianResponse&gt;,  // shard_id ‚Üí Approved, Rejected, Pending
    pub collected_shards: Vec&lt;Shard&gt;,  // Encrypted shards submitted by guardians
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Recovery State Machine</h3>
      <p>
        Recovery progresses through well-defined states managed by the orchestrator.
      </p>
      <div class="flow-diagram">
User initiates recovery
         ‚Üì
Create RecoveryRequest
  state = WaitingPeriod
  waiting_period_ends = now + 72h
         ‚Üì
Broadcast notification to all 5 guardians
         ‚Üì
Guardian can:
  ‚îú‚îÄ Approve ‚Üí response set to Approved
  ‚îú‚îÄ Reject ‚Üí response set to Rejected
  ‚îî‚îÄ (no response) ‚Üí Pending
         ‚Üì
If user aborts within 72h:
  ‚îî‚îÄ state = Aborted, return
         ‚Üì
After 72h expires:
  state = AwaitingShards
  collect_shards_from_approved_guardians()
         ‚Üì
Once ‚â• 3 shards collected:
  state = Reconstructing
  master_key = shamir::reconstruct(shards_decrypted)
         ‚Üì
state = Complete
  user can now unlock account
      </div>
    </div>

    <div class="deep-section">
      <h3>Abort Mechanism</h3>
      <p>
        At any time during WaitingPeriod or AwaitingShards, the real user can abort recovery if they regain access to their account.
      </p>
      <div class="code-block"><code>pub async fn abort_recovery(
    recovery_id: &amp;str,
    user_id: &amp;str,
    db: &amp;Surreal,
) -&gt; Result&lt;()&gt; {
    let mut req = db.get_recovery_request(recovery_id).await?;

    // Only allow abort from safe states
    if !matches!(req.state, RecoveryState::WaitingPeriod | RecoveryState::AwaitingShards) {
        return Err("Recovery cannot be aborted from this state");
    }

    // Verify ownership
    if req.initiated_by != user_id {
        log_security_event("recovery_abort_unauthorized", user_id, recovery_id);
        return Err("Unauthorized");
    }

    // Mark as aborted
    req.state = RecoveryState::Aborted;
    req.aborted_at = Some(Utc::now());
    db.update_recovery_request(&amp;req).await?;

    // Notify all guardians
    notify_guardians_of_abort(recovery_id).await?;

    // Audit log
    log_recovery_event("abort", recovery_id, user_id);

    Ok(())
}</code></div>
      <p style="margin-top: 12px;">
        This is designed so that a malicious initiator cannot force recovery if the real user notices and can abort.
      </p>
    </div>

    <div class="deep-section">
      <h3>Security Properties</h3>
      <p>
        The recovery system is designed with threat modeling in mind. Here are the key security properties:
      </p>
      <ul class="concept-list">
        <li><strong>Master key stays in memory:</strong> The recovered key exists only in RAM during reconstruction. It is not logged, cached, or transmitted over the network by design.</li>
        <li><strong>Guardians are isolated:</strong> Each guardian only holds one encrypted shard. They cannot collude offline to reconstruct the key. Communication happens only through the system.</li>
        <li><strong>Epoch tracking:</strong> Each shard includes an epoch counter. Shards from old epochs are rejected. This prevents replay attacks where an attacker uses a captured shard multiple times.</li>
        <li><strong>Threat: fewer than 3 shards compromised:</strong> Useless. Mathematical guarantee: SSS with k=3 means &lt;3 shards leak zero information about the master key.</li>
        <li><strong>Threat: exactly 3 shards compromised:</strong> Attacker can reconstruct, but must wait 72h for real user to either abort or for the system to verify 3 guardian approvals. High friction.</li>
        <li><strong>Threat: 3+ guardians compromised:</strong> Attacker can reconstruct immediately after 72h. But this requires compromising 60% of guardians, which is a high bar for social engineering.</li>
        <li><strong>Threat: impersonation:</strong> Attacker initiates recovery under your account. But you see the 72h notification on any of your devices and abort. Attacker foiled unless they also compromised all your devices.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Module Organization</h3>
      <p>
        Guardian recovery is implemented in the <code>sovereign-crypto</code> crate under the <code>guardian/</code> subdirectory.
      </p>
      <div class="code-block"><code>sovereign-crypto/src/guardian/
‚îú‚îÄ‚îÄ mod.rs             // Public API + re-exports
‚îú‚îÄ‚îÄ shamir.rs          // Shamir split/reconstruct wrappers
‚îú‚îÄ‚îÄ shard.rs           // Shard struct + encryption/decryption
‚îú‚îÄ‚îÄ recovery.rs        // RecoveryRequest + state machine
‚îú‚îÄ‚îÄ notification.rs    // Guardian notification dispatch
‚îî‚îÄ‚îÄ audit.rs           // Audit logging for recovery events</code></div>
      <ul class="concept-list">
        <li><code>shamir.rs</code> ‚Äî Thin wrapper around <code>blahaj</code> crate. Handles key serialization.</li>
        <li><code>shard.rs</code> ‚Äî Shard struct, encryption with guardian public keys, decryption with user's private key.</li>
        <li><code>recovery.rs</code> ‚Äî RecoveryRequest struct, state transitions, abort logic, shard collection.</li>
        <li><code>notification.rs</code> ‚Äî Sending notifications to guardians (email, push, or local UI depending on deployment).</li>
        <li><code>audit.rs</code> ‚Äî Logging every state change, abort, approval, rejection for compliance and debugging.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Performance Notes</h3>
      <p>
        Social recovery should be infrequent, but when it happens, latency matters. Here are the performance characteristics:
      </p>
      <div class="const-table">
        <tr><th>Operation</th><th>Complexity</th><th>Typical Time</th><th>Notes</th></tr>
        <tr><td>Split (SSS)</td><td>O(k √ó n)</td><td>1‚Äì5 ms</td><td>k=3, n=5 is trivial. Dominated by random number generation.</td></tr>
        <tr><td>Reconstruct (SSS)</td><td>O(k¬≤)</td><td>1‚Äì5 ms</td><td>Lagrange interpolation over finite field. k=3 is very fast.</td></tr>
        <tr><td>Encrypt shard (AES-256-GCM)</td><td>O(shard_size)</td><td>&lt;1 ms per shard</td><td>Shards are small (~32 bytes each). Negligible overhead.</td></tr>
        <tr><td>Decrypt shard (AES-256-GCM)</td><td>O(shard_size)</td><td>&lt;1 ms per shard</td><td>Per-shard decryption during reconstruction.</td></tr>
        <tr><td>Total recovery latency</td><td>‚Äî</td><td>10‚Äì50 ms</td><td>Excludes network I/O and 72h waiting period.</td></tr>
      </div>
    </div>

  </div>
</section>

</div>
</main>
</template>

<template id="page-spatial-canvas">
<main id="main" role="main">
<div class="content-inner">

<!-- ========== PAGE HEADER ========== -->
<div class="page-header">
  <h1>Spatial Canvas & Versioning</h1>
  <p class="subtitle">
    Your documents live on an infinite canvas. Time runs left to right. Projects run top to bottom.
    Every edit is automatically remembered.
  </p>
</div>

<!-- ========== TIER 1: ELEVATOR PITCH ========== -->
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">Self-organizing workspace</div>
    </div>
  </div>

  <div class="tier-1-content">
    <p>
      Imagine your workspace as a living map. Documents on an infinite canvas. Time runs left‚Üíright. Projects run top‚Üíbottom.
      Owned content is rectangles; external is parallelograms. Every document remembers its complete edit history‚Äîautomatically,
      invisibly. No save button. No lost work.
    </p>
  </div>
</section>

<!-- ========== TIER 2: HOW IT WORKS ========== -->
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Scroll through topics, go back in time, see everything at once or zoom in on a detail</div>
    </div>
  </div>

  <div class="tier-2-content">

    <details open>
      <summary>The Two Axes</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Horizontal: Timeline. Vertical: Intent Threads.</h3>
          <p>
            The canvas has two organizing dimensions:
          </p>
          <ul class="concept-list">
            <li><strong>Horizontal axis:</strong> Time. Past on the left, future on the right. A month-year ruler marks eras. Earlier edits live left; recent work drifts right.</li>
            <li><strong>Vertical axis:</strong> Intent Threads (projects). Each row is a lane. "Q1 Planning" lane stays in place. Documents within that lane can slide left/right in time, but stay in the same lane.</li>
            <li><strong>Layout invariant:</strong> A document's vertical position = its thread. Its horizontal position = when it was created or last touched.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Three Zoom Levels</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Dots ‚Üí Blocks ‚Üí Full Cards</h3>
          <ul class="concept-list">
            <li><strong>Dots (zoom &lt; 0.3):</strong> Each document is a single colored dot. Color = intent thread. Useful for seeing structure at 10,000 feet.</li>
            <li><strong>Simplified (0.3‚Äì0.6):</strong> Small blocks with document title (truncated). Relationships shown as thin lines.</li>
            <li><strong>Full (‚â• 0.6):</strong> Complete card: title, preview snippet, last-edited timestamp, relationships as curves, ownership badge.</li>
          </ul>
          <p style="margin-top: 12px;">
            Zoom transitions are smooth. No jank. Renderer culls off-screen cards automatically.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Sovereignty Halo: Owned vs External</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Shape Encodes Ownership</h3>
          <ul class="concept-list">
            <li><strong>Owned:</strong> Rounded rectangles. Sharp 90¬∞ corners softened to 8px radius.</li>
            <li><strong>External:</strong> Parallelograms (4¬∞ skew). Sheared edge signals "from outside".</li>
            <li><strong>Preattentive processing:</strong> Your eye catches shape before reading title. Ownership is instant.</li>
            <li><strong>Visual feedback:</strong> Hover any card: border glows, provenance label appears ("(owned)" or "(external)").</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Relationships: A Web of Connections</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Six Link Types, Drawn as Curves</h3>
          <ul class="concept-list">
            <li><strong>References:</strong> Dashed blue line. "This mentions that."</li>
            <li><strong>DerivedFrom:</strong> Solid green arrow. "This version came from that version."</li>
            <li><strong>Continues:</strong> Dotted orange line. "This follows from that in narrative sequence."</li>
            <li><strong>Contradicts:</strong> Red X marker. "This conflicts with that."</li>
            <li><strong>Supports:</strong> Solid teal line. "This backs up that claim."</li>
            <li><strong>AttachedTo:</strong> Gray bracket. "This is metadata for that (e.g., a comment or tag)."</li>
          </ul>
          <p style="margin-top: 12px;">
            Curves flow across lanes, never overlapping (forced layout prevents spaghetti). Hover a card to highlight all its connections.
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Built-In Versioning: Auto-Commit Engine</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>No Save Button. Just Save.</h3>
          <ul class="concept-list">
            <li><strong>Edit threshold:</strong> After 50 keystrokes or actions, the system auto-commits with a snapshot of the document.</li>
            <li><strong>Time threshold:</strong> If 5 minutes pass since the last commit, commit now (even if only 10 edits).</li>
            <li><strong>On close:</strong> Low-activity docs auto-commit when you navigate away. No data loss.</li>
            <li><strong>Multi-device divergence:</strong> If you edit the same doc on two devices before syncing, you get a branch. Merge UI lets you reconcile.</li>
            <li><strong>Metadata:</strong> Each commit stores: document_id, parent_commit (forming a chain), message (auto-generated or user-written), timestamp, full snapshot.</li>
          </ul>
          <p style="margin-top: 12px;">
            The canvas shows time branches as subtle fork icons when hovering a doc.
          </p>
        </div>
      </div>
    </details>

  </div>
</section>

<!-- ========== TIER 3: DEEP DIVE ========== -->
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Spatial Canvas & Versioning</div>
    </div>
  </div>

  <div class="tier-3-content">

    <div class="deep-section">
      <h3>ZoomLevel Enum (sovereign-canvas/src/zoom.rs)</h3>
      <p>
        The renderer uses a zoom level to determine what to draw. Three visibility tiers gate the complexity.
      </p>
      <div class="code-block"><code>pub enum ZoomLevel {
    Dots,       // zoom_factor < 0.3
    Simplified, // zoom_factor >= 0.3 && < 0.6
    Full,       // zoom_factor >= 0.6
}

impl ZoomLevel {
    pub fn from_factor(factor: f32) -> Self {
        match factor {
            f if f < 0.3 => ZoomLevel::Dots,
            f if f < 0.6 => ZoomLevel::Simplified,
            _ => ZoomLevel::Full,
        }
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Layout Constants (sovereign-canvas/src/layout.rs:1‚Äì15)</h3>
      <p>
        Spacing and sizing are constants to ensure consistent layout across all platforms and zoom levels.
      </p>
      <div class="const-table">
        <tr><th>Constant</th><th>Value</th><th>Purpose</th></tr>
        <tr><td><code>CARD_WIDTH</code></td><td>200 px</td><td>Default card width in Full zoom.</td></tr>
        <tr><td><code>CARD_HEIGHT</code></td><td>80 px</td><td>Default card height in Full zoom.</td></tr>
        <tr><td><code>CARD_SPACING_H</code></td><td>20 px</td><td>Horizontal gap between cards in the same lane.</td></tr>
        <tr><td><code>LANE_SPACING_V</code></td><td>40 px</td><td>Vertical gap between lanes.</td></tr>
        <tr><td><code>LANE_HEADER_WIDTH</code></td><td>160 px</td><td>Width of the left sidebar showing lane names.</td></tr>
        <tr><td><code>LANE_PADDING_TOP</code></td><td>30 px</td><td>Top padding before first card in a lane.</td></tr>
      </div>
    </div>

    <div class="deep-section">
      <h3>CardLayout & LaneLayout Structs</h3>
      <p>
        The renderer maintains a layout state for each card and lane. This struct holds computed positions.
      </p>
      <div class="code-block"><code>pub struct CardLayout {
    pub doc_id: String,
    pub title: String,
    pub is_owned: bool,
    pub thread_id: String,
    pub created_at_ts: i64,
    pub x: f32, pub y: f32,      // Top-left, in canvas coords
    pub w: f32, pub h: f32,      // Width, height
    pub opacity: f32,             // Culled cards fade
}

pub struct LaneLayout {
    pub thread_id: String,
    pub thread_name: String,
    pub y_offset: f32,            // Lane's vertical position
    pub card_count: usize,
    pub activity_heat: f32,       // 0.0‚Äì1.0; glows if recent activity
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Auto-Commit Engine (sovereign-canvas/src/versioning.rs)</h3>
      <p>
        Every document has an associated commit scheduler. When thresholds are hit, a new commit is written to the DB.
      </p>
      <div class="const-table">
        <tr><th>Constant</th><th>Value</th><th>Purpose</th></tr>
        <tr><td><code>EDIT_THRESHOLD</code></td><td>50</td><td>Number of edits before auto-commit.</td></tr>
        <tr><td><code>TIME_THRESHOLD_SECS</code></td><td>300</td><td>Seconds (5 min) before time-based auto-commit.</td></tr>
      </div>
      <div class="flow-diagram">
User types
  ‚Üì
edit_count += 1, time_since_commit += 1
  ‚Üì
if edit_count >= 50 OR time_since_commit >= 300:
  ‚îú‚îÄ Snapshot document state
  ‚îú‚îÄ Create commit (parent=latest, message=auto-gen, snapshot=full)
  ‚îú‚îÄ Write to DB
  ‚îî‚îÄ Reset counters
  ‚Üì
On document close:
  ‚îú‚îÄ If edit_count > 0: force commit
  ‚îî‚îÄ Cleanup timers
      </div>
    </div>

    <div class="deep-section">
      <h3>Commit Data Structure</h3>
      <p>
        Commits form a DAG (directed acyclic graph) where each commit points to its parent. Branches occur when
        the same doc is edited on two devices before sync.
      </p>
      <div class="code-block"><code>pub struct Commit {
    pub id: String,                    // UUID
    pub document_id: String,
    pub parent_commit: Option<String>, // Chain to prior version
    pub message: String,               // Auto-gen or user-written
    pub timestamp: i64,
    pub snapshot: DocumentSnapshot,
}

pub struct DocumentSnapshot {
    pub document_id: String,
    pub title: String,
    pub content: String,
    pub metadata: Map<String, Value>,
}</code></div>
      <p>
        On merge, the system creates a "merge commit" with two parent_commit pointers (not yet implemented in MVP).
      </p>
    </div>

    <div class="deep-section">
      <h3>Rendering Architecture</h3>
      <p>
        The canvas uses Iced 0.14 and WGPU for GPU-accelerated rendering. The state is shared via Arc&lt;Mutex&gt;
        to allow concurrent edit + render loops.
      </p>
      <div class="code-block"><code>pub struct CanvasState {
    pub zoom_factor: f32,
    pub pan_x: f32, pan_y: f32,      // Scroll offset
    pub cards: Vec<CardLayout>,
    pub lanes: Vec<LaneLayout>,
    pub selected_card: Option<String>,
}

pub struct CanvasRenderer {
    state: Arc<Mutex<CanvasState>>,
    wgpu_device: Device,
    wgpu_queue: Queue,
}

// Render loop (decoupled from edit loop)
impl CanvasRenderer {
    pub fn render(&self, frame: &Frame) {
        let state = self.state.lock();
        // Draw lanes, cards, relationships
    }
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Canvas Commands</h3>
      <p>
        User interactions (mouse, keyboard, touch) are mapped to commands. The orchestrator executes them.
      </p>
      <div class="code-block"><code>pub enum CanvasCommand {
    NavigateTo { thread_id: String },
    ZoomToThread { thread_id: String, duration_ms: u32 },
    GoHome,
    ZoomIn { center_x: f32, center_y: f32 },
    ZoomOut { center_x: f32, center_y: f32 },
    Pan { dx: f32, dy: f32 },
}</code></div>
    </div>

  </div>
</section>

</div>
</main>
</template>

<template id="page-communications">
<main id="main" role="main">
<div class="content-inner">

<!-- ========== PAGE HEADER ========== -->
<div class="page-header">
  <h1>Unified Communications</h1>
  <p class="subtitle">
    One inbox for everything. Email, Signal, WhatsApp ‚Äî organized by person, not by app. Search "what did Sarah say about the project?" and get results from every channel.
  </p>
</div>

<!-- ========== TIER 1: ELEVATOR PITCH ========== -->
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">One inbox, all channels</div>
    </div>
  </div>

  <div class="tier-1-content">
    <p>
      All your messages in one place. Email, Signal, WhatsApp ‚Äî organized by person, not by app.
      Search "what did Sarah say about the project?" and get results from every channel Sarah has ever contacted you on.
      No switching between apps. No fragmentation. One unified inbox with full-text search across all channels.
    </p>
  </div>
</section>

<!-- ========== TIER 2: HOW IT WORKS ========== -->
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Email, Signal, and WhatsApp in a single encrypted conversation stream</div>
    </div>
  </div>

  <div class="tier-2-content">

    <details open>
      <summary>Contact-Centric Model</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>One Contact Card per Person with Multiple Channel Addresses</h3>
          <p>
            Every person in your network has a unified profile with multiple communication channels attached.
            Instead of bouncing between apps, you open Sarah's contact card and see everything she's ever sent:
            emails, Signal messages, WhatsApp threads‚Äîin chronological order.
          </p>
          <ul class="concept-list">
            <li><strong>One contact card per person:</strong> Name, avatar, notes, all channel addresses (email, phone, Signal ID, WhatsApp).</li>
            <li><strong>All messages unified:</strong> When you open Sarah's card, you see a unified timeline of all her messages across all channels.</li>
            <li><strong>Avatar & metadata synced:</strong> Avatar changes, notes, preferred contact method all update once and apply everywhere.</li>
            <li><strong>Thread linking:</strong> Email exchange about a project can be anchored to that project's canvas thread for full context.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Channel Abstraction</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Trait-Based Design for Extensibility</h3>
          <p>
            Every communication channel (email, SMS, Signal, WhatsApp) implements the same interface.
            Adding a new channel like Telegram or Discord is a single trait implementation.
            No spaghetti integrations. Clean separation of concerns.
          </p>
          <div class="code-block"><code>trait CommunicationChannel {
    async fn connect(&amp;mut self) -&gt; Result&lt;()&gt;;
    async fn send_message(&amp;mut self, msg: Message) -&gt; Result&lt;String&gt;;
    async fn fetch_messages(&amp;mut self, conversation_id: &amp;str) -&gt; Result&lt;Vec&lt;Message&gt;&gt;;
    async fn sync(&amp;mut self) -&gt; Result&lt;SyncResult&gt;;
}</code></div>
          <p style="margin-top: 12px;">
            Each channel plugin implements connect (authenticate), send_message, fetch_messages (batch sync), and sync (periodic update).
          </p>
        </div>
      </div>
    </details>

    <details open>
      <summary>Conversations Linked to Threads</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Email & Chat Anchored to Canvas Documents</h3>
          <p>
            An email exchange about a project doesn't live isolated in an inbox.
            It can be explicitly linked to the project's canvas thread, so discussions and documents are visible together.
          </p>
          <ul class="concept-list">
            <li><strong>Email thread linked to project canvas thread:</strong> All project discussion in one place.</li>
            <li><strong>Signal chat linked to design decision thread:</strong> Design conversations contextualized with docs.</li>
            <li><strong>All accessible from one place:</strong> No switching. Browse documents, see related messages inline.</li>
            <li><strong>Bidirectional linkage:</strong> Access conversation from thread, and thread from conversation.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Search Across Everything</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>AI-Powered Multi-Channel Search</h3>
          <p>
            The orchestrator's <code>search_messages</code> tool queries all channels simultaneously.
            One query returns results from email, Signal, WhatsApp, and SMS. Full-text, ranked, with context snippets.
          </p>
          <ul class="concept-list">
            <li><strong>"Find messages from John about the deadline":</strong> Results from all channels John has messaged you on.</li>
            <li><strong>Full-text search:</strong> Search message bodies and subjects.</li>
            <li><strong>Filters:</strong> By channel, date range, participant, or conversation.</li>
            <li><strong>Ranked results:</strong> Most relevant matches first, with context snippets showing why each result matches.</li>
          </ul>
        </div>
      </div>
    </details>

  </div>
</section>

<!-- ========== TIER 3: DEEP DIVE ========== -->
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Unified Communications</div>
    </div>
  </div>

  <div class="tier-3-content">

    <div class="deep-section">
      <h3>Contact Structure (schema.rs:196-240)</h3>
      <p>
        Every contact is a unified record with multiple communication channels and metadata.
      </p>
      <div class="code-block"><code>struct Contact {
    id: Option&lt;Thing&gt;,              // SurrealDB ID
    name: String,                      // Full name
    avatar: Option&lt;String&gt;,          // Avatar URL/data
    notes: String,                     // User notes
    addresses: Vec&lt;ChannelAddress&gt;,  // Email, phone, Signal ID, WhatsApp, etc.
    is_owned: bool,                    // (owned) vs (external)
    created_at: DateTime&lt;Utc&gt;,       // Creation timestamp
    modified_at: DateTime&lt;Utc&gt;,      // Last modification
}</code></div>
      <p style="margin-top: 12px;">
        Each contact can have multiple addresses across different channels. The addresses vector allows attaching email, SMS, Signal, and WhatsApp to one person.
      </p>
    </div>

    <div class="deep-section">
      <h3>ChannelAddress (Polymorphic)</h3>
      <p>
        Each contact's addresses vector contains polymorphic address records for different channels.
      </p>
      <div class="code-block"><code>struct ChannelAddress {
    channel: ChannelType,         // Email, SMS, Signal, WhatsApp
    address: String,              // "alice@example.com" or "+1555123456"
    display_name: Option&lt;String&gt;, // "Alice (work)"
    is_primary: bool,             // Default channel for sending unsolicited messages
}</code></div>
      <p style="margin-top: 12px;">
        ChannelType is an enum supporting Email, SMS, Signal, WhatsApp, and extensible to new channels. is_primary marks the preferred channel for sending messages.
      </p>
    </div>

    <div class="deep-section">
      <h3>Message Structure</h3>
      <p>
        Messages are stored with full metadata for search, filtering, and display.
      </p>
      <div class="code-block"><code>struct Message {
    conversation_id: String,        // Links to conversation
    channel: ChannelType,           // Which channel?
    direction: MessageDirection,    // Inbound or Outbound
    from_contact_id: String,        // Sender's contact ID
    to_contact_ids: Vec&lt;String&gt;,   // Recipient IDs
    subject: Option&lt;String&gt;,       // Email-style subject
    body: String,                   // Plain text body
    body_html: Option&lt;String&gt;,     // HTML version (email)
    sent_at: DateTime&lt;Utc&gt;,        // When sent (canonical time)
    read_status: ReadStatus,        // Unread/Read/Archived
    encryption_nonce: Option&lt;String&gt;, // For encrypted storage
}</code></div>
      <p style="margin-top: 12px;">
        Messages are stored in the graph database with links to conversations and contacts. Encryption nonce allows per-message encryption at rest.
      </p>
    </div>

    <div class="deep-section">
      <h3>Conversation Structure</h3>
      <p>
        Conversations group related messages and can be linked to canvas threads.
      </p>
      <div class="code-block"><code>struct Conversation {
    id: Option&lt;Thing&gt;,
    title: String,                    // Display title
    channel: ChannelType,             // Email, Signal, etc.
    participant_ids: Vec&lt;String&gt;,  // Involved contacts
    linked_thread_id: Option&lt;String&gt;, // Optional canvas thread link
    unread_count: u32,                // Unread message count
    last_message_at: DateTime&lt;Utc&gt;, // Most recent message time
    deleted_at: Option&lt;DateTime&lt;Utc&gt;&gt;, // Soft delete
}</code></div>
      <p style="margin-top: 12px;">
        Conversations group related messages. A Slack DM thread, email conversation, or Signal chat is one conversation. linked_thread_id connects to canvas documents.
      </p>
    </div>

    <div class="deep-section">
      <h3>Graph Database Operations (traits.rs:130-175)</h3>
      <p>
        Core database operations for contacts, messages, and conversations.
      </p>
      <div class="const-table">
        <tr><th>Operation</th><th>Purpose</th></tr>
        <tr><td><code>create_contact()</code></td><td>Insert contact with addresses</td></tr>
        <tr><td><code>get_contact(id)</code></td><td>Fetch contact + all messages from that contact</td></tr>
        <tr><td><code>list_contacts()</code></td><td>All contacts, sorted by last_message_at</td></tr>
        <tr><td><code>update_contact()</code></td><td>Modify name, avatar, addresses, notes</td></tr>
        <tr><td><code>search_messages(query)</code></td><td>Full-text search across all channels simultaneously</td></tr>
        <tr><td><code>list_conversations(filter)</code></td><td>Conversations filtered by channel, contact, or thread</td></tr>
      </div>
    </div>

    <div class="deep-section">
      <h3>Channel Trait Implementations</h3>
      <p>
        Each communication protocol is implemented as a separate module conforming to the CommunicationChannel trait.
      </p>
      <ul class="concept-list">
        <li><strong>Email (IMAP/SMTP):</strong> Connects to mail servers, fetches messages, maps to Contact/Message structs. Subject becomes message subject, headers parsed for sender/recipient.</li>
        <li><strong>Signal (presage crate):</strong> Uses Signal protocol via presage library. Messages are ephemeral by default; persisted to DB. Encryption happens at protocol level (end-to-end).</li>
        <li><strong>WhatsApp & SMS:</strong> Placeholder for future integrations. Same trait interface means implementation details are isolated and don't affect the core system.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Sync Engine (CommsSync)</h3>
      <p>
        Multi-channel synchronization happens periodically or on-demand, fetching new messages and deduplicating across instances.
      </p>
      <div class="code-block"><code>struct SyncResult {
    new_messages: u32,         // How many new messages fetched
    updated_conversations: u32, // How many conversations updated
    new_contacts: u32,         // New contacts discovered
}</code></div>
      <ul class="concept-list">
        <li><strong>Idempotent:</strong> Syncing twice doesn't create duplicates. Message IDs prevent double-insertion.</li>
        <li><strong>Parallel:</strong> Channels sync concurrently. Email, Signal, WhatsApp fetch in parallel.</li>
        <li><strong>Conflict resolution:</strong> Last-write-wins for message metadata (read status, etc.).</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Encryption & Storage</h3>
      <p>
        Message security is enforced at the storage layer with AES-256-GCM encryption.
      </p>
      <ul class="concept-list">
        <li><strong>Message bodies encrypted:</strong> AES-256-GCM via sovereign-crypto module.</li>
        <li><strong>Per-contact encryption nonce:</strong> Additional isolation‚Äîdifferent contacts' messages encrypted with different nonces.</li>
        <li><strong>Graph database storage:</strong> SurrealDB stores encrypted message blobs with plaintext indices for search (searchable encryption).</li>
        <li><strong>Metadata encrypted:</strong> Sender, recipient, timestamps also encrypted at rest.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Integration with Canvas Threads</h3>
      <p>
        Conversations can be linked to document threads on the spatial canvas for context.
      </p>
      <ul class="concept-list">
        <li><strong>Bidirectional linkage:</strong> Conversation ‚Üí linked_thread_id points to Document/Thread. Thread metadata includes unread message count from linked conversations.</li>
        <li><strong>Unified search:</strong> Search across documents and messages simultaneously. Results ranked together.</li>
        <li><strong>Context preservation:</strong> When reviewing project documents, related email/Signal discussion is visible inline.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>AI Orchestrator Integration</h3>
      <p>
        The <code>sovereign-ai</code> module includes a read-only tool for natural language message search across all channels.
      </p>
      <ul class="concept-list">
        <li><strong>Natural language input:</strong> "What did Alice say about the deadline?"</li>
        <li><strong>Multi-channel query:</strong> Queries the graph database across all channels simultaneously.</li>
        <li><strong>Ranked results:</strong> Returns results sorted by relevance with snippets and metadata (sender, channel, date).</li>
        <li><strong>Never modifies:</strong> Read-only tool, Observe level. No user confirmation needed.</li>
        <li><strong>Aware of contact context:</strong> "Find messages from Sarah" understood to mean all addresses linked to Sarah's contact card.</li>
      </ul>
    </div>

  </div>
</section>

  </div>
</main>

</template>

<template id="page-content-skills">
<main id="main" role="main">
<div class="content-inner">

<!-- ========== PAGE HEADER ========== -->
<div class="page-header">
  <h1>Content + Skills Architecture</h1>
  <p class="subtitle">
    Data ownership through composable tools and typed relationships in a graph database.
  </p>
</div>

<!-- ========== TIER 1: ELEVATOR PITCH ========== -->
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">Data owns itself</div>
    </div>
  </div>

  <div class="tier-1-content">
    <p>
      In traditional apps, Notion owns your notes, Google owns your sheets. In Sovereign, your data lives in a local graph database.
      Documents live in a persistent, queryable store with typed relationships. Skills are lightweight tools ‚Äî markdown editor, PDF exporter ‚Äî that operate on your data without owning it.
      You switch tools freely. No data migration needed.
    </p>
  </div>
</section>

<!-- ========== TIER 2: HOW IT WORKS ========== -->
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Your documents live in a graph; lightweight skills operate on them without locking you in</div>
    </div>
  </div>

  <div class="tier-2-content">

    <details open>
      <summary>Graph Database (SurrealDB)</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Everything is Nodes or Edges with Typed Relationships</h3>
          <p>
            The graph database is the single source of truth for all your data. Nodes represent entities; edges represent relationships.
          </p>
          <ul class="concept-list">
            <li><strong>Nodes:</strong> Document, Thread, Contact, Conversation (typed entities).</li>
            <li><strong>8 Relationship Types:</strong> References, DerivedFrom, Continues, Contradicts, Supports, BranchesFrom, ContactOf, AttachedTo.</li>
            <li><strong>Queries:</strong> "Find all docs referencing this paper." "Show me conversations with Alice about project X." Relationships are first-class and queryable.</li>
            <li><strong>Persistence:</strong> All data lives in a single SurrealDB instance with full ACID guarantees and full-text search indexing.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Documents & Threads</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Atomic Units in a Flat Structure</h3>
          <p>
            Documents are the atomic content unit in Sovereign. Threads organize documents into named project lanes (flat, no nesting).
          </p>
          <ul class="concept-list">
            <li><strong>Document:</strong> Title, body (markdown or structured JSON), images, thread assignment, ownership flag (is_owned), spatial coordinates (for canvas), encryption nonce, soft-delete marker.</li>
            <li><strong>Thread:</strong> Named container (e.g., "2026 Q1 Strategy"). Flat‚Äîno nested folders. Documents reference their thread. A document can relate to documents in other threads via relationships.</li>
            <li><strong>Spatial Metadata:</strong> Each document has (spatial_x, spatial_y) for the canvas view. Thread lanes auto-organize documents visually.</li>
            <li><strong>Ownership:</strong> is_owned field marks whether content is yours or imported. Guides encryption and export behavior.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Relationships: The Magic</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Directed Typed Edges Replace Folders</h3>
          <p>
            Instead of nesting documents in folders, relationships connect them across threads. This enables powerful queries and prevents organizational lock-in.
          </p>
          <ul class="concept-list">
            <li><strong>Directed:</strong> A references B, but B doesn't automatically reference A (unless you add a symmetric edge).</li>
            <li><strong>Typed:</strong> Each edge has a type (References, DerivedFrom, Contradicts, etc.), encoding semantic meaning.</li>
            <li><strong>Strength:</strong> Optional weight (0.0‚Äì1.0) for ranking relevance in search results.</li>
            <li><strong>Cross-Thread Visibility:</strong> Relationships make connections visible across thread boundaries. Query: "Show me everything this doc derives from."</li>
            <li><strong>Traversal:</strong> Walk relationship chains. Detect cycles. Find knowledge gaps.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Skills: Composable Tools</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Sandboxed, Stateless Tools Operating on Your Data</h3>
          <p>
            Skills are lightweight tools that read from or write to the graph database without storing state themselves. You own the data; skills are interchangeable views/editors.
          </p>
          <ul class="concept-list">
            <li><strong>Built-In Skills:</strong> Markdown editor, PDF export, word counter, find/replace, duplicate, import.</li>
            <li><strong>Manifest:</strong> Each skill declares its name, version, capabilities, and supported file types.</li>
            <li><strong>Sandboxing:</strong> Landlock filesystem isolation + seccomp-bpf syscall filtering ensure a skill cannot escape its scope.</li>
            <li><strong>No Lock-In:</strong> Export your data, open it in any skill. Skills are read from the same store, so switching is instant‚Äîno migration.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Soft Delete & Action Gravity</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Nothing Destroyed Until Purged</h3>
          <p>
            Every node in the database has a deleted_at field. Deletion is not immediate destruction; it's a soft flag. Aligns with Action Gravity level 4 (Destruct).
          </p>
          <ul class="concept-list">
            <li><strong>Soft Delete:</strong> When you "delete" a document, deleted_at is set to the current timestamp. The doc is hidden from normal queries but remains in the database.</li>
            <li><strong>Recovery:</strong> Within a configurable retention window (default 30 days), you can restore any soft-deleted document with a single click.</li>
            <li><strong>Purge:</strong> After the retention window or on explicit purge, the document is permanently removed. This action requires Level 4 confirmation (irreversible).</li>
            <li><strong>Audit Trail:</strong> Every soft delete and purge is logged in the audit chain, enabling forensic recovery and accountability.</li>
          </ul>
        </div>
      </div>
    </details>

  </div>
</section>

<!-- ========== TIER 3: DEEP DIVE ========== -->
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Content + Skills Architecture</div>
    </div>
  </div>

  <div class="tier-3-content">

    <div class="deep-section">
      <h3>Document Schema</h3>
      <p>
        Every document is a row in the document table with the following fields:
      </p>
      <table class="const-table">
        <tr><th>Field</th><th>Type</th><th>Description</th></tr>
        <tr><td><code>id</code></td><td>Thing</td><td>Unique identifier (generated by SurrealDB).</td></tr>
        <tr><td><code>title</code></td><td>String</td><td>Document title, user-facing.</td></tr>
        <tr><td><code>content</code></td><td>String (JSON)</td><td>Markdown or structured content. Can include embedded images as base64-encoded JSON.</td></tr>
        <tr><td><code>thread_id</code></td><td>Thing</td><td>Reference to the parent thread.</td></tr>
        <tr><td><code>is_owned</code></td><td>Bool</td><td>true if you created it, false if imported. Guides encryption and export.</td></tr>
        <tr><td><code>created_at</code></td><td>DateTime</td><td>ISO 8601 timestamp.</td></tr>
        <tr><td><code>modified_at</code></td><td>DateTime</td><td>Last modification time.</td></tr>
        <tr><td><code>spatial_x</code></td><td>Float</td><td>Canvas position (horizontal).</td></tr>
        <tr><td><code>spatial_y</code></td><td>Float</td><td>Canvas position (vertical).</td></tr>
        <tr><td><code>head_commit</code></td><td>Thing</td><td>Reference to the latest commit in this document's version history.</td></tr>
        <tr><td><code>deleted_at</code></td><td>DateTime (nullable)</td><td>Soft delete timestamp. null = not deleted.</td></tr>
        <tr><td><code>encryption_nonce</code></td><td>String</td><td>IV/nonce for AES-256-GCM encryption (hex-encoded).</td></tr>
      </table>
    </div>

    <div class="deep-section">
      <h3>Thread Schema</h3>
      <p>
        Threads group documents into named project lanes. Simple and flat.
      </p>
      <table class="const-table">
        <tr><th>Field</th><th>Type</th><th>Description</th></tr>
        <tr><td><code>id</code></td><td>Thing</td><td>Unique identifier.</td></tr>
        <tr><td><code>name</code></td><td>String</td><td>Display name (e.g., "2026 Q1 Strategy").</td></tr>
        <tr><td><code>description</code></td><td>String (nullable)</td><td>Optional description of the thread's purpose.</td></tr>
        <tr><td><code>created_at</code></td><td>DateTime</td><td>When the thread was created.</td></tr>
        <tr><td><code>deleted_at</code></td><td>DateTime (nullable)</td><td>Soft delete timestamp.</td></tr>
      </table>
    </div>

    <div class="deep-section">
      <h3>RelationType Enum</h3>
      <p>
        Eight relationship types express semantic connections between documents:
      </p>
      <div class="code-block"><code>pub enum RelationType {
    References,      // A cites B
    DerivedFrom,     // A is built on B
    Continues,       // A is the next version/chapter of B
    Contradicts,     // A challenges B
    Supports,        // A provides evidence for B
    BranchesFrom,    // A is a fork/alternate path from B
    ContactOf,       // A is a contact associated with B
    AttachedTo,      // A is a file/asset attached to B
}</code></div>
    </div>

    <div class="deep-section">
      <h3>RelatedTo (Edge) Schema</h3>
      <p>
        Edges in the graph connecting documents via relationships:
      </p>
      <table class="const-table">
        <tr><th>Field</th><th>Type</th><th>Description</th></tr>
        <tr><td><code>id</code></td><td>Thing</td><td>Edge identifier.</td></tr>
        <tr><td><code>in_</code></td><td>Thing</td><td>Target document (incoming).</td></tr>
        <tr><td><code>out</code></td><td>Thing</td><td>Source document (outgoing).</td></tr>
        <tr><td><code>relation_type</code></td><td>RelationType</td><td>Type of connection.</td></tr>
        <tr><td><code>strength</code></td><td>Float (0.0‚Äì1.0)</td><td>Optional weight for ranking relevance. Default 1.0.</td></tr>
        <tr><td><code>created_at</code></td><td>DateTime</td><td>When the relationship was created.</td></tr>
      </table>
    </div>

    <div class="deep-section">
      <h3>SurrealDB Tables & Indexes</h3>
      <p>
        Core schema tables and their indexes for fast queries:
      </p>
      <ul class="concept-list">
        <li><strong>document</strong> ‚Äî Primary content store. Indexes: (thread_id), (deleted_at), full-text search on title + content.</li>
        <li><strong>thread</strong> ‚Äî Project lanes. Indexes: (created_at), (deleted_at).</li>
        <li><strong>related_to</strong> ‚Äî Relationship edges. Indexes: (out), (in_), (relation_type).</li>
        <li><strong>commit</strong> ‚Äî Version history snapshots. Indexes: (document_id), (created_at).</li>
        <li><strong>milestone</strong> ‚Äî Tagged points in version history. Indexes: (commit_id).</li>
        <li><strong>contact</strong> ‚Äî Address book. Indexes: (email), (name).</li>
        <li><strong>conversation</strong> ‚Äî Email/Signal threads. Indexes: (contact_id), (created_at).</li>
        <li><strong>message</strong> ‚Äî Individual emails/messages. Indexes: (conversation_id), (created_at), full-text search on body.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>SkillManifest Structure</h3>
      <p>
        Skills declare their interface via a manifest:
      </p>
      <div class="code-block"><code>pub struct SkillManifest {
    pub name: String,
    pub version: String,
    pub description: String,
    pub author: String,
    pub skill_type: SkillType,
    pub capabilities: Vec&lt;String&gt;,  // "read", "write", "export"
    pub file_types: Vec&lt;String&gt;,    // "markdown", "pdf", "json"
}</code></div>
      <p>
        Example manifest for the PDF export skill:
      </p>
      <div class="code-block"><code>{
  "name": "PDF Export",
  "version": "1.0.0",
  "description": "Export documents to PDF with formatting.",
  "author": "Sovereign Team",
  "skill_type": "Exporter",
  "capabilities": ["read"],
  "file_types": ["pdf"]
}</code></div>
    </div>

    <div class="deep-section">
      <h3>Skill Sandboxing</h3>
      <p>
        Skills run in a restricted environment to prevent data exfiltration or unintended side effects:
      </p>
      <ul class="concept-list">
        <li><strong>Landlock Filesystem:</strong> Skills see only the documents they're asked to operate on. No access to user's home directory, /etc, or system files.</li>
        <li><strong>seccomp-bpf Syscall Filter:</strong> Skills can only call safe syscalls (read, write, mmap, etc.). Blocked: network I/O, exec, fork, ptrace.</li>
        <li><strong>Capability Grants:</strong> The manifest lists what the skill can do. The sandbox enforces these limits. A read-only skill cannot write to the database.</li>
        <li><strong>No Network:</strong> Skills cannot reach the internet. Prevents data exfiltration or phoning home.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Core Trait Methods</h3>
      <p>
        The standard interface for working with documents and relationships:
      </p>
      <div class="code-block"><code>pub trait DocumentStore {
    async fn create_document(&mut self, doc: Document) -> Result&lt;DocumentId&gt;;
    async fn get_document(&self, id: DocumentId) -> Result&lt;Document&gt;;
    async fn list_documents(&self, thread_id: ThreadId) -> Result&lt;Vec&lt;Document&gt;&gt;;
    async fn update_document(&mut self, id: DocumentId, patch: DocumentPatch) -> Result&lt;()&gt;;
    async fn delete_document(&mut self, id: DocumentId) -> Result&lt;()&gt;;  // Soft delete
    async fn purge_document(&mut self, id: DocumentId) -> Result&lt;()&gt;;    // Hard delete

    async fn relate(&mut self, from: DocumentId, to: DocumentId, rel: RelationType, strength: f32) -> Result&lt;()&gt;;
    async fn list_relations(&self, doc_id: DocumentId) -> Result&lt;Vec&lt;Relation&gt;&gt;;
    async fn traverse(&self, start: DocumentId, depth: usize) -> Result&lt;Graph&gt;;

    async fn search_documents(&self, query: &str) -> Result&lt;Vec&lt;SearchResult&gt;&gt;;
    async fn commit(&mut self, doc_id: DocumentId, message: String) -> Result&lt;CommitId&gt;;
    async fn list_commits(&self, doc_id: DocumentId) -> Result&lt;Vec&lt;Commit&gt;&gt;;
}</code></div>
    </div>

  </div>
</section>

  </div>
</main>
</template>

<template id="page-ethics">
<main id="main" role="main">
<div class="content-inner">

<!-- ========== PAGE HEADER ========== -->
<div class="page-header">
  <h1>Ethics, Misuse Analysis & Design Constraints</h1>
  <p class="subtitle">
    How Sovereign strengthens privacy while narrowing the misuse surface through binding design constraints.
  </p>
</div>

<!-- ========== TIER 1: ELEVATOR PITCH ========== -->
<section class="tier-section tier-1">
  <div class="tier-header">
    <span class="tier-badge">1</span>
    <div>
      <div class="tier-label">Power with guardrails</div>
    </div>
  </div>

  <div class="tier-1-content">
    <p>
      Sovereign aims to package strong privacy into a turnkey system. Every capability it explores already exists as a standalone tool ‚Äî Signal did the same for encryption.
      The project aspires to the Signal precedent rather than the Tor precedent: strengthen privacy for ordinary users while offering criminals only marginal improvement.
      Four binding design constraints are intended to narrow the misuse surface by code, not policy. Some are implemented; others are roadmap items marked below.
    </p>
  </div>
</section>

<!-- ========== TIER 2: HOW IT WORKS ========== -->
<section class="tier-section tier-2">
  <div class="tier-header">
    <span class="tier-badge">2</span>
    <div>
      <div class="tier-label">Every capability is weighed against its misuse potential before shipping</div>
    </div>
  </div>

  <div class="tier-2-content">

    <details open>
      <summary>Existing Tool Equivalence</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Nothing New Under the Sun</h3>
          <p>
            Every capability in Sovereign already exists as standalone software. The value is in integration, not innovation.
          </p>
          <table class="const-table">
            <tr><th>Sovereign Feature</th><th>Status</th><th>Existing Equivalents</th></tr>
            <tr><td>Identity Firewall</td><td><em>Roadmap</em></td><td>Firefox containers, SimpleLogin, ProtonVPN, DuckDuckGo tracker blocking</td></tr>
            <tr><td>Encrypted P2P Sync</td><td><em>Infrastructure only</em></td><td>Syncthing, IPFS, Restic + Backblaze</td></tr>
            <tr><td>Social Recovery</td><td>Implemented</td><td>Casa (Bitcoin multisig model), ssss-split (Shamir secret sharing)</td></tr>
            <tr><td>Local AI</td><td>Implemented</td><td>Ollama, llama.cpp, gpt4all</td></tr>
            <tr><td>Per-Document Encryption</td><td>Implemented</td><td>LUKS (Linux), BitLocker (Windows), FileVault (macOS)</td></tr>
          </table>
        </div>
      </div>
    </details>

    <details open>
      <summary>What Sovereign Does NOT Provide</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Intentional Constraints for Ethical Clarity</h3>
          <p>
            These omissions are deliberate ethical choices, not limitations:
          </p>
          <ul class="concept-list">
            <li><strong>No Network Anonymity:</strong> No Tor integration, no built-in VPN. Local privacy ‚â† covert ops. Users install Tor separately if needed.</li>
            <li><strong>No Cryptocurrency:</strong> No wallet, no censorship-resistant payment channel. Social recovery is identity-based, not financial.</li>
            <li><strong>No Offensive Tooling:</strong> No password cracking, no keystroke injection, no privilege escalation exploits.</li>
            <li><strong>Small AI Models:</strong> 3B/7B quantized models too small for sophisticated social engineering attacks. Audit logs record all inferences.</li>
            <li><strong>Audit Logs Create Forensic Record:</strong> Worse for criminals than useful for them. Differential privacy prevents inference attacks on guardian shards.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Four Binding Design Constraints</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Code-Level Enforcement, Not Policy</h3>
          <p>
            Constraints are enforced by architecture, not trust in governance:
          </p>
          <ul class="concept-list">
            <li><strong>1. Identity Firewall Scope <em>(roadmap ‚Äî not yet implemented)</em>:</strong> Tracking prevention only (cookie isolation, URL param stripping, fingerprint resistance). Designed to block on banking/gov domains. No synthetic identities. Users would be able to override.</li>
            <li><strong>2. No Network Anonymity:</strong> Intentional design choice. Network stack is transparent. Tor is a user install, not a feature. Clear separation of concerns.</li>
            <li><strong>3. Guardian Protocol Transparency:</strong> Single function: shard storage and return. No messaging, no general storage layer, no coordination, no dead-man's switch. Scope is narrowly constrained.</li>
            <li><strong>4. Audit Log Integrity <em>(partial ‚Äî hash chain is roadmap)</em>:</strong> Currently append-only JSONL. The goal is a tamper-evident hash chain where each entry includes a hash of the previous entry. User can read and export but not selectively edit or reorder.</li>
          </ul>
        </div>
      </div>
    </details>

    <details open>
      <summary>Ethical Principles</summary>
      <div class="details-content">
        <div class="concept-block">
          <h3>Four Core Commitments</h3>
          <ul class="concept-list">
            <li><strong>Privacy as a Right:</strong> UN Article 12, ECHR Article 8, GDPR Article 5. Not conditional on "law-abiding" status. Universal human right.</li>
            <li><strong>Full Transparency:</strong> Open source (AGPL-3.0), no telemetry, no proprietary components. Code audit by anyone.</li>
            <li><strong>Honest Tradeoffs:</strong> No claims that privacy is "side-effect-free." Acknowledge misuse risks openly. Let users decide.</li>
            <li><strong>Distributed, Not Centralized:</strong> Software, not service. Designed without back doors, master keys, or remote kill switches. You own the software and your data.</li>
          </ul>
        </div>
      </div>
    </details>

  </div>
</section>

<!-- ========== TIER 3: DEEP DIVE ========== -->
<section class="tier-section tier-3">
  <div class="tier-header">
    <span class="tier-badge">3</span>
    <div>
      <div class="tier-label">Deep dive into Ethics & Design Constraints</div>
    </div>
  </div>

  <div class="tier-3-content">

    <div class="deep-section">
      <h3>Identity Firewall Scope <em>(roadmap ‚Äî not yet implemented)</em></h3>
      <p>
        The identity firewall is a planned feature designed to prevent tracking across domains. Its scope is intentionally narrow:
      </p>
      <ul class="concept-list">
        <li><strong>What It Would Do:</strong> Cookie isolation (each domain gets a separate cookie jar), URL parameter stripping (removes utm_*, fbclid, etc.), fingerprint resistance (spoofs User-Agent, webgl, canvas fingerprints).</li>
        <li><strong>What It Would NOT Do:</strong> No synthetic identities. You would still be the same person across sites within your identity context. No pretense of being multiple people.</li>
        <li><strong>Trusted Domain List (TDL):</strong> Planned governance model inspired by Mozilla. Users would propose additions. Protected categories (banking, gov) could not be removed by users.</li>
        <li><strong>User Override:</strong> Users would be able to disable tracking prevention per site. Clear UI would show when it's active.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>No Built-In Network Anonymity</h3>
      <p>
        Network anonymity is intentionally omitted. Rationale: separates this project from Tails/Whonix precedent.
      </p>
      <ul class="concept-list">
        <li><strong>Local Privacy ‚â† Covert Ops:</strong> Full-disk encryption protects your device. Network traffic still reveals your ISP, location, website visits. These are different problems.</li>
        <li><strong>Tor is a User Install:</strong> Users can install Tor separately. Sovereign does not bundle it. Clear boundary between privacy-by-default and anonymity-by-choice.</li>
        <li><strong>Ethical Clarity:</strong> Avoids the appearance of targeting criminals while serving journalists. "Tor user" implies suspicious intent to some. Better to let users make that choice explicitly.</li>
        <li><strong>Regulatory Risk:</strong> Bundled anonymity tools trigger export controls in some jurisdictions. Sovereign as "privacy tool" is defensible. Sovereign + Tor is a different category.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Guardian Protocol Transparency</h3>
      <p>
        The guardian protocol is deliberately scoped to a single, auditable function: shard storage/return.
      </p>
      <ul class="concept-list">
        <li><strong>What Guardians Do:</strong> Store encrypted shards of your recovery key. On your request, return the shard. That's it.</li>
        <li><strong>No Messaging:</strong> Guardians cannot send you messages. No "you have a guardian request" notification system.</li>
        <li><strong>No General Storage:</strong> Guardians cannot store arbitrary data. Only recovery shards, format-fixed, size-limited.</li>
        <li><strong>No Coordination:</strong> Guardians cannot communicate with each other. No "2-of-3 consensus" logic on the guardian side. You orchestrate recovery locally.</li>
        <li><strong>No Dead Man's Switch:</strong> Guardians do not auto-transmit anything on timer or trigger. No "if I don't check in, release my data." User must actively request shards.</li>
        <li><strong>Repurposing Risk Minimized:</strong> Narrow scope makes it hard to misuse. Adding a general storage layer would create incentive to use Sovereign as a dead drop for contraband.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Audit Log Integrity <em>(partial ‚Äî currently append-only JSONL, hash chain is roadmap)</em></h3>
      <p>
        Today, Sovereign logs session activity to an append-only JSONL file with automatic rotation.
        The long-term goal is a tamper-evident hash chain that is forensically sound:
      </p>
      <ul class="concept-list">
        <li><strong>Current State:</strong> Append-only JSONL log. Records user inputs, orchestrator actions, and chat responses. Automatic rotation at 10 MB. No hash chain yet.</li>
        <li><strong>Goal ‚Äî Hash Chain:</strong> Each entry would include a hash of the previous entry. Reordering or editing entries would break the chain ‚Äî tampering would be immediately visible.</li>
        <li><strong>User Can Read:</strong> Full access to audit logs. No hidden logging.</li>
        <li><strong>Goal ‚Äî Export &amp; Sharing:</strong> Audit logs could be exported in plaintext, JSON, or cryptographic format for external verification. Proof of existence without proof of content.</li>
        <li><strong>Goal ‚Äî Delete All:</strong> Bulk deletion available but not selective editing ‚Äî all-or-nothing.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Local AI Inference Analysis</h3>
      <p>
        Running uncensored AI models locally raises questions about model choice and defaults:
      </p>
      <ul class="concept-list">
        <li><strong>Uncensored Model Question:</strong> Should base models have safety filters? Current approach: base Qwen2.5 models are used as-is (no RLHF steering toward specific political views).</li>
        <li><strong>Risk Assessment:</strong> 3B/7B quantized models are too small to generate sophisticated social engineering attacks, code exploits, or chemical synthesis instructions. Larger models (70B+) would raise safety concerns.</li>
        <li><strong>Audit Log Records All:</strong> Every inference is logged with timestamp, input, and output. Provides forensic record if misuse occurs. Deters irresponsible use.</li>
        <li><strong>Whose Filters?:</strong> Default: base models, user can substitute. If we filter by default, whose values? Better to let users choose. Transparency over paternalism.</li>
        <li><strong>Model Substitution:</strong> Users can swap in alternative models (Llama, Mistral, Phi, etc.). Locked model choice would be lock-in.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Encrypted Storage Debate</h3>
      <p>
        Full-disk encryption has been available since 2003 (BitLocker). The debate is old, not new.
      </p>
      <ul class="concept-list">
        <li><strong>Law Enforcement vs Privacy:</strong> BitLocker (2003) enabled encrypted drives on consumer hardware. Two decades of debate: criminal use vs. privacy right. No resolution.</li>
        <li><strong>Sovereign Makes Encryption Default:</strong> Like Signal made encryption the default for messaging (2014). Default encryption is high-friction for law enforcement but table-stakes for privacy-first software.</li>
        <li><strong>Not Novel:</strong> Full-disk encryption is mature technology. Sovereign does not invent it. Uses LUKS (Linux), BitLocker-style (Windows), FileVault (macOS).</li>
        <li><strong>Precedent:</strong> Signal is de facto recommended by journalists, activists, and law enforcement (e.g., FBI director recommends Signal). Encryption default is socially acceptable when implemented carefully.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Precedent Analysis</h3>
      <p>
        Where does Sovereign sit in the landscape of privacy tools?
      </p>
      <ul class="concept-list">
        <li><strong>Tor (2002):</strong> Network anonymity. Explicitly designed for covert ops, journalism, circumvention. Accepted misuse risk as trade-off for enabling dissidents. Narrow target audience.</li>
        <li><strong>Full-Disk Encryption (2003+):</strong> Local data protection. BitLocker made FDE mainstream. Two-decade debate about key escrow. No resolution. Industry standard now.</li>
        <li><strong>Signal (2014):</strong> End-to-end encrypted messaging. Made encryption the default. Mainstream adoption (200M+ users). Balances privacy strength with social acceptability. Law enforcement does not like it but it is legal and widespread.</li>
        <li><strong>Sovereign:</strong> Aspires to the Signal model. Aims to package existing privacy features (encryption, local AI, and eventually an identity firewall) into a coherent system. Default encryption. Open source. Mainstream target audience. Narrow misuse surface relative to Tor.</li>
      </ul>
    </div>

    <div class="deep-section">
      <h3>Open Questions</h3>
      <p>
        Several design choices remain unresolved and open to community input:
      </p>
      <ul class="concept-list">
        <li><strong>Trusted Domain List Governance:</strong> If the identity firewall is built, who decides what goes on the TDL? Community vote? Maintainer discretion? Mozilla model has limitations. Better alternative?</li>
        <li><strong>Export Controls:</strong> Will jurisdictions restrict distribution of Sovereign? Precedent: PGP faced NSA pressure in 1990s. Current landscape is more permissive but regulation is tightening.</li>
        <li><strong>Model Safety Defaults:</strong> Should Qwen2.5 have built-in refusals (jailbreak-resistant) or be maximally open (user can override)? Trade-off: ease of use vs. openness.</li>
        <li><strong>Guardian Auditability:</strong> Can guardians be audited after shard return? Metadata might reveal identity or timing. How to balance auditability with privacy?</li>
        <li><strong>Audit Log Forensics:</strong> Law enforcement will want audit logs. Should recovery be possible without user consent? Current design: user can delete logs fully but not selectively. Is this the right balance?</li>
        <li><strong>P2P Metadata Leakage:</strong> Encrypted P2P sync might leak IP addresses, sync frequency, file sizes. How much metadata is acceptable for privacy-first design?</li>
      </ul>
    </div>

  </div>
</section>

  </div>
</main>
</template>

<!-- LEGAL PAGE TEMPLATES -->

<template id="page-legal-notice">
    <main id="main-content">
        <h1>Legal Notice</h1>
        <p class="subtitle">Full legal terms, disclaimers, and regulatory information for Sovereign GE.</p>

        <section>
            <h2>License</h2>
            <p>Sovereign GE is distributed under the <strong>GNU Affero General Public License v3.0 (AGPL-3.0)</strong>. The full license text is included in the <code>LICENSE</code> file in the repository.</p>
            <p>Key rights and obligations:</p>
            <ul>
                <li><strong>Freedom to use:</strong> You may run the software for any purpose.</li>
                <li><strong>Freedom to modify:</strong> You may inspect and modify the source code.</li>
                <li><strong>Freedom to share:</strong> You may distribute copies under the same license.</li>
                <li><strong>Network copyleft:</strong> If you modify Sovereign and operate it as a network service, you must make the modified source available to users (Section 13).</li>
            </ul>
        </section>

        <section>
            <h2>Warranty Disclaimer</h2>
            <div class="legal-box">
                <strong>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</strong>
                <br><br>
                IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
            </div>
            <p>This software is provided on a best-effort basis. We make no guarantee that it will work correctly, securely, or at all. Use at your own risk.</p>
        </section>

        <section>
            <h2>Limitation of Liability</h2>
            <p>To the fullest extent permitted by law, in no event shall the Sovereign GE project, its maintainers, contributors, or any related parties be liable for:</p>
            <ul>
                <li>Any indirect, incidental, special, consequential, or punitive damages;</li>
                <li>Loss of profits, revenue, data, or use;</li>
                <li>Business interruption;</li>
                <li>Any damages arising from use or inability to use the software, even if advised of the possibility of such damages.</li>
            </ul>
            <p>This limitation applies regardless of the legal theory (contract, tort, strict liability, etc.) and even if a remedy fails of its essential purpose.</p>
        </section>

        <section>
            <h2>Nature of the Project</h2>
            <p>Sovereign GE is a <strong>distributed, open-source software project</strong>. It is not a hosted service. Key characteristics:</p>
            <ul>
                <li><strong>No servers operated:</strong> The Sovereign GE project does not operate or maintain any servers.</li>
                <li><strong>No user data collection:</strong> The software does not send data to any service operated by the project.</li>
                <li><strong>No accounts maintained:</strong> There is no account system operated by the Sovereign GE project.</li>
                <li><strong>No capability to intercept, access, or modify user data:</strong> By design, the project has no technical means to access, intercept, modify, or delete user data stored on your device.</li>
                <li><strong>Decentralized:</strong> All data is stored locally or synchronized peer-to-peer (if enabled) without central storage.</li>
            </ul>
            <div class="highlight">
                <strong>What this means:</strong> If you are concerned about data privacy and control, Sovereign is designed so that we cannot access your data. We have no ability to surveil, audit, recover, or restore your information.
            </div>
        </section>

        <section>
            <h2>Encryption Notice</h2>
            <p>Sovereign includes cryptographic functionality (AES-256-GCM, HKDF, key derivation). Export, import, possession, and use of cryptographic software may be regulated under:</p>
            <ul>
                <li><strong>United States:</strong> Export Administration Regulations (EAR), controlled by the Bureau of Industry and Security (BIS).</li>
                <li><strong>European Union:</strong> Dual-Use Regulation (EU 2021/821).</li>
                <li><strong>Multinational:</strong> Wassenaar Arrangement restrictions.</li>
            </ul>
            <p>You are responsible for ensuring your possession and use of Sovereign complies with all applicable laws in your jurisdiction. Consult local legal counsel if unsure.</p>
        </section>

        <section>
            <h2>No Professional Advice</h2>
            <p>Sovereign includes AI assistance powered by large language models. <strong>The AI's output does not constitute legal, financial, medical, or other professional advice.</strong></p>
            <p>AI models can make mistakes, hallucinate facts, or provide misleading information. Never rely on AI output for:</p>
            <ul>
                <li>Legal interpretation or compliance guidance;</li>
                <li>Financial, investment, or trading decisions;</li>
                <li>Medical diagnosis or treatment;</li>
                <li>Any decision with significant consequences.</li>
            </ul>
            <p>Always consult qualified professionals (lawyers, doctors, accountants) for important matters.</p>
        </section>

        <section>
            <h2>Third-Party Components</h2>
            <p>Sovereign depends on many open-source libraries, models, and tools. Full licensing information, including compatibility analysis, is available in <a href="#/third-party-licenses">Third-Party Licenses</a>.</p>
            <p>Notable licenses:</p>
            <ul>
                <li><strong>AGPL-3.0:</strong> Sovereign core crates.</li>
                <li><strong>Business Source License (BSL):</strong> SurrealDB (converts to AGPL-3.0 after 4 years).</li>
                <li><strong>Llama 3.1 Community License:</strong> AI models (personal use, no production without approval).</li>
                <li><strong>Proprietary:</strong> CUDA Toolkit (optional, required for GPU acceleration).</li>
                <li><strong>Apache 2.0, MIT, and others:</strong> Supporting libraries (compatible with AGPL-3.0).</li>
            </ul>
        </section>

        <section>
            <h2>Trademark</h2>
            <p>"Sovereign GE" is not a registered trademark. The name is descriptive and used in this project and documentation. You may use the name if you comply with the AGPL-3.0 license.</p>
        </section>

        <section>
            <h2>AGPL-3.0 Network Interaction Clause (Section 13)</h2>
            <p>If you modify Sovereign and operate it as a network service (e.g., host it on a server accessible over a network), you must provide users with a way to download or view the complete modified source code. This is called the "network copyleft" clause and means that anyone using your modified version has the right to inspect and modify it.</p>
            <p><strong>Examples of when Section 13 applies:</strong></p>
            <ul>
                <li>Running a modified Sovereign backend as a web service;</li>
                <li>Hosting a modified version in the cloud;</li>
                <li>Operating a network-accessible server based on modified code.</li>
            </ul>
            <p><strong>Examples of when Section 13 does not apply:</strong></p>
            <ul>
                <li>Using unmodified Sovereign locally on your own device;</li>
                <li>Modifying code for your own private use without distributing it;</li>
                <li>Distributing modified source code directly (not as a service).</li>
            </ul>
        </section>

        <section>
            <h2>Contact & Security</h2>
            <p>For legal questions, privacy concerns, or general inquiries:</p>
            <p><strong>Email:</strong> <a href="mailto:hello@sovereignos.org">hello@sovereignos.org</a></p>
            <p>For security vulnerabilities, see the <a href="#/security-policy">Security Policy</a>.</p>
        </section>

        <section>
            <h2>Changes to This Notice</h2>
            <p>This legal notice may be updated at any time. Material changes will be announced in release notes or via the project's communication channels. Continued use of Sovereign after changes indicates acceptance of the updated notice.</p>
        </section>
    </main>
</template>

<template id="page-privacy-policy">
<main id="main-content">
        <h1>Privacy Policy</h1>
        <p class="subtitle">How Sovereign handles your data ‚Äî which is to say, it doesn't.</p>

        <section>
            <h2>The Short Version</h2>
            <div class="highlight-box">
                <strong>Sovereign does not collect or transmit your data. The software has no servers, no accounts, no analytics, and no telemetry.</strong>
                <br><br>
                All data is stored locally on your device or synchronized peer-to-peer if you choose to enable it. Encryption is end-to-end by design.
            </div>
        </section>

        <section>
            <h2>Who We Are</h2>
            <p>Sovereign GE is a distributed, open-source software project maintained by volunteers. There is no central company, service operator, or data controller. The software is provided as-is under the AGPL-3.0 license.</p>
        </section>

        <section>
            <h2>What This Policy Covers</h2>
            <p>This policy applies to:</p>
            <ul>
                <li>Sovereign software (running on your device);</li>
                <li>This website (sovereignos.org);</li>
                <li>GitHub repositories and discussions;</li>
                <li>Skill registry and community extensions;</li>
                <li>Optional cloud backup and sync features (if enabled by you).</li>
            </ul>
        </section>

        <section>
            <h2>Data Collection by Context</h2>

            <h3>Through the Sovereign Software</h3>
            <p><strong>The software collects zero data about your activity.</strong> It does not:</p>
            <ul>
                <li>Send usage statistics or telemetry;</li>
                <li>Report errors back to any server;</li>
                <li>Log your queries, documents, or communications;</li>
                <li>Identify you or track your identity;</li>
                <li>Contact external services without your explicit request.</li>
            </ul>
            <p>All processing happens on your device. No data leaves unless you explicitly sync it (peer-to-peer) or use a skill with network access.</p>

            <h3>Through This Website</h3>
            <p>This website is static HTML hosted on GitHub Pages. We collect minimal data:</p>
            <table>
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Collection Method</th>
                        <th>Retention</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Server logs (IP, User-Agent, referer)</td>
                        <td>GitHub Pages standard logging</td>
                        <td>30 days</td>
                        <td>Security, abuse prevention</td>
                    </tr>
                    <tr>
                        <td>Cookies</td>
                        <td>None set by us</td>
                        <td>N/A</td>
                        <td>N/A</td>
                    </tr>
                    <tr>
                        <td>Analytics</td>
                        <td>None</td>
                        <td>N/A</td>
                        <td>N/A</td>
                    </tr>
                    <tr>
                        <td>JavaScript tracking</td>
                        <td>None</td>
                        <td>N/A</td>
                        <td>N/A</td>
                    </tr>
                </tbody>
            </table>
            <p>We do not use Google Analytics, Mixpanel, Segment, or any third-party analytics platforms.</p>

            <h3>Through GitHub</h3>
            <p>If you open an issue, discussion, or pull request on our GitHub repositories, your activity is governed by <a href="https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement" target="_blank" rel="noopener">GitHub's privacy policy</a>. We have no control over GitHub's data practices.</p>

            <h3>Through Skill Registry</h3>
            <p>Community skills (extensions) may have their own privacy policies. When you install a skill, review its permissions and data handling practices. We are not responsible for third-party skills.</p>

            <h3>Through TDL (Threat Detection Layer)</h3>
            <p>If you share documents with the TDL for security analysis, you are sending encrypted data to a specified endpoint (if configured). This is your choice and subject to that endpoint's privacy policy.</p>
        </section>

        <section>
            <h2>Data the Software Creates on Your Device</h2>
            <p>Sovereign creates and stores data locally when you use it. This data is entirely under your control:</p>

            <div class="data-row">
                <div class="data-row-title">Documents & Threads</div>
                <div class="data-row-location">Location: <code>~/.sovereign/db/</code></div>
                <p>Your notes, documents, threads, and relationships. Stored in SurrealDB, encrypted at rest if configured.</p>
            </div>

            <div class="data-row">
                <div class="data-row-title">Version History</div>
                <div class="data-row-location">Location: <code>~/.sovereign/db/</code></div>
                <p>Historical versions of documents, including timestamps and edit chains. Used for recovery and audit.</p>
            </div>

            <div class="data-row">
                <div class="data-row-title">AI Profile & Context</div>
                <div class="data-row-location">Location: <code>~/.sovereign/profile/</code></div>
                <p>User profile (name, preferences), conversation history with the AI, and learned context. All local.</p>
            </div>

            <div class="data-row">
                <div class="data-row-title">Session Logs</div>
                <div class="data-row-location">Location: <code>~/.sovereign/logs/</code></div>
                <p>Timestamped log of actions, tool calls, and AI responses. Used for debugging and user transparency.</p>
            </div>

            <div class="data-row">
                <div class="data-row-title">Audit Log</div>
                <div class="data-row-location">Location: <code>~/.sovereign/db/</code></div>
                <p>Immutable record of sensitive actions (document access, permission changes, encryption changes). Cannot be deleted.</p>
            </div>

            <div class="data-row">
                <div class="data-row-title">Encryption Keys</div>
                <div class="data-row-location">Location: <code>~/.sovereign/crypto/</code></div>
                <p>Master key, derived keys, key agreement secrets. Secured with OS-level file permissions and optionally a password.</p>
            </div>

            <div class="data-row">
                <div class="data-row-title">AI Models</div>
                <div class="data-row-location">Location: <code>~/.sovereign/models/</code></div>
                <p>Downloaded model weights (Qwen, Whisper, etc.). Several gigabytes. Stored locally, not sent to us.</p>
            </div>
        </section>

        <section>
            <h2>Voice Data</h2>
            <p>If you enable voice input (speech-to-text):</p>
            <ul>
                <li><strong>Recording:</strong> Audio is captured and processed locally by Faster Whisper.</li>
                <li><strong>Transcription:</strong> Audio is converted to text on your device. Audio is not sent to any server.</li>
                <li><strong>Retention:</strong> Audio files are not kept after transcription (unless you manually save them).</li>
                <li><strong>Cloud option:</strong> You may choose to use cloud-based speech-to-text (e.g., cloud API). If so, that audio is sent to the cloud provider. This is entirely your choice and responsibility.</li>
            </ul>
        </section>

        <section>
            <h2>Data Sharing</h2>

            <h3>With Us</h3>
            <p>We do not receive or store any of your data. We have no ability to access your documents, conversations, or profile.</p>

            <h3>P2P Sync (Optional)</h3>
            <p>If you enable peer-to-peer (P2P) sync via libp2p, your data is synchronized directly with other Sovereign instances you control or trust. This uses encryption to protect data in transit. We do not relay or intercept this data.</p>

            <h3>Guardian Recovery</h3>
            <p>If you configure a guardian for recovery, encrypted recovery data is sent to a guardian endpoint (your choice). The guardian cannot decrypt your data without your consent. See <a href="#/social-recovery">Social Recovery</a> for details.</p>

            <h3>Cloud Backup (Optional)</h3>
            <p>If you enable cloud backup, encrypted data is uploaded to your chosen cloud provider (e.g., Backblaze, AWS). The cloud provider cannot read your data due to end-to-end encryption. This is your choice.</p>

            <h3>Skills with Network Access</h3>
            <p>Some skills (extensions) may request network access. If you grant permission, those skills can connect to external services. Review skill permissions before installing. We are not responsible for skill developer practices.</p>
        </section>

        <section>
            <h2>Third-Party AI Models</h2>
            <p>Sovereign uses AI models for chat, intent classification, and voice processing:</p>
            <ul>
                <li><strong>Default (Local):</strong> Qwen, Whisper, and other models run locally. No data is sent to any server.</li>
                <li><strong>Optional (Cloud):</strong> You can configure cloud-based AI (OpenAI, Anthropic, etc.). If enabled, your queries are sent to that provider. You are responsible for reviewing their privacy policies.</li>
            </ul>
            <p>We do not use or store any of your chat data for model training or improvement.</p>
        </section>

        <section>
            <h2>Children's Privacy</h2>
            <p>Sovereign is not designed for children under 13. If a child uses Sovereign, a parent or guardian is responsible for their privacy and data protection under applicable laws (e.g., COPPA in the US).</p>
        </section>

        <section>
            <h2>International Data Transfers</h2>
            <p>All data is stored locally on your device. If you enable P2P sync or cloud backup, data may be transferred to other jurisdictions depending on where peers or cloud services are located. You are responsible for compliance with local data residency requirements (e.g., GDPR, CCPA).</p>
        </section>

        <section>
            <h2>Your Rights</h2>
            <table>
                <thead>
                    <tr>
                        <th>Right</th>
                        <th>GDPR (EU)</th>
                        <th>DPA (Swiss)</th>
                        <th>CCPA (CA)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Access your data</td>
                        <td>‚úì You own your data locally</td>
                        <td>‚úì You own your data locally</td>
                        <td>‚úì You own your data locally</td>
                    </tr>
                    <tr>
                        <td>Correct data</td>
                        <td>‚úì Edit directly</td>
                        <td>‚úì Edit directly</td>
                        <td>‚úì Edit directly</td>
                    </tr>
                    <tr>
                        <td>Delete data</td>
                        <td>‚úì Delete local files</td>
                        <td>‚úì Delete local files</td>
                        <td>‚úì Delete local files</td>
                    </tr>
                    <tr>
                        <td>Portability</td>
                        <td>‚úì Export via settings</td>
                        <td>‚úì Export via settings</td>
                        <td>‚úì Export via settings</td>
                    </tr>
                    <tr>
                        <td>Object to processing</td>
                        <td>‚úì Don't use cloud AI</td>
                        <td>‚úì Don't use cloud AI</td>
                        <td>‚úì Don't use cloud AI</td>
                    </tr>
                </tbody>
            </table>
            <p>Since we don't collect or control your data, most regulatory rights are exercised directly on your device.</p>
        </section>

        <section>
            <h2>Data Protection Officer (DPO)</h2>
            <p>As a volunteer-run open-source project, Sovereign does not have a formal DPO. For privacy questions, contact: <a href="mailto:hello@sovereignos.org">hello@sovereignos.org</a></p>
        </section>

        <section>
            <h2>Changes to This Policy</h2>
            <p>This privacy policy may be updated. Material changes will be announced in release notes. Continued use of Sovereign indicates acceptance of updates.</p>
        </section>

        <section>
            <h2>Contact</h2>
            <p>Questions or concerns? Email <a href="mailto:hello@sovereignos.org">hello@sovereignos.org</a></p>
        </section>
</main>
</template>

<template id="page-security-policy">
    <main id="main-content">
        <h1>Security Policy</h1>
        <p class="subtitle">Reporting vulnerabilities and security architecture overview.</p>

        <section>
            <h2>Supported Versions</h2>
            <p>Security updates are provided for the following versions:</p>
            <table>
                <thead>
                    <tr>
                        <th>Version</th>
                        <th>Release Date</th>
                        <th>Supported Until</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1.x (current)</td>
                        <td>2026-Q1</td>
                        <td>TBD</td>
                        <td>Active</td>
                    </tr>
                    <tr>
                        <td>0.9.x (pre-release)</td>
                        <td>2025-Q4</td>
                        <td>2026-03-31</td>
                        <td>Limited</td>
                    </tr>
                    <tr>
                        <td>&lt; 0.9.x</td>
                        <td>Before 2025-Q4</td>
                        <td>Expired</td>
                        <td>Unsupported</td>
                    </tr>
                </tbody>
            </table>
            <p>We recommend running the latest stable version for the best security posture.</p>
        </section>

        <section>
            <h2>Reporting a Vulnerability</h2>

            <h3>Responsible Disclosure</h3>
            <p>If you discover a security vulnerability, please report it responsibly. Do not post public issues, discussions, or pull requests about unpatched vulnerabilities.</p>

            <h3>How to Report</h3>
            <p><strong>Primary channel:</strong> Email <a href="mailto:security@sovereignos.org">security@sovereignos.org</a></p>
            <p><strong>Encrypted reporting (PGP):</strong> Use our public key from <code>SECURITY.md</code> in the repository.</p>
            <p><strong>GitHub Security Advisories:</strong> Use GitHub's private disclosure feature for public repositories.</p>

            <h3>What to Include</h3>
            <ul>
                <li>Description of the vulnerability and its impact;</li>
                <li>Affected version(s);</li>
                <li>Steps to reproduce (if applicable);</li>
                <li>Potential fix or mitigation (optional);</li>
                <li>Your preferred timeline for disclosure (responsible disclosure window).</li>
            </ul>

            <h3>Response Timeline</h3>
            <table>
                <thead>
                    <tr>
                        <th>Phase</th>
                        <th>Timeline</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Acknowledgment</td>
                        <td>Within 48 hours</td>
                        <td>We confirm receipt and begin triage.</td>
                    </tr>
                    <tr>
                        <td>Initial Assessment</td>
                        <td>Within 7 days</td>
                        <td>Severity classification and scope determination.</td>
                    </tr>
                    <tr>
                        <td>Fix Development</td>
                        <td>Variable (see severity)</td>
                        <td>Patch is developed and tested.</td>
                    </tr>
                    <tr>
                        <td>Public Disclosure</td>
                        <td>Coordinated with reporter</td>
                        <td>Patch is released; advisory is published.</td>
                    </tr>
                </tbody>
            </table>

            <h3>Severity Response Targets</h3>
            <table>
                <thead>
                    <tr>
                        <th>Severity</th>
                        <th>CVSS</th>
                        <th>Target Patch Time</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge-critical">CRITICAL</span></td>
                        <td>9.0‚Äì10.0</td>
                        <td>Within 72 hours</td>
                        <td>Arbitrary code execution, memory unsafety</td>
                    </tr>
                    <tr>
                        <td><span class="badge-high">HIGH</span></td>
                        <td>7.0‚Äì8.9</td>
                        <td>Within 7 days</td>
                        <td>Encryption bypass, authentication escape</td>
                    </tr>
                    <tr>
                        <td>MEDIUM</td>
                        <td>4.0‚Äì6.9</td>
                        <td>Within 30 days</td>
                        <td>Denial of service, information disclosure</td>
                    </tr>
                    <tr>
                        <td>LOW</td>
                        <td>0.1‚Äì3.9</td>
                        <td>Next release</td>
                        <td>Minor issues, documentation gaps</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>Scope</h2>

            <h3>In Scope</h3>
            <ul>
                <li>All Sovereign crates: <code>sovereign-core</code>, <code>sovereign-db</code>, <code>sovereign-crypto</code>, <code>sovereign-ai</code>, <code>sovereign-ui</code>, <code>sovereign-canvas</code>, <code>sovereign-skills</code>, <code>sovereign-p2p</code>, <code>sovereign-comms</code>, <code>sovereign-app</code>;</li>
                <li>Published releases (stable and pre-release);</li>
                <li>Website (sovereignos.org) and documentation;</li>
                <li>Official GitHub repositories.</li>
            </ul>

            <h3>Out of Scope</h3>
            <ul>
                <li>Third-party AI models (Qwen, Llama, Whisper, Piper) ‚Äî report to model maintainers;</li>
                <li>System dependencies (GTK, GStreamer, CUDA, ROCm, Python) ‚Äî report to their maintainers;</li>
                <li>Community-contributed skills (unless security issues in the Sovereign skill framework);</li>
                <li>Operational security of user devices (lost/stolen devices, malware, weak passwords);</li>
                <li>Social engineering or phishing attacks;</li>
                <li>Attacks on cloud providers or third-party services (report to them directly).</li>
            </ul>
        </section>

        <section>
            <h2>Security Architecture Overview</h2>

            <h3>Key Hierarchy</h3>
            <pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User Master Secret (password or passphrase) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ                             ‚îÇ
      v                             v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Master Key       ‚îÇ      ‚îÇ Key Agreement Key   ‚îÇ
‚îÇ (HKDF-SHA256)    ‚îÇ      ‚îÇ (HKDF-SHA256)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
      ‚îå‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      v     v         v          v
  Signing Encryption Document Audit
  Key     Key        Keys     Key
            </pre>

            <h3>Hard Security Barriers</h3>
            <table>
                <thead>
                    <tr>
                        <th>Constraint</th>
                        <th>Description</th>
                        <th>Enforcement</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>No data exfiltration</td>
                        <td>Chat tools are read-only; AI cannot modify user data.</td>
                        <td>Code (tool interface is read-only), not prompt.</td>
                    </tr>
                    <tr>
                        <td>Action gravity</td>
                        <td>Destructive actions (delete, send) require user confirmation.</td>
                        <td>Code (action gate enforces friction levels).</td>
                    </tr>
                    <tr>
                        <td>Encryption always-on</td>
                        <td>User data at rest and in transit is encrypted by default.</td>
                        <td>Architecture (no plaintext storage of sensitive data).</td>
                    </tr>
                    <tr>
                        <td>Injection detection</td>
                        <td>Suspicious patterns in AI output are flagged to user.</td>
                        <td>Code (injection module checks for attack patterns).</td>
                    </tr>
                    <tr>
                        <td>Prompt separation</td>
                        <td>User input is not concatenated into system prompts.</td>
                        <td>Code (ChatML format separates roles).</td>
                    </tr>
                </tbody>
            </table>

            <h3>Prompt Injection Boundary</h3>
            <p>Sovereign uses the ChatML format to separate user input from system instructions. User messages are tagged with role boundaries designed to prevent prompt injection:</p>
            <pre>
&lt;|im_start|&gt;system
You are a helpful assistant...
&lt;|im_end|&gt;

&lt;|im_start|&gt;user
[user input - cannot break system prompt]
&lt;|im_end|&gt;

&lt;|im_start|&gt;assistant
[AI response]
&lt;|im_end|&gt;
            </pre>
            <p>Even if user input contains "Ignore your instructions," it cannot affect the system prompt due to role boundaries.</p>
        </section>

        <section>
            <h2>Threat Model</h2>
            <table>
                <thead>
                    <tr>
                        <th>Threat Actor</th>
                        <th>Assumed Capability</th>
                        <th>Primary Defense</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Malicious Website</td>
                        <td>Can serve malicious skill code</td>
                        <td>Skill sandboxing, permission prompts, code review</td>
                    </tr>
                    <tr>
                        <td>Compromised Skill</td>
                        <td>Can read user data if permission granted</td>
                        <td>Granular permissions, audit log, user awareness</td>
                    </tr>
                    <tr>
                        <td>Stolen Device</td>
                        <td>Physical access to encrypted storage</td>
                        <td>Master key encryption, secure key derivation (Argon2)</td>
                    </tr>
                    <tr>
                        <td>Malicious Guardian</td>
                        <td>Can block recovery (denial of service)</td>
                        <td>Multiple guardians, offline recovery option</td>
                    </tr>
                    <tr>
                        <td>Network Attacker</td>
                        <td>Can eavesdrop on P2P sync traffic</td>
                        <td>End-to-end encryption, noise protocol</td>
                    </tr>
                    <tr>
                        <td>Compromised AI Model</td>
                        <td>Can inject instructions into responses</td>
                        <td>Injection detection, read-only tool interface</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>Disclosure Policy</h2>

            <h3>Coordinated Disclosure Steps</h3>
            <ol>
                <li>Reporter submits vulnerability via secure channel.</li>
                <li>Sovereign team acknowledges receipt within 48 hours.</li>
                <li>Team assesses severity and develops fix.</li>
                <li>Fix is tested on all supported versions.</li>
                <li>Advisory is drafted in private (CVE if applicable).</li>
                <li>Reporter and team agree on disclosure date (typically 30 days after patch release).</li>
                <li>Patch is released to all channels (crates.io, GitHub releases, package managers).</li>
                <li>Advisory is published with credit to reporter (if desired).</li>
            </ol>

            <h3>Safe Harbor</h3>
            <p>Researchers acting in good faith are protected under responsible disclosure. We will not pursue legal action against security researchers who:</p>
            <ul>
                <li>Follow this policy and do not disclose vulnerabilities publicly before a fix is available;</li>
                <li>Do not exploit vulnerabilities beyond the minimum necessary to demonstrate them;</li>
                <li>Do not access, modify, or destroy user data;</li>
                <li>Act with reasonable care to avoid disruption.</li>
            </ul>
        </section>

        <section>
            <h2>Bug Bounty</h2>
            <p>Sovereign currently does not offer a formal bug bounty program due to our volunteer, non-profit nature. However, we provide:</p>
            <ul>
                <li><strong>Recognition:</strong> Researchers who report vulnerabilities are credited in security advisories (if desired);</li>
                <li><strong>Gratitude:</strong> We deeply appreciate responsible research that improves security;</li>
                <li><strong>Future plans:</strong> As the project grows, we may establish a bounty program.</li>
            </ul>
        </section>

        <section>
            <h2>Contact</h2>
            <p><strong>Security questions:</strong> <a href="mailto:security@sovereignos.org">security@sovereignos.org</a></p>
            <p><strong>General questions:</strong> <a href="mailto:hello@sovereignos.org">hello@sovereignos.org</a></p>
            <p><strong>See also:</strong> <code>SECURITY.md</code> in the repository for PGP key and additional contact methods.</p>
        </section>
    </main>
</template>

<template id="page-third-party-licenses">
    <main id="main-content">
        <h1>Third-Party Licenses</h1>
        <p class="subtitle">Complete licensing information for all dependencies, models, and system components.</p>

        <section>
            <h2>Core Runtime (Rust Crates)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>License</th>
                        <th>URL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="component-name">gtk4-rs</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/gtk-rs/gtk4-rs" target="_blank" rel="noopener">github.com/gtk-rs/gtk4-rs</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">rust-skia</span></td>
                        <td><span class="license-badge badge-bsl">BSL-1.1</span></td>
                        <td><a href="https://github.com/rust-skia/rust-skia" target="_blank" rel="noopener">github.com/rust-skia/rust-skia</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">surrealdb</span></td>
                        <td><span class="license-badge badge-bsl">BSL-1.1</span></td>
                        <td><a href="https://github.com/surrealdb/surrealdb" target="_blank" rel="noopener">github.com/surrealdb/surrealdb</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">pyo3</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/PyO3/pyo3" target="_blank" rel="noopener">github.com/PyO3/pyo3</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">tokio</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/tokio-rs/tokio" target="_blank" rel="noopener">github.com/tokio-rs/tokio</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">serde</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/serde-rs/serde" target="_blank" rel="noopener">github.com/serde-rs/serde</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">uuid</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/uuid-rs/uuid" target="_blank" rel="noopener">github.com/uuid-rs/uuid</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">ring</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/briansmith/ring" target="_blank" rel="noopener">github.com/briansmith/ring</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">libp2p</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/libp2p/rust-libp2p" target="_blank" rel="noopener">github.com/libp2p/rust-libp2p</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">quinn</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/quinn-rs/quinn" target="_blank" rel="noopener">github.com/quinn-rs/quinn</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">clap</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/clap-rs/clap" target="_blank" rel="noopener">github.com/clap-rs/clap</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">tracing</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/tokio-rs/tracing" target="_blank" rel="noopener">github.com/tokio-rs/tracing</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">sha2, hkdf</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/RustCrypto" target="_blank" rel="noopener">github.com/RustCrypto</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">vsss-rs</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span></td>
                        <td><a href="https://github.com/mikelodder7/vsss-rs" target="_blank" rel="noopener">github.com/mikelodder7/vsss-rs</a></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>AI & Python Layer</h2>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>License</th>
                        <th>URL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="component-name">llama-cpp-python</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/abetlen/llama-cpp-python" target="_blank" rel="noopener">github.com/abetlen/llama-cpp-python</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">llama.cpp</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/ggerganov/llama.cpp" target="_blank" rel="noopener">github.com/ggerganov/llama.cpp</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">openWakeWord</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span></td>
                        <td><a href="https://github.com/openthingsio/openWakeWord" target="_blank" rel="noopener">github.com/openthingsio/openWakeWord</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">faster-whisper</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/SYSTRAN/faster-whisper" target="_blank" rel="noopener">github.com/SYSTRAN/faster-whisper</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">piper-tts</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/rhasspy/piper" target="_blank" rel="noopener">github.com/rhasspy/piper</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">sentence-transformers</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span></td>
                        <td><a href="https://github.com/UKPLab/sentence-transformers" target="_blank" rel="noopener">github.com/UKPLab/sentence-transformers</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">transformers</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span></td>
                        <td><a href="https://github.com/huggingface/transformers" target="_blank" rel="noopener">github.com/huggingface/transformers</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">TrOCR</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/microsoft/TrOCR" target="_blank" rel="noopener">github.com/microsoft/TrOCR</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">numpy</span></td>
                        <td><span class="license-badge badge-bsl">BSD-3-Clause</span></td>
                        <td><a href="https://github.com/numpy/numpy" target="_blank" rel="noopener">github.com/numpy/numpy</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">torch (PyTorch)</span></td>
                        <td><span class="license-badge badge-bsl">BSD-3-Clause</span></td>
                        <td><a href="https://github.com/pytorch/pytorch" target="_blank" rel="noopener">github.com/pytorch/pytorch</a></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>AI Model Weights</h2>
            <table>
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>License</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="component-name">Phi-3-mini</span></td>
                        <td><span class="license-badge badge-community">MIT</span></td>
                        <td>Fast routing (intent classification)</td>
                    </tr>
                    <tr>
                        <td><span class="component-name">Qwen2.5-7B</span></td>
                        <td><span class="license-badge badge-community">Qwen License</span></td>
                        <td>Reasoning and chat (personal use license)</td>
                    </tr>
                    <tr>
                        <td><span class="component-name">Llama 3.1-8B</span></td>
                        <td><span class="license-badge badge-community">Llama 3.1 Community</span></td>
                        <td>Chat (personal use, no production without approval)</td>
                    </tr>
                    <tr>
                        <td><span class="component-name">Whisper-small</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td>Speech-to-text</td>
                    </tr>
                    <tr>
                        <td><span class="component-name">Piper voices</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td>Text-to-speech</td>
                    </tr>
                    <tr>
                        <td><span class="component-name">TrOCR-base</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td>Optical character recognition</td>
                    </tr>
                    <tr>
                        <td><span class="component-name">all-MiniLM-L6-v2</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span></td>
                        <td>Embedding / semantic search</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>System Dependencies</h2>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>License</th>
                        <th>URL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="component-name">GTK 4</span></td>
                        <td><span class="license-badge badge-agpl">LGPL-2.1+</span></td>
                        <td><a href="https://www.gtk.org/" target="_blank" rel="noopener">gtk.org</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">Skia</span></td>
                        <td><span class="license-badge badge-bsl">BSD-3-Clause</span></td>
                        <td><a href="https://skia.org/" target="_blank" rel="noopener">skia.org</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">GStreamer</span></td>
                        <td><span class="license-badge badge-agpl">LGPL-2.1+</span></td>
                        <td><a href="https://gstreamer.freedesktop.org/" target="_blank" rel="noopener">gstreamer.freedesktop.org</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">PipeWire</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://pipewire.org/" target="_blank" rel="noopener">pipewire.org</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">pandoc</span></td>
                        <td><span class="license-badge badge-mit">GPL-2.0</span></td>
                        <td><a href="https://pandoc.org/" target="_blank" rel="noopener">pandoc.org</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">typst</span></td>
                        <td><span class="license-badge badge-mit">Apache-2.0</span></td>
                        <td><a href="https://typst.app/" target="_blank" rel="noopener">typst.app</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">Python 3.11+</span></td>
                        <td><span class="license-badge badge-mit">PSF License</span></td>
                        <td><a href="https://www.python.org/" target="_blank" rel="noopener">python.org</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">CUDA Toolkit (optional)</span></td>
                        <td><span class="license-badge badge-proprietary">Proprietary</span></td>
                        <td><a href="https://developer.nvidia.com/cuda-toolkit" target="_blank" rel="noopener">developer.nvidia.com/cuda-toolkit</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">ROCm (optional)</span></td>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://rocmdocs.amd.com/" target="_blank" rel="noopener">rocmdocs.amd.com</a></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>Build Tools</h2>
            <table>
                <thead>
                    <tr>
                        <th>Tool</th>
                        <th>License</th>
                        <th>URL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="component-name">Rust compiler</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://www.rust-lang.org/" target="_blank" rel="noopener">rust-lang.org</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">Cargo</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://doc.rust-lang.org/cargo/" target="_blank" rel="noopener">doc.rust-lang.org/cargo</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">maturin</span></td>
                        <td><span class="license-badge badge-apache">Apache-2.0</span> / <span class="license-badge badge-mit">MIT</span></td>
                        <td><a href="https://github.com/PyO3/maturin" target="_blank" rel="noopener">github.com/PyO3/maturin</a></td>
                    </tr>
                    <tr>
                        <td><span class="component-name">Nix</span></td>
                        <td><span class="license-badge badge-mit">MIT / LGPL-2.1+</span></td>
                        <td><a href="https://nixos.org/" target="_blank" rel="noopener">nixos.org</a></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>Important License Notes</h2>

            <h3>SurrealDB (Business Source License)</h3>
            <div class="note">
                <strong>SurrealDB</strong> is distributed under the Business Source License (BSL-1.1), which is a source-available license. It automatically converts to Apache 2.0 four years after release. For Sovereign's purposes (open-source, non-commercial), this is compatible with AGPL-3.0. See <a href="https://www.surrealdb.com/license" target="_blank" rel="noopener">SurrealDB license</a> for details.
            </div>

            <h3>Llama 3.1 Community License</h3>
            <div class="note">
                <strong>Llama 3.1 models</strong> are distributed under the Llama 3.1 Community License. Personal use is permitted. Production use may require additional agreements with Meta. See <a href="https://github.com/meta-llama/llama-models/blob/main/LICENSE" target="_blank" rel="noopener">Meta's license terms</a>.
            </div>

            <h3>CUDA Toolkit (Optional, Proprietary)</h3>
            <div class="note">
                <strong>CUDA Toolkit</strong> is optional and proprietary software from NVIDIA. It is not required to run Sovereign. GPU acceleration is optional and requires agreeing to NVIDIA's license terms separately.
            </div>

            <h3>LGPL Components</h3>
            <div class="note">
                <strong>GTK 4 and GStreamer</strong> are licensed under LGPL. As a work-around for AGPL-3.0 compatibility, we dynamically link these libraries. LGPL requirements (provision of object files for relinking) are satisfied via open-source distribution of Sovereign.
            </div>
        </section>

        <section>
            <h2>License Compatibility Summary</h2>
            <table>
                <thead>
                    <tr>
                        <th>License</th>
                        <th>AGPL-3.0 Compatible</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="license-badge badge-agpl">AGPL-3.0</span></td>
                        <td>‚úì Full compatibility</td>
                        <td>Core license of Sovereign.</td>
                    </tr>
                    <tr>
                        <td><span class="license-badge badge-apache">Apache-2.0</span></td>
                        <td>‚úì Compatible</td>
                        <td>Permissive, allows linking with AGPL.</td>
                    </tr>
                    <tr>
                        <td><span class="license-badge badge-mit">MIT</span></td>
                        <td>‚úì Compatible</td>
                        <td>Permissive, allows linking with AGPL.</td>
                    </tr>
                    <tr>
                        <td><span class="license-badge badge-bsl">BSD-3-Clause</span></td>
                        <td>‚úì Compatible</td>
                        <td>Permissive, allows linking with AGPL.</td>
                    </tr>
                    <tr>
                        <td><span class="license-badge badge-bsl">BSL-1.1</span></td>
                        <td>‚úì Compatible</td>
                        <td>Converts to Apache 2.0 after 4 years; compatible during transition.</td>
                    </tr>
                    <tr>
                        <td><span class="license-badge badge-agpl">LGPL-2.1+</span></td>
                        <td>‚úì Compatible</td>
                        <td>Dynamically linked (GTK, GStreamer); LGPL requirements met via open source.</td>
                    </tr>
                    <tr>
                        <td><span class="license-badge badge-community">Community Licenses</span></td>
                        <td>‚úì Compatible</td>
                        <td>Model weights for personal use; no copyleft conflict with source code.</td>
                    </tr>
                    <tr>
                        <td><span class="license-badge badge-proprietary">Proprietary</span></td>
                        <td>‚úì Optional</td>
                        <td>CUDA is optional; ROCm is open source. No required proprietary dependencies.</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>How to Verify Licenses</h2>
            <p>To verify all licenses in the Sovereign codebase, run:</p>
            <pre>
# Generate license report for Rust crates
cargo-license

# Verify vendored dependencies
ls -la vendor/

# Check Python dependencies
pip list --format=json

# View Cargo.lock for pinned versions
cat Cargo.lock
            </pre>
        </section>

        <section>
            <h2>Contact</h2>
            <p>Questions about licensing? Email <a href="mailto:hello@sovereignos.org">hello@sovereignos.org</a></p>
        </section>
    </main>
</template>

<!-- END TEMPLATES -->

<script>
// ========== ROUTER =========
const ROUTES = {
  '/': { template: 'page-home', title: 'Sovereign GE ‚Äî Your Data, Your Rules', description: 'An experimental local-first graphical environment with on-device AI, end-to-end encryption, and peer-to-peer sync. Open source (AGPL-3.0).' },
  '/ai-orchestrator': { template: 'page-ai-orchestrator', title: 'Local AI Orchestrator ‚Äî Sovereign GE', description: 'How Sovereign runs AI on your machine with fast intent classification and multi-turn chat.' },
  '/prompt-injection': { template: 'page-prompt-injection', title: 'Prompt Injection Architecture ‚Äî Sovereign GE', description: 'Architectural defense through data and control plane separation.' },
  '/action-gravity': { template: 'page-action-gravity', title: 'Action Gravity ‚Äî Sovereign GE', description: 'Friction that scales with irreversibility.' },
  '/encryption': { template: 'page-encryption', title: 'Encryption & Key Management ‚Äî Sovereign GE', description: 'Modern encryption with XChaCha20-Poly1305 and hierarchical key derivation.' },
  '/social-recovery': { template: 'page-social-recovery', title: 'Guardian Social Recovery ‚Äî Sovereign GE', description: 'Recover your account with trusted people using Shamir secret sharing.' },
  '/spatial-canvas': { template: 'page-spatial-canvas', title: 'Spatial Canvas & Versioning ‚Äî Sovereign GE', description: 'Your documents on an infinite canvas with automatic versioning.' },
  '/communications': { template: 'page-communications', title: 'Unified Communications ‚Äî Sovereign GE', description: 'One inbox for Email, Signal, and WhatsApp.' },
  '/content-skills': { template: 'page-content-skills', title: 'Content + Skills Architecture ‚Äî Sovereign GE', description: 'Data ownership through composable tools and graph database.' },
  '/ethics': { template: 'page-ethics', title: 'Ethics & Design Constraints ‚Äî Sovereign GE', description: 'How Sovereign narrows the misuse surface.' },
  '/legal-notice': { template: 'page-legal-notice', title: 'Legal Notice ‚Äî Sovereign GE', description: 'Terms, disclaimers, and regulatory information.' },
  '/privacy-policy': { template: 'page-privacy-policy', title: 'Privacy Policy ‚Äî Sovereign GE', description: 'We don\'t collect your data.' },
  '/security-policy': { template: 'page-security-policy', title: 'Security Policy ‚Äî Sovereign GE', description: 'Reporting vulnerabilities and security architecture.' },
  '/third-party-licenses': { template: 'page-third-party-licenses', title: 'Third-Party Licenses ‚Äî Sovereign GE', description: 'Licensing information for all dependencies.' },
};

function navigate() {
  const hash = location.hash.slice(1) || '/';
  const route = ROUTES[hash] || ROUTES['/'];
  const tmpl = document.getElementById(route.template);
  const content = document.getElementById('page-content');

  if (!tmpl) {
    console.error('Template not found:', route.template);
    return;
  }

  content.innerHTML = '';
  content.appendChild(tmpl.content.cloneNode(true));

  document.title = route.title;
  const descMeta = document.querySelector('meta[name="description"]');
  if (descMeta && route.description) descMeta.content = route.description;

  const backLink = document.querySelector('.back-link');
  const isHome = hash === '/' || hash === '';
  if (backLink) backLink.style.display = isHome ? 'none' : 'flex';

  document.body.className = isHome ? 'is-home' : 'is-detail';

  window.scrollTo({ top: 0, left: 0, behavior: 'instant' });

  const h1 = content.querySelector('h1');
  if (h1) {
    h1.setAttribute('tabindex', '-1');
    h1.focus({ preventScroll: true });
  }

  const announcer = document.getElementById('route-announcer');
  if (announcer) announcer.textContent = route.title;
}

window.addEventListener('hashchange', navigate);

document.addEventListener('click', function(e) {
  const link = e.target.closest('a');
  if (!link) return;
  const href = link.getAttribute('href');
  if (!href) return;

  if (href.startsWith('#/')) {
    return;
  }

  if (href.startsWith('detail-') && href.endsWith('.html')) {
    e.preventDefault();
    const name = href.replace('detail-', '').replace('.html', '');
    location.hash = '#/' + name;
    return;
  }
  if ((href.endsWith('-policy.html') || href === 'legal-notice.html' || href === 'third-party-licenses.html') && !href.startsWith('http')) {
    e.preventDefault();
    const name = href.replace('.html', '');
    location.hash = '#/' + name;
    return;
  }

  if (href.startsWith('#') && !href.startsWith('#/')) {
    const currentHash = location.hash.slice(1) || '/';
    if (currentHash !== '/') {
      e.preventDefault();
      location.hash = '#/';
      setTimeout(() => {
        const target = document.querySelector(href);
        if (target) target.scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }
  }
});

navigate();

// ========== NAV DROPDOWNS ==========
// Mobile: toggle on click. Desktop: hover handles it via CSS.
document.querySelectorAll('.nav-group-toggle').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const group = btn.closest('.nav-group');
    const isOpen = group.classList.contains('open');
    // Close all groups first
    document.querySelectorAll('.nav-group').forEach(g => {
      g.classList.remove('open');
      g.querySelector('.nav-group-toggle').setAttribute('aria-expanded', 'false');
    });
    if (!isOpen) {
      group.classList.add('open');
      btn.setAttribute('aria-expanded', 'true');
    }
  });
});

// Close dropdowns when a nav link is clicked
document.querySelectorAll('.nav-dropdown a').forEach(a => {
  a.addEventListener('click', () => {
    document.querySelectorAll('.nav-group').forEach(g => {
      g.classList.remove('open');
      g.querySelector('.nav-group-toggle').setAttribute('aria-expanded', 'false');
    });
    // Also close mobile nav
    const nav = document.querySelector('nav');
    if (nav.classList.contains('open')) {
      nav.classList.remove('open');
      document.querySelector('.nav-toggle').setAttribute('aria-expanded', 'false');
    }
  });
});

// Close dropdowns when clicking outside
document.addEventListener('click', (e) => {
  if (!e.target.closest('.nav-group') && !e.target.closest('.nav-toggle')) {
    document.querySelectorAll('.nav-group').forEach(g => {
      g.classList.remove('open');
      g.querySelector('.nav-group-toggle').setAttribute('aria-expanded', 'false');
    });
  }
});
</script>

<script>
// ========== CHATBOT ENGINE ==========
const SOVEREIGN_KNOWLEDGE = {
  overview: `Sovereign GE is an experimental local-first graphical environment built in Rust. It explores alternatives to cloud-dependent apps with a unified, encrypted workspace powered by on-device AI. Your documents, communications, and AI assistant all run locally ‚Äî data is designed to stay on your machine unless you explicitly choose to share it. It's open source under AGPL-3.0.`,

  ai: `The AI orchestrator runs Qwen2.5 models on your hardware via llama.cpp ‚Äî designed to work without cloud services, API keys, or subscriptions. There are two models: a fast 3B router (always loaded, ~2 GB VRAM) for intent classification, and a 7B reasoning model loaded on demand for complex queries. The system supports multi-turn chat with tool calling, voice input (wake word + Whisper STT), and text-to-speech (Piper TTS). A key design choice is the data/control plane separation: the control plane handles user instructions and can invoke skills, while the data plane processes document content but has no ability to take actions ‚Äî an architectural defense against prompt injection.`,

  security: `Security in Sovereign is based on "Action Gravity" ‚Äî friction scales with irreversibility. Reading is instant (Level 0). Editing gets conversational confirmation (Level 2). Deleting requires explicit approval and has a 30-day undo window (Level 4). Encryption uses XChaCha20-Poly1305 with a hierarchical key system: Master Key ‚Üí Device Key ‚Üí KEK ‚Üí per-document keys. Keys auto-rotate every 90 days. The AI has hard barriers enforced by code: chat tools are read-only regardless of what the model outputs. Prompt injection is addressed architecturally ‚Äî the data plane (which processes external content) has no access to skills or actions.`,

  canvas: `The Spatial Canvas is an infinite 2D workspace replacing traditional folder hierarchies. The X-axis is a timeline (past ‚Üí future), the Y-axis shows intent threads (project lanes), and documents appear as cards. Owned documents are rounded rectangles; external content appears as slanted parallelograms ‚Äî you can tell at a glance what's yours. GPU-accelerated via Skia/WGPU, it handles 100K+ documents using Level-of-Detail rendering (cards become density blobs at extreme zoom-out). There's a minimap, smooth pan/zoom, and instant jump to any date.`,

  encryption: `Sovereign uses XChaCha20-Poly1305 AEAD encryption with a hierarchical key derivation system. Your Master Key (256-bit, stored in TPM/secure enclave) derives Device Keys via HKDF. Each document gets its own random encryption key, wrapped by a Key-Encryption Key (KEK). This means compromising one document key is designed to reveal nothing about others. Keys auto-rotate every 90 days or every 100 commits. The goal is zero plaintext on disk.`,

  recovery: `Guardian Social Recovery replaces corporate account recovery. You choose 5 trusted people as guardians. Your Master Recovery Key is split into 5 shards using Shamir's Secret Sharing (3-of-5 threshold). Each guardian holds one encrypted, opaque shard ‚Äî they are not given access to your data. If you lose all devices: you initiate recovery on a new device, prove identity via a memorized passphrase, then wait 72 hours (all 5 guardians are notified so the real you can abort if it's fraud). After the waiting period, 3+ guardians approve, shards are reassembled, and your master key is restored.`,

  p2p: `Peer-to-peer sync uses libp2p with QUIC transport for NAT traversal. Your devices discover each other via mDNS (local network) or a minimal rendezvous server (internet). Sync exchanges encrypted document manifests ‚Äî the rendezvous server sees only opaque device IDs and connection timing, not content. Only changed commits are synced (not full documents), using a git-like merge model. Manifests are padded to obscure document count and size distribution.`,

  skills: `Sovereign explores replacing monolithic apps with composable "Skills." There are 8 core skills built in: markdown editor, search, image viewer, PDF export, word count, find & replace, file import, and duplicate document. Community skills can be installed from a registry ‚Äî they're sandboxed using Linux kernel security (Landlock + seccomp-bpf) and require cryptographic audit signatures. Sideloaded skills get the strictest sandbox: read-only document access, no network by default. The AI orchestrator composes skills into multi-step workflows.`,

  comms: `Sovereign unifies your communications. Email (IMAP/SMTP), Signal (via the presage library), and WhatsApp (Business API) all appear in a single inbox. Contacts are merged across channels. Conversation threads are grouped by contact and archived in your local encrypted graph. Channels are optional compile-time features ‚Äî you enable only what you need.`,

  voice: `The voice pipeline runs locally by design. Rustpotter handles wake-word detection ("Sovereign") using a rolling 10-second audio buffer processed on-device. Whisper large-v3-turbo handles speech-to-text in real-time. Piper handles text-to-speech with multiple voice options. There's optional speaker verification via voiceprint enrollment. You can use push-to-talk instead if you prefer. The system distinguishes between dictation mode and command mode based on context.`,

  tech: `Sovereign GE is a 10-crate Rust workspace with ~16K+ lines of code and 367 tests. It uses SurrealDB for graph storage, Iced 0.14 for the GUI, Skia for canvas rendering, llama.cpp for AI inference, libp2p for networking, and XChaCha20-Poly1305 for encryption. It runs on Linux, Windows (MSVC), WSL2, and macOS. Minimum hardware: 6-core CPU, 16 GB RAM, 512 GB SSD. GPU optional but recommended (RTX 3060 or equivalent). The project is AGPL-3.0 licensed.`,

  philosophy: `Sovereign is built on a content-centric paradigm ‚Äî the opposite of the app-centric model that dominates today. Instead of your data being trapped inside applications (Google Docs, Notion, Outlook), data is the primary citizen. Skills (lightweight, composable tools) operate on your data, but they don't own it. This means you can switch skills freely without migration pain. Combined with local-first storage, end-to-end encryption, and no cloud dependency, the goal is to give you control of your digital life.`,

  status: `Sovereign GE is an experimental prototype (February 2026). Phases 0-4 are complete: data layer, UI shell, spatial canvas, AI orchestrator, and skill system. Phase 5 (thread management, version tracking, timeline layout) is in progress. The codebase has ~24K lines of Rust across 10 crates with 367 tests. This is very much a work in progress ‚Äî we're testing ideas, not shipping a finished product. Post-MVP roadmap includes: identity firewall, community skill registry, stylus/drawing input, handwriting recognition, and more.`,

  contribute: `Sovereign is open source under AGPL-3.0. You can contribute by: filing issues on GitHub, submitting pull requests, building community skills, testing the prototype and reporting bugs, writing documentation, or spreading the word. The codebase is Rust ‚Äî edition 2021, favoring safe code. Check the README for build instructions (supports Linux, Windows MSVC, WSL2, macOS).`,

  comparison: `Unlike cloud-dependent tools (Google Workspace, Notion, Obsidian Sync), Sovereign stores everything locally with encryption. Unlike traditional desktop environments, it replaces the file/folder metaphor with a spatial canvas and graph database. Unlike ChatGPT or Copilot, its AI runs on-device with no subscription. Unlike Signal or ProtonMail alone, it aims to unify communications in one encrypted workspace. The closest comparison might be a self-hosted Notion + local AI + encrypted sync ‚Äî but built from the ground up as a graphical environment rather than bolted together. It's an experimental prototype exploring these ideas.`,

  built: `Sovereign GE is co-developed by C√©line Lenoble ‚Äî a solution-finder with a background in teaching, UX research, product management, and CRO marketing ‚Äî and Claude Opus 4.6, Anthropic's AI. The initial brainstorming and specs came from working with Gemini; the Rust implementation comes from Claude. C√©line provides the vision, UX principles, and architectural decisions; Claude contributes code generation, algorithm implementation, debugging, and iterative refinement across the 10-crate Rust workspace. This website and the marketing plan were also co-created the same way. It's a real-world example of what human-AI collaboration can produce ‚Äî not a developer replaced by AI, but a non-developer building an experimental prototype by combining domain expertise with AI capabilities.`
};

const TOPIC_PATTERNS = [
  { keys: ['overview', 'what is', 'about', 'sovereign', 'tell me', 'explain', 'introduction', 'intro'], topic: 'overview' },
  { keys: ['ai', 'orchestrat', 'llm', 'model', 'qwen', 'llama', 'chat', 'intent', 'assistant', 'intelligent'], topic: 'ai' },
  { keys: ['secur', 'safe', 'action gravity', 'gravity', 'trust', 'inject', 'prompt inject', 'barrier'], topic: 'security' },
  { keys: ['canvas', 'spatial', 'timeline', 'visual', 'map', 'navigate', 'thread', 'lane'], topic: 'canvas' },
  { keys: ['encrypt', 'key', 'xchacha', 'aes', 'crypto', 'cipher', 'master key'], topic: 'encryption' },
  { keys: ['recover', 'guardian', 'shamir', 'shard', 'backup', 'lost', 'lost device'], topic: 'recovery' },
  { keys: ['p2p', 'peer', 'sync', 'device', 'libp2p', 'quic'], topic: 'p2p' },
  { keys: ['skill', 'plugin', 'module', 'app', 'markdown editor', 'pdf', 'extensi'], topic: 'skills' },
  { keys: ['comm', 'email', 'signal', 'whatsapp', 'imap', 'smtp', 'messag', 'inbox'], topic: 'comms' },
  { keys: ['voice', 'speech', 'whisper', 'piper', 'wake', 'dictation', 'microphone', 'speak'], topic: 'voice' },
  { keys: ['tech', 'rust', 'crate', 'stack', 'surrealdb', 'iced', 'hardware', 'require', 'spec', 'run on'], topic: 'tech' },
  { keys: ['philos', 'vision', 'why', 'different', 'approach', 'content-centric', 'paradigm', 'principle'], topic: 'philosophy' },
  { keys: ['status', 'alpha', 'beta', 'progress', 'phase', 'roadmap', 'when', 'release', 'ready'], topic: 'status' },
  { keys: ['contribut', 'open source', 'github', 'help', 'develop', 'agpl', 'license', 'code'], topic: 'contribute' },
  { keys: ['compar', 'vs', 'versus', 'better', 'notion', 'obsidian', 'google', 'alternative'], topic: 'comparison' },
  { keys: ['built', 'claude', 'anthropic', 'who built', 'who made', 'human', 'ai collab', 'co-develop', 'created by'], topic: 'built' },
];

function detectTopic(input) {
  const lower = input.toLowerCase();
  let best = null, bestScore = 0;
  for (const pat of TOPIC_PATTERNS) {
    let score = 0;
    for (const k of pat.keys) {
      if (lower.includes(k)) score += k.length;
    }
    if (score > bestScore) { bestScore = score; best = pat.topic; }
  }
  return best;
}

const TOPIC_LINKS = {
  overview:    { label: 'Explore features', href: '#features' },
  ai:          { label: 'AI orchestrator deep dive', href: '#/ai-orchestrator' },
  security:    { label: 'Action Gravity deep dive', href: '#/action-gravity' },
  canvas:      { label: 'Spatial Canvas deep dive', href: '#/spatial-canvas' },
  encryption:  { label: 'Encryption deep dive', href: '#/encryption' },
  recovery:    { label: 'Social Recovery deep dive', href: '#/social-recovery' },
  p2p:         { label: 'Encryption & sync details', href: '#/encryption' },
  skills:      { label: 'Content & Skills deep dive', href: '#/content-skills' },
  comms:       { label: 'Communications deep dive', href: '#/communications' },
  voice:       { label: 'AI orchestrator deep dive', href: '#/ai-orchestrator' },
  tech:        { label: 'Content & Skills architecture', href: '#/content-skills' },
  philosophy:  { label: 'Ethics & design constraints', href: '#/ethics' },
  status:      { label: 'View on GitHub', href: 'https://github.com/sovereign-os/sovereign' },
  contribute:  { label: 'View on GitHub', href: 'https://github.com/sovereign-os/sovereign' },
  comparison:  { label: 'Content & Skills architecture', href: '#/content-skills' },
  built:       { label: 'Ethics & design philosophy', href: '#/ethics' },
};

function getResponse(input) {
  const topic = detectTopic(input);
  if (topic && SOVEREIGN_KNOWLEDGE[topic]) {
    let response = SOVEREIGN_KNOWLEDGE[topic];
    const link = TOPIC_LINKS[topic];
    if (link) {
      const isExternal = link.href.startsWith('http');
      const target = isExternal ? ' target="_blank" rel="noopener"' : '';
      response = `<a href="${link.href}" class="chat-nav-link"${target}>${link.label} ‚Üí</a><br><br>` + response;
    }
    return response;
  }
  return `That's a great question! I can tell you about any aspect of Sovereign ‚Äî the AI orchestrator, encryption, the spatial canvas, guardian recovery, the skill system, voice pipeline, P2P sync, communications, or the project's philosophy and status. What interests you most?`;
}

function getSuggestions(lastTopic) {
  const allSuggestions = {
    _default: [
      "What is Sovereign GE?",
      "How does the AI work?",
      "Who built this?",
      "Tell me about encryption"
    ],
    overview: ["How does the AI work?", "What about security?", "How is it different from Notion?", "What's the current status?"],
    ai: ["How is prompt injection handled?", "Tell me about the voice pipeline", "What about the skill system?", "What hardware do I need?"],
    security: ["Explain the encryption", "How does guardian recovery work?", "Tell me about the AI architecture", "How can I contribute?"],
    canvas: ["How does P2P sync work?", "Tell me about skills", "What's the philosophy behind it?", "What hardware do I need?"],
    encryption: ["How does guardian recovery work?", "Tell me about P2P sync", "What about security levels?", "How is it different?"],
    recovery: ["How does encryption work?", "Tell me about P2P sync", "What's the project status?", "How can I contribute?"],
    p2p: ["How does encryption work?", "Tell me about the canvas", "What communications are supported?", "What's the roadmap?"],
    skills: ["How does the AI orchestrate skills?", "What about security?", "How can I contribute?", "Compare with other tools"],
    comms: ["How does encryption work?", "Tell me about P2P sync", "What's the voice pipeline?", "What's the current status?"],
    voice: ["How does the AI work?", "What about security?", "Tell me about skills", "What hardware do I need?"],
    tech: ["How does the AI work?", "Tell me about encryption", "What's the canvas?", "How can I contribute?"],
    philosophy: ["What is the spatial canvas?", "How does the AI work?", "Compare with other tools", "What's the roadmap?"],
    status: ["How can I contribute?", "What hardware do I need?", "Tell me about encryption", "How does the AI work?"],
    contribute: ["What's the tech stack?", "Tell me about the AI", "What's the current status?", "How does encryption work?"],
    comparison: ["What is Sovereign GE?", "Tell me about the AI", "How does encryption work?", "How can I contribute?"],
    built: ["How does the AI orchestrator work?", "What's the tech stack?", "How can I contribute?", "Compare with other tools"],
  };
  return allSuggestions[lastTopic] || allSuggestions._default;
}

const chatToggle = document.getElementById('chatToggle');
const chatbox = document.getElementById('chatbox');
const chatMessages = document.getElementById('chatMessages');
const chatForm = document.getElementById('chatForm');
const chatInput = document.getElementById('chatInput');
const chatSend = document.getElementById('chatSend');
const chatSuggestions = document.getElementById('chatSuggestions');
let lastTopic = '_default';

function toggleChat() {
  const isOpen = chatbox.classList.toggle('open');
  chatToggle.setAttribute('aria-expanded', isOpen);
  chatbox.setAttribute('aria-hidden', !isOpen);
  if (isOpen) {
    chatInput.focus();
    if (chatMessages.children.length === 0) {
      addBotMessage("Welcome! I'm the Sovereign AI guide. I can tell you about Sovereign GE ‚Äî its architecture, security model, AI orchestrator, and more. What would you like to explore?");
      renderSuggestions('_default');
    }
  }
}

function addBotMessage(text) {
  const div = document.createElement('div');
  div.className = 'chat-msg bot';
  div.innerHTML = text.replace(/`([^`]+)`/g, '<code>$1</code>');
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function addUserMessage(text) {
  const div = document.createElement('div');
  div.className = 'chat-msg user';
  div.textContent = text;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function addTypingIndicator() {
  const div = document.createElement('div');
  div.className = 'chat-msg bot';
  div.id = 'typingIndicator';
  div.innerHTML = '<div class="typing-indicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>';
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function removeTypingIndicator() {
  const el = document.getElementById('typingIndicator');
  if (el) el.remove();
}

function renderSuggestions(topic) {
  const suggestions = getSuggestions(topic);
  chatSuggestions.innerHTML = '';
  suggestions.forEach(s => {
    const btn = document.createElement('button');
    btn.className = 'chat-suggestion';
    btn.textContent = s;
    btn.addEventListener('click', () => handleUserInput(s));
    chatSuggestions.appendChild(btn);
  });
}

function handleUserInput(text) {
  if (!text.trim()) return;
  addUserMessage(text);
  chatInput.value = '';
  chatSend.disabled = true;
  chatSuggestions.innerHTML = '';

  addTypingIndicator();

  const delay = 400 + Math.random() * 600;
  setTimeout(() => {
    removeTypingIndicator();
    const topic = detectTopic(text);
    lastTopic = topic || '_default';
    addBotMessage(getResponse(text));
    renderSuggestions(lastTopic);
    chatSend.disabled = false;
    chatInput.focus();

    // Auto-navigate to the relevant page
    if (topic) {
      const link = TOPIC_LINKS[topic];
      if (link && !link.href.startsWith('http')) {
        if (link.href.startsWith('#/')) {
          location.hash = link.href;
        } else if (link.href.startsWith('#')) {
          // Section anchor (e.g. #features) ‚Äî go home first if needed, then scroll
          const currentHash = location.hash.slice(1) || '/';
          if (currentHash !== '/') {
            location.hash = '#/';
            setTimeout(() => {
              const el = document.querySelector(link.href);
              if (el) el.scrollIntoView({ behavior: 'smooth' });
            }, 150);
          } else {
            const el = document.querySelector(link.href);
            if (el) el.scrollIntoView({ behavior: 'smooth' });
          }
        }
      }
    }
  }, delay);
}

chatToggle.addEventListener('click', toggleChat);
chatForm.addEventListener('submit', (e) => {
  e.preventDefault();
  handleUserInput(chatInput.value);
});
chatSend.addEventListener('click', () => handleUserInput(chatInput.value));

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && chatbox.classList.contains('open')) {
    toggleChat();
    chatToggle.focus();
  }
});
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Sovereign GE",
  "description": "An experimental local-first graphical environment with on-device AI, end-to-end encryption, and peer-to-peer sync.",
  "url": "https://clenoble.github.io/sovereign-os",
  "applicationCategory": "DesktopApplication",
  "applicationSubCategory": "Desktop Environment",
  "operatingSystem": "Linux, Windows, macOS",
  "license": "https://www.gnu.org/licenses/agpl-3.0.html",
  "isAccessibleForFree": true,
  "author": {
    "@type": "Person",
    "name": "C√©line Lenoble"
  },
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Sovereign GE",
  "url": "https://clenoble.github.io/sovereign-os"
}
</script>

</body>
</html>
